<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rapid Control Prototyping (RCP)</title><link>https://lubin.kerhuel.eu/</link><description>Recent content on Rapid Control Prototyping (RCP)</description><generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><copyright>&amp;copy; {year} Lubin Kerhuel</copyright><lastBuildDate>Tue, 28 May 2019 00:00:00 +0000</lastBuildDate><atom:link href="https://lubin.kerhuel.eu/index.xml" rel="self" type="application/rss+xml"/><item><title>Air-speed sensor for plane, drone or UAVs.</title><link>https://lubin.kerhuel.eu/post/pitot-build/</link><pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/pitot-build/</guid><description>
&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;h2 id=&#34;principle&#34;&gt;Principle&lt;/h2&gt;
&lt;p&gt;A Pitot-Darcy tube is an air speed sensor commonly used in aviation. It consist of a tube pointing in the forward direction. When the sensor move forward a stop pressure is created at its top. A differential pressure is measured between the top of the tube and the ambient pressure. One variant named from its inventor Prandtl tube has static air ports directly on the side of the tube.&lt;/p&gt;
&lt;p&gt;The pressure measured is linear to the square of the air speed : $P_t = P_s + \frac{1}{2}\rho v^2$ where $P_t$ and $P_s$ are the pressure in Pa, $\rho$ is the fluid density constant typically in $[1.14 \ 1.34]$ depending on temperature &amp;amp; altitude, and $v$ the speed in $m.s^{-1}$. The differential pressure measured is $P_d = P_t-P_s$.&lt;/p&gt;
&lt;h2 id=&#34;prandtl-tube&#34;&gt;Prandtl tube&lt;/h2&gt;
&lt;p&gt;Prandtl tube is build placing an inner tube within an outer tube. Both tube are centered on their top which are aligned and the space between the tubes is hermetically filled in with a hard enough glue like epoxy. The side of the outer tube is drilled to sense the static pressure. At the bottom of the tube, the inner tube which is longer act as a connector for the dynamic pressure sensor and a tiny tube is added next to create another connector providing access to the static pressure which lies between the two tube.&lt;/p&gt;
&lt;p&gt;The static pressure holes should be placed at a minimum distance from the top due to airflow perturbations. A distance 4 times the diameter of the outer tube is retains here.&lt;/p&gt;
&lt;p&gt;Any tube can be used. First test were done with brass tube. Inner tube were 1mm inside, 2mm outside. Outer tube was 3mm inside, 4mm outside. A lighter Prandtl tube was made using one inner brass tube (1mm/2mm) with a carbon outer tube (3mm/5mm).&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-brasstubes.jpg&#34; alt=&#34;Tube alfer from Leroy Merlin. Inner tube is 2mm/1mm. Outer tube is 4mm/3mm (d=4mm). Outer tube length is m=86mm (21d). Four 1mm width holes are at l=16mm (4d) from the top.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-brasstubes.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Brass inner and outer tubes composing the pitot tube.&lt;/h4&gt;
&lt;p&gt;Tube alfer from Leroy Merlin. Inner tube is 2mm/1mm. Outer tube is 4mm/3mm (d=4mm). Outer tube length is m=86mm (21d). Four 1mm width holes are at l=16mm (4d) from the top.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;References:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://naca.central.cranfield.ac.uk/reports/1957/naca-report-1303.pdf&#34;&gt;report&lt;/a&gt; by W.Gracey on the impact of the various shape on the measurement.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.planete-sciences.org/espace/IMG/pdf/tube_de_pitot.pdf&#34;&gt;report (french)&lt;/a&gt; from ANSTJ with general information on pitot sensor.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://voiletech.free.fr/skyassistant/pitot.htm&#34;&gt;website (french)&lt;/a&gt; from Rémi Bourgin with experimental pitot tube for RC plane&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- Tube laiton macif (alfer) au Leroy Merlin;
Tube intèrieur: 2mm, trou 1mm
Tube extèrieur: 4mm, trou 3mm
Longueur total:
d = 4mm
l = 4d =&gt; 16mm
m = 11d =&gt;44mm
Tube altigator:
d = 4mm
l = 18mm
m = 72mm
--&gt;
&lt;h2 id=&#34;electronics&#34;&gt;Electronics&lt;/h2&gt;
&lt;h3 id=&#34;sensitivity-requirements-and-pressure-sensor&#34;&gt;Sensitivity requirements and Pressure sensor&lt;/h3&gt;
&lt;p&gt;The differential pressure measured is vary with the square of the speed. RC plane speed can be quite low. Challenge is to build an electronic sensitive enough to obtain good measurement even in the low speed range.&lt;/p&gt;
&lt;p&gt;One sensitive differential pressure sensor available is the &lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; from NXP. It measures differential pressure from 0 to 3.92 kPa and provide a ratiometric analog ouptut swing from 0.6V to 3V (2.4V swing). For reference, 1 kPa correspond to the pressure of 10cm of water.&lt;/p&gt;
&lt;p&gt;We are interested in speed range varying from $0$ to $25 m.s^{-1}$ ($90km/h$) which correspond to a maximum differential pressure of 3.75 cm of water, or 0.375 kPa. The MP3V5004DP sensor is used in 10% only of its nominal range.&lt;/p&gt;
&lt;p&gt;Table below provide theoretical differential pressure expected for a given speed, using $\rho=1.2$ and $P_{diff} = \frac{1}{2}\rho v^2$.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;v (m/s)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;v (Km/h)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$P_{diff}$ (Pa)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;~ $H_2O$ (cm)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; &amp;amp; &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; (0.2041Pa / LSB)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.006&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.024&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;14.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.096&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;47&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;25.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;29.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.294&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;144&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;60&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;294&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;54&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;135&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;661&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;20&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;72&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;240&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1176&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;90&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;375&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1837&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;108&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;540&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2646&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;40&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;144&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;960&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;em&gt;4704&lt;/em&gt; (4095 sat)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;signal-conditioning-and-conversion&#34;&gt;Signal conditioning and conversion&lt;/h3&gt;
&lt;p&gt;The pressure sensor is close to the pitot tube on the wing. The analog to digital conversion is also done nearby to avoid noise pollution of analog signal. The &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; from Microchip is a high resolution sigma-delta converter with four differential inputs and a programmable gain factor from 1 to 8. It has a digital I2C interface to connect to the dsPIC.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; output analog signal is connected to the &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; Sigma-Delta ADC through a first order RC low pass filter with a cut off frequency at $28Hz$ ($R=5.6 kOhm$,$C=1\mu F$). The 2nd differential input is connected on a voltage divisor with 1.2k and 560 ohms to the 3.3V ref and GND. $10\mu F$ decoupling capacitor are used on power supply. The I2C bus lines are pulled up with 10kOhm and are connected to a 10pf capacitor protecting from glitches.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg&#34; alt=&#34;Differential pressure sensor (MP3V5004dp) with Analog to Digital converter integrating a differential amplifier (MCP3428). The MCP3428 communicate with the microcontroller through an I2C BUS. A 3.3V voltage regulator adapt and filter out the 5V input voltage.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Pressure sensor and electronics mounted on a DIP adapter board.&lt;/h4&gt;
&lt;p&gt;Differential pressure sensor (MP3V5004dp) with Analog to Digital converter integrating a differential amplifier (MCP3428). The MCP3428 communicate with the microcontroller through an I2C BUS. A 3.3V voltage regulator adapt and filter out the 5V input voltage.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id=&#34;sensor-static-tests&#34;&gt;Sensor static tests&lt;/h3&gt;
&lt;p&gt;A 90 minutes lasting measurement is performed indoor without movements is performed. Sensor output are logged at 100Hz. The figure below shows a slow drift. The sensor standard deviation measured on the overall measurement is 0.54 Pa (including the drift).&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-static-characteristic.png&#34; alt=&#34;90 minutes lasting static measurement indoor shows a slow drift and a standard deviation of 0.54 Pa.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-static-characteristic.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Differential Sensor static characteristics&lt;/h4&gt;
&lt;p&gt;90 minutes lasting static measurement indoor shows a slow drift and a standard deviation of 0.54 Pa.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;One point to note however si that the sensor is sensitive to its own orientation. Moving the sensor up-side down create an offset of (100 LSB from memory, to be checked).&lt;/p&gt;
&lt;h2 id=&#34;installation&#34;&gt;Installation&lt;/h2&gt;
&lt;p&gt;A 2mm flexible tube originally used to protect fish lines connect the pitot tube with the sensor.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:50%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg&#34; alt=&#34;Fishing Tube used to connect pressure MP3V5004dp sensor to pitot tube.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Flashmer - Tube souple 2mm. Image from Decathlon (france)&lt;/h4&gt;
&lt;p&gt;Fishing Tube used to connect pressure MP3V5004dp sensor to pitot tube.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;One magnet is glued on the pitot tube. The pitot tube is attached to the plane through a 2nd magnet integrated into the wing. This flexible solution allows the tube to stay in place during flight, and eject in case of hard landing or crash, avoiding possible injury or destruction.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg&#34; /&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Brass pitot tube with its electronic board mounted on the bottom of the right FirStar 1600 wing.&lt;/h4&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:60%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-carbon2.jpg&#34; alt=&#34;Outer tube is a 5mm carbon tube. Inner tube is a brass 2mm/1mm tube.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-carbon2.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Carbon-Brass pitot tube attached to the wing with a magnet.&lt;/h4&gt;
&lt;p&gt;Outer tube is a 5mm carbon tube. Inner tube is a brass 2mm/1mm tube.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&#34;results&#34;&gt;Results&lt;/h2&gt;
&lt;h3 id=&#34;comparison-with-gps-ground-speed&#34;&gt;Comparison with GPS ground speed&lt;/h3&gt;
&lt;p&gt;The Ground Speed (GPS) and the Air Speed (pitot) measurements are theoretically similar in absence of wind. In presence of a constant wind, the direction and strength can be estimated combining the airspeed with the ground speed and the plane yaw direction.&lt;/p&gt;
&lt;p&gt;With the wind strenght and direction known, the airplane ground speed (GPS) can be retrieved by adding the projected wind to the aircraft forward direction to the air speed (pitot). The figure below presents the air speed in dashed blue, and compare the reconstructed ground speed (thin black line) with the GPS ground speed (large grey line).&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-gps-wind-estimation.png&#34; alt=&#34;GPS (grey curve) and Pitot minus Wind (black curve) matches. Data are the first 200s of the firstar 1600 RC plane flight. The GPS ground speed is correctly estimated based on the pitot tube measurement.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-gps-wind-estimation.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;GPS Speed over ground (large grey), Pitot air-speed (dashed blue) with parameter $\rho=1.2$. Pitot air-speed minus constant wind estimation (black curve)&lt;/h4&gt;
&lt;p&gt;GPS (grey curve) and Pitot minus Wind (black curve) matches. Data are the first 200s of the firstar 1600 RC plane flight. The GPS ground speed is correctly estimated based on the pitot tube measurement.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;The reconstructed ground speed matches with the GPS speed used as reference. It prove the correctness of the pitot air-speed measurement, and the possibility to estimate accurately the constant wind. The pitot tube differential pressure were converted to speed with $\rho = 1.2$.&lt;/p&gt;
&lt;p&gt;The remaining error might be pitot sensor error, but also GPS accuracy limitation particularly at estimating vertical speed changes (During flight, the plane speed was change through rapid climb to test the pitot tube on a wide range), and by wind gust which are not compensated for.&lt;/p&gt;
&lt;h3 id=&#34;wind-estimation&#34;&gt;Wind estimation&lt;/h3&gt;
&lt;p&gt;The comparison of the pitot tube with the GPS ground speed require to estimate the wind strength and direction.&lt;/p&gt;
&lt;p&gt;The curve below shows the difference between the Ground speed (GPS) with the air speed (pitot) in function of the plane flight direction. This error (blue dashed points) match with a sine which match the model for a constant wind in strength and direction.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-speed-error-fct-direction.png&#34; alt=&#34;Blue dots are speed difference between GPS and pitot. The continuous black line is the wind sine wave (phase is wind direction, amplitude is wind strength) which best match the air speed and ground speed differences.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-speed-error-fct-direction.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;GPS ground speed and pitot air speed difference in function of the plane direction during the 450s flight of a firstar 1600.&lt;/h4&gt;
&lt;p&gt;Blue dots are speed difference between GPS and pitot. The continuous black line is the wind sine wave (phase is wind direction, amplitude is wind strength) which best match the air speed and ground speed differences.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;The matlab sript for wind estimation (offline) is provided below:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-matlab&#34;&gt;% V_gps and V_pitot are the vector with all data measured.
V_err = V_gps - V_pitot; % Ground and Air speed difference (i.e. wind)
M = [sin(COG); cos(COG) ]&#39;; % COG is the direction (Theta in rad) vector data measured from the GPS
y = -V_err&#39;;
x = M\y; % estimate wind strenght and direction with linear algebra (MMSE)
Theta_Wind = atan2(x(1),x(2)); % Wind angle (rad)
V_Wind = sqrt(sum(x(1:2).^2)); % Wind strength (m/s)
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;limitation&#34;&gt;Limitation&lt;/h4&gt;
&lt;p&gt;Using GPS COG for plane direction add a bias to the plane orientation. Would be better using plane orientation from the IMU sensor. Not done here to reduce the number of sensor used in the demonstration. It works provided the wind is small compared to the airplane air speed, which make the COG bias relatively small.&lt;/p&gt;
&lt;!--
C:\M91449\MCHP_Blockset\Projects\2017_10_Autopilote\2018_04_12_LogChampdeTir_PitotNum_magOk_LowWind --&gt;</description></item><item><title>Auto-pilote for Plane based on Simulink</title><link>https://lubin.kerhuel.eu/project/autopilot-plane/</link><pubDate>Sun, 19 May 2019 00:00:00 +0200</pubDate><guid>https://lubin.kerhuel.eu/project/autopilot-plane/</guid><description>
&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;h2 id=&#34;an-autopilot-based-on-rapid-control-prototyping-technics&#34;&gt;An autopilot based on rapid control prototyping technics&lt;/h2&gt;
&lt;h3 id=&#34;motivation&#34;&gt;Motivation&lt;/h3&gt;
&lt;p&gt;An Autopilot platform to test autopilot control loop is easy to build using simple low cost elements:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;10 DoF IMU sensor board (~$5\ \$$),&lt;/li&gt;
&lt;li&gt;GPS board: (~$10\ \$$),&lt;/li&gt;
&lt;li&gt;Pitot tube: (~$15\ \$$),&lt;/li&gt;
&lt;li&gt;Microcontroller board (price depend on the board ; use a less than $5\ \$$ mcu),&lt;/li&gt;
&lt;li&gt;Plane platform: from $60$ to $120\ \$$ including servo and motors.&lt;/li&gt;
&lt;li&gt;You also need a receiver, a remote control, battery packs and few optional hardware for data recorder, and telemetry.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It can be an exciting platform for testing various control theory.&lt;/p&gt;
&lt;h3 id=&#34;difference-with-existing-auto-pilot&#34;&gt;Difference with existing auto-pilot&lt;/h3&gt;
&lt;p&gt;Off the shelf autopilot exists and might works great (&lt;a href=&#34;http://ardupilot.org/&#34;&gt;Ardupilot&lt;/a&gt;, &lt;a href=&#34;https://px4.io/&#34;&gt;PX4&lt;/a&gt;, &lt;a href=&#34;http://inavflight.com/&#34;&gt;iNav&lt;/a&gt;, &lt;a href=&#34;https://www.librepilot.org/site/index.html&#34;&gt;LibrePilot&lt;/a&gt;, &lt;a href=&#34;https://wiki.paparazziuav.org/wiki/Main_Page&#34;&gt;Paparazzi&lt;/a&gt;, further autopilot projects are listed on the &lt;a href=&#34;https://blog.dronetrest.com/flight-controller-firmware/&#34;&gt;DroneTrest review&lt;/a&gt;). Their parameters can be tuned. However testing your own controller on such autopilot requires implementing it at the right place, thus understanding the code structure underneath. Even well documented, it represents hundreds of C functions to understand, before possibly starting any changes.
Your custom control loop might not fit the existing structure provided controller implemented in such projects are typically PIDs and you might want to implement a more complex structure, using different sample rate.&lt;/p&gt;
&lt;p&gt;The presented autopilot use a Model Based Design (MDB) approach: The autopilot code is generated from a single simulink model. This is also named Rapic Control Prototyping (RCP).&lt;/p&gt;
&lt;p&gt;The autopilot controller use standard math blocks and the system low level parts is taken care with the Microchip blockset to drive the microcontroller peripherals and the UxV blockset to easily add features like GPS parser, Remote Control S.BUS, F.Port and Smart Port protocol, Mavlink messaging including Way Point and Parameters protocols.
The simulink model allows to &amp;ldquo;get-in&amp;rdquo; graphically. It allows simulating parts of the system based on a simulated plane or based on values logged from a real flight which is very useful to work on sensor fusions algorithms.&lt;/p&gt;
&lt;p&gt;Another key difference is the use of a 16 bit microcontroller while other autopilot use 32 bit microcontroller. 16 bits dsPIC prove to provide all required ressources thanks to the efficient architecture underneath which handle the many peripheral used in an efficient way (UART, I2C, Output Capture, Input Compare&amp;hellip;).&lt;/p&gt;
&lt;p&gt;A similar model based design also using dsPIC microcontroller is developed by Pr E.Elkaim at UCSC in a project named SLUG. Their design is independent from the one presented here. &lt;a href=&#34;https://slugsuav.soe.ucsc.edu/&#34;&gt;SLUG&lt;/a&gt; and &lt;a href=&#34;https://doi.org/10.1155/2018/6892153&#34;&gt;SLUG II&lt;/a&gt; projects rely on the same tool used here to target the dsPIC: the blockset for Microchip microcontrollers (free).&lt;/p&gt;
&lt;h3 id=&#34;hardware-list&#34;&gt;Hardware list&lt;/h3&gt;
&lt;p&gt;Various combination of material were tested. Below is a selected list of hardware which prove to be efficient.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg&#34; alt=&#34;Volantex FirStar 1600 with Qx7 remote control.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;autopilot platform&lt;/h4&gt;
&lt;p&gt;Volantex FirStar 1600 with Qx7 remote control.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RC platform&lt;/strong&gt;: Volantex Firstar 1600 with stock motors and servos (Alternative platform are Bixler 2 and Ranger 1600)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Remote Control&lt;/strong&gt;: FrSky QX7&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Receiver&lt;/strong&gt;: FrSky XSR-M / XSR used with either the S.Bus (receiver channel output) and S.port (Telemetry) protocol or with the F.Port protocol which combine both both S.bus with S.port saving one UART peripheral of the microcontroller. Each protocol use only one wire thus half duplex UART. dsPIC UART peripheral enable configuring Tx and Rx on one line.&lt;br /&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Microcontroller&lt;/strong&gt;: dsPIC 33EP on a AUAV V3 board. External motion sensor are used instead of built-in AUAV3 sensors. Tiny sensor board with recent chip are easier to firmly attach near the CG reducing vibrations. A custom board based on a dsPIC might replace the AUAV3 board which is difficult to find now. The UDB5 mini is similar and can still be found.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IMU sensor&lt;/strong&gt;: Gy-91 (10 DoF with 3 accelerometers, 3 rate gyro, 3 magnetometers and one barometer). Firmly attached near the CG of the plane. I2C bus is used between sensors and mcu.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pitot tube&lt;/strong&gt;:
&lt;ul&gt;
&lt;li&gt;An inner tube and an outer tube on which four hole are done laterally.&lt;/li&gt;
&lt;li&gt;Signal conditioning: the pitot tube pressure sensor (MP3V 5004 DP) is done with a MCHP ADC converter which integrate an analog amplifier. Converted pressure is sent to the microcontroller through the I2C bus.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GPS&lt;/strong&gt;: based on a $\mu$blox M8N chip providing up to 10Hz refresh rate and provided good results compared to competitors chips.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Data logger&lt;/strong&gt;: OpenLager board to log on SD card. It allows logging continuous UART output flow with at a baud up to 2 470 000 (much higher than a 115 200 baud rate that OpenLog data logger cannot sustain.).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Radio link&lt;/strong&gt;: 3DR Sik based Radio module for mavlink telemetry (plane attitude, position, Way Point and Parameters tuning) with &lt;a href=&#34;http://qgroundcontrol.com/&#34;&gt;qgroundcontrol&lt;/a&gt; base station running on most platforms (PC, android, windows, linux).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Action cam&lt;/strong&gt;: RunCam2 to film the plane and its surface control from the top; getting a visual behavior of the autopilot in the action.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/autopilot-electronic-sensors-bundle_1.jpg&#34; /&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/autopilot-electronic-sensors-bundle_1.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Embedded electronics. One early configuration for testing various sensors. Elements used: X8R receiver, PDB-XPM power board, OpenLager SD data logger, AUAV3 16 bit dsPIC microcontroller with sensors (MPU6050), IMU board 1, IMU board 2, Pressure sensor MP3V5004DP for pitot tube, GPS1, GPS2, 3S 2200maH LiPo battery, Qx7 transmitter.&lt;/h4&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id=&#34;results&#34;&gt;Results&lt;/h3&gt;
&lt;p&gt;Sliding mode based controller tested in both pitch and roll axis with two mode:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Control plane angular rate control (angular speed set-point given through the remote control)&lt;/li&gt;
&lt;li&gt;Control plane angle attitude (angle set point provided through the remote control)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Average CPU load was 7 to 8% on a dsPIC 33EP running at 70 MIPS. It includes the IMU estimation algorithm, autopilot control loop and all low tasks (handle various protocols (I2C, NMEA for GPS, F.Port, Mavlink and log sensors data at 1Khz through an UART configured at 24700000)&lt;/p&gt;
&lt;p&gt;Tested with strong wind. Showing fairly good robustness despite the low number of parameters tuned so far (video link on top).&lt;/p&gt;
&lt;p&gt;Pitot tube air-speed estimation validated using GPS speed measurement as reference.&lt;/p&gt;
&lt;p&gt;Validated the wind speed and direction estimation based on a difference between the GPS and pitot tube speed measurement taking into account the plane orientation.&lt;/p&gt;
&lt;p&gt;Validated automatic calibration of the magnetometers axis offset and gain. Once in the air, the magnetic perturbation near the floor are negligible. An algorithm automatically determine if the calibration can be refined using current data (using standard flight input data, no looping or specific roll required).&lt;/p&gt;
&lt;h3 id=&#34;next-steps&#34;&gt;Next steps&lt;/h3&gt;
&lt;p&gt;Reduce chattering on ailerons when sliding mode control is enabled.&lt;/p&gt;
&lt;p&gt;Test in flight mavlink protocol parameters tuning.&lt;/p&gt;
&lt;p&gt;Add automatic guidance of the plane, using Mavlink Way point sets.&lt;/p&gt;
&lt;h3 id=&#34;site-content&#34;&gt;Site content&lt;/h3&gt;
&lt;p&gt;Time constraints does not allow writing a complete description of the project as originally planned. Part of projects which I find interesting and inspiring will be posted.&lt;/p&gt;
&lt;p&gt;Ideas to expand:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IMU&lt;/li&gt;
&lt;li&gt;Pitot tube&lt;/li&gt;
&lt;li&gt;Wind estimate&lt;/li&gt;
&lt;li&gt;UxV blocks including GPS, Remote Control and Mavlink blocks and functionalities&lt;/li&gt;
&lt;li&gt;Magnetometers auto calibration&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>MATEKSYS PDB-XPW Dual BEC &amp; Current Module tweak to increase current measurement sensitivity</title><link>https://lubin.kerhuel.eu/post/matek-pdb-xpw/</link><pubDate>Sat, 18 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/matek-pdb-xpw/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;p&gt;The board &lt;a href=&#34;http://www.mateksys.com/?portfolio=pdb-xpw&#34;&gt;PDB-XPW&lt;/a&gt; from MATEK System is a voltage regulator with an current measurement adapted for quad copters current with a max current measurement of 140 Amps. For an RC plane project, the current measurement might be reduced to increase current measurement resolution.&lt;/p&gt;
&lt;p&gt;The chip &amp;ldquo;INA1x9 High-Side Measurement Current Shunt Monitor&amp;rdquo; from Texas Instrument condition and amplify the shunt resistor voltage drop providing an analog output proportional to the current.&lt;/p&gt;
&lt;p&gt;On the PDB-XPW board, the INA1x9 chip is the black 5 pins component tagged E39 below the 0.05 Ohms shunt resistor, itself just below to the Power supply input connector.&lt;/p&gt;
&lt;p&gt;The amplification gain is set with the 47 kOhm resistor next to the INA1x9 component. This original value of 47 kOhm correspond to a gain of 47.
The gain is the value in kOhm as stated by the chip documentation:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Resistor&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Gain&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1 kOhm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5 Kohm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10 Kohm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;50 Kohm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;100 Kohm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The 47 kOhm resistor is replaced with a 270 kOhm resistor providing a gain of 270 instead of 47.
The original current measurement range is reduced from 140 (A) to 20 (A) (140 * &lt;sup&gt;47&lt;/sup&gt;&amp;frasl;&lt;sub&gt;270&lt;/sub&gt; = 20).&lt;/p&gt;
&lt;p&gt;The current measurement output is an analog signal swinging from 0 to 3.3V coding linearly for current in [0 - 20] Amps range. This lower current range fit with the RC plane platform like Bixler 2, FirStar 1600 or Ranger 1600.&lt;/p&gt;</description></item><item><title>Start/Stop signal for RunCam2 action cam</title><link>https://lubin.kerhuel.eu/post/runcam-remote-control-cable/</link><pubDate>Sat, 18 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/runcam-remote-control-cable/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;p&gt;Cable exist to connect a RunCam2 action cam to an RC receiver for remotely start and stop a record from the receiver PWM output (20ms period, 1ms to 2ms duty cycle).
The cable has logic to decode the RC PWM signal and generate the signal pulse scheme to start and stop the RunCam2 record.&lt;/p&gt;
&lt;p&gt;Controlling the camera can be done with a microcontroller by generating the required pulse scheme described below.&lt;/p&gt;
&lt;p&gt;The micro USB cable pinout (on the male part) is&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pin 1 : GND&lt;/li&gt;
&lt;li&gt;Pin 3 : TTL signal (5V)&lt;/li&gt;
&lt;li&gt;Pin 5 : +5V (higher voltage possible for the RunCam2 connector)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When the Camera USB port is set for &amp;ldquo;Remote Control&amp;rdquo; and not for &amp;ldquo;mass storage&amp;rdquo; with the configuration application, it is possible to switch back and forth the camera from video mode to photo mode, and to start/stop recording, or take a picture.&lt;/p&gt;
&lt;p&gt;The pulse scheme is the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;One pulse switch the camera from video recording mode to Photo mode.&lt;/li&gt;
&lt;li&gt;Two pulses separated with 85ms start or stop a video record (or take a picture in photo mode).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pulse level is 5V but it works with 3.3V. Line is low state when idle. Pulses are 85ms in high state duration separated by 85ms on multiple pulse.&lt;/p&gt;
&lt;p&gt;Tested with a runCam2 powered from a 3S LiPo battery (10 to 14V), no battery in the camera and pulse generated with a 3.3V dsPIC pin configured as digital output.&lt;/p&gt;
&lt;p&gt;The figure below is the Simulink diagram with the logic used to generate the appropriate pulse on a dsPIC. Code is generated through the Simulink Coder and the &lt;a href=&#34;https://www.microchip.com/DevelopmentTools/ProductDetails/PartNO/SW007023&#34;&gt;MPLAB block&lt;/a&gt; from Microchip.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/runcam2-startstop-simulink-logic.png&#34; alt=&#34;Simulink logic to control a runCam2 action Cam. The subsystem time step resolution is 1ms. The integrator is reset on each state change of the subsystem input, which trig the generation of two 85ms pulse pattern. Integrator reset is locked while pulses are being generated. Logic at the output of the integrator generate the pulses. The generated code were tested on a dsPIC target&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/runcam2-startstop-simulink-logic.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;
&lt;p&gt;Simulink logic to control a runCam2 action Cam. The subsystem time step resolution is 1ms. The integrator is reset on each state change of the subsystem input, which trig the generation of two 85ms pulse pattern. Integrator reset is locked while pulses are being generated. Logic at the output of the integrator generate the pulses. The generated code were tested on a dsPIC target&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;</description></item><item><title>Inverted Pendulum</title><link>https://lubin.kerhuel.eu/project/inverted-pendulum/</link><pubDate>Sat, 01 Dec 2018 00:00:00 +0100</pubDate><guid>https://lubin.kerhuel.eu/project/inverted-pendulum/</guid><description>&lt;p&gt;Simulink Rapid Prototyping based inverted pendulum running on a microstick II dsPIC board.
The embedded IMU data fusion algorithm use the ICM-20608 inertial sensor to estimate the angle.
LQR control loop drives two DC motors of the modified toy.
No encoder sensor are present.&lt;/p&gt;</description></item><item><title>Real Time Control for a DC Motor</title><link>https://lubin.kerhuel.eu/project/lab-dc-motor/</link><pubDate>Sat, 01 Dec 2018 00:00:00 +0100</pubDate><guid>https://lubin.kerhuel.eu/project/lab-dc-motor/</guid><description>&lt;p&gt;Control a 24V DC motor using the MCLV-V2 board with a dsPIC 33EP256MC506.
This hands-on is for 5th year students at INSA-Lyon.&lt;/p&gt;
&lt;p&gt;The hands-on Lab subject available at: &lt;a href=&#34;https://rtdc.ctrl-elec.fr/&#34;&gt;https://rtdc.ctrl-elec.fr/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Slides presents the adaptation required to go from a Simulink model for Simulation (or DSPACE) to a Simulink model targeting a microcontrollers. Two topics are presented:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Real-time scheduler / CPU load analysis&lt;/li&gt;
&lt;li&gt;Fixed-point datatypes&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Inverted Pendulum</title><link>https://lubin.kerhuel.eu/docs/inverted-pendulum/</link><pubDate>Sun, 09 Sep 2018 00:00:00 +0200</pubDate><guid>https://lubin.kerhuel.eu/docs/inverted-pendulum/</guid><description>
&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:45%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_platform_top.png&#34; alt=&#34;Top of the inverted pendulum&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_platform_top.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;
&lt;p&gt;Top of the inverted pendulum&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h1 id=&#34;presentation&#34;&gt;Presentation&lt;/h1&gt;
&lt;p&gt;Stabilization of an inverted pendulum is a common engineering challenge. Objective is to build a low-cost DIY&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DIY&#34;&gt;&lt;a href=&#34;#fn:DIY&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; platform to test various feedback control loop.&lt;/p&gt;
&lt;p&gt;This document describes the hardware and the theoretical model of the pendulum.
Simulation are presented with Simulink models and an LQR&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LQR&#34;&gt;&lt;a href=&#34;#fn:LQR&#34;&gt;2&lt;/a&gt;&lt;/sup&gt; feedback control loop finally stabilizes the platform.&lt;/p&gt;
&lt;!-- test code --&gt;
&lt;p&gt;&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
&lt;iframe src=&#34;//player.vimeo.com/video/309876246&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;!-- You tube alternative:
&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
&lt;iframe src=&#34;//www.youtube.com/embed/dWTK7dTUvCo&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; allowfullscreen title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
&lt;/div&gt;
--&gt;
Video of the stabilized platform with a 4 state LQR feedback loop. The platform is completely autonomous (no user input).&lt;/p&gt;
&lt;p&gt;The electronic placed at the top of the pendulum composed of a dsPIC 16 bits microcontroller and an inertial sensor (accelerometers and rate gyro).
The base of the pendulum is a modified RC toys comprising two wheels driven by two independent DC motor (see &lt;a href=&#34;#hw_trolley&#34;&gt;pictures below&lt;/a&gt;).&lt;/p&gt;
&lt;h1 id=&#34;hardware&#34;&gt;Hardware&lt;/h1&gt;
&lt;h2 id=&#34;overview&#34;&gt;Overview&lt;/h2&gt;
&lt;p&gt;The head and the base trolley are described successively. They are separated with an $8mm$ carbon tube.
The pendulum length is $0.52m$ from wheel axis to the top. Wheels diameters is $8cm$. Pendulum total weight is $200g$ comprising $111g$ for the 4 AA batteries.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:60%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_platform_reduced_horizontal.png&#34; alt=&#34;Inverted Pendulum platform&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_platform.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;
&lt;p&gt;Inverted Pendulum platform&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&#34;head-electronics&#34;&gt;Head electronics&lt;/h2&gt;
&lt;h3 id=&#34;microcontroller&#34;&gt;Microcontroller&lt;/h3&gt;
&lt;p&gt;The controller is a &lt;code&gt;Microstick II&lt;/code&gt; board equipped with a &lt;code&gt;dsPIC 33EP128MC202&lt;/code&gt; running at $70\ MIPS$.
It is powered through the USB connector which &lt;strong&gt;only provide the power supply&lt;/strong&gt; from 4 AA batteries hold in the base.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_top.png&#34; alt=&#34;A prototyping board support a Microstick II board with the dsPIC 33EP128MC202. A board from Drotek endowing the Invensense ICM-20608 inertial sensor is screwed on the base board.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_top.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Microcontroller and sensor on top of the inverted pendulum&lt;/h4&gt;
&lt;p&gt;A prototyping board support a Microstick II board with the &lt;em&gt;dsPIC 33EP128MC202&lt;/em&gt;. A board from Drotek endowing the Invensense ICM-20608 inertial sensor is screwed on the base board.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id=&#34;imu-sensor&#34;&gt;IMU sensor&lt;/h3&gt;
&lt;p&gt;The unique sensor used is the 6 DoF&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DoF&#34;&gt;&lt;a href=&#34;#fn:DoF&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; Invensense &lt;code&gt;ICM-20608&lt;/code&gt; mounted on a &lt;a href=&#34;https://store.drotek.com/sensors/779-imu-6dof-icm20608-invensense-pcb-8944595424761.html&#34;&gt;Drotek sensor board&lt;/a&gt;. It endows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a 3 axis Accelerometers and&lt;/li&gt;
&lt;li&gt;a 3 axis rate gyros.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The I2C blocks set the BUS clock at $400kHz$ and fetch the 6 sensors values every $1ms$ $(1kHz)$.
The Simulink I2C blocks setting enable hot plug of the I2C sensor: The microcontroller initializes the sensor each time it is newly detected on the I2C bus.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The accelerometer is configured with a range of $\pm 8g$ low pass filtered at $99Hz$.&lt;/li&gt;
&lt;li&gt;The rage gyro is configured with a range of $\pm 500 \deg/s$ low pass filtered at $250Hz$.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A Simulink IMU&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:IMU&#34;&gt;&lt;a href=&#34;#fn:IMU&#34;&gt;4&lt;/a&gt;&lt;/sup&gt; sub-system run a data fusion algorithm to reconstruct a drift-free quaternion angular position at $1kHz$ (the yaw angle drift when magnetometer is not present).
The stabilization control loop uses the drift-free pitch angle.&lt;/p&gt;
&lt;p&gt;It is possible to use other sensors like the MPU9250 or MPU6050 with either an I2C or SPI interface.
The GY-91 board is a 10 DoF&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DoF&#34;&gt;&lt;a href=&#34;#fn:DoF&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; widespread board based on the 9 DoF MPU9250 (3 accelerometers, 3 magnetometers, 3 rate gyros) and has a pressure sensor.&lt;/p&gt;
&lt;h3 id=&#34;UARTINTERFACE&#34;&gt;UART interface&lt;/h3&gt;
&lt;p&gt;The PCB board provides a $3.3V$ regulator and 4 pin extra interface ( GND, +3.3v, Tx, Rx ) to connect either an UART &lt;a href=&#34;https://github.com/d-ronin/openlager/wiki&#34;&gt;data-logger&lt;/a&gt; or &lt;a href=&#34;http://ardupilot.org/copter/docs/common-sik-telemetry-radio.html#common-sik-telemetry-radio&#34;&gt;radio link&lt;/a&gt; for telemetry module or an &lt;a href=&#34;https://www.frsky-rc.com/product/xsr/&#34;&gt;RC receiver&lt;/a&gt; capable of S.BUS, S.Port or P.Port protocol (all UART based).&lt;/p&gt;
&lt;h2 id=&#34;hw_trolley&#34;&gt;Base trolley&lt;/h2&gt;
&lt;h3 id=&#34;motors&#34;&gt;Motors&lt;/h3&gt;
&lt;p&gt;The base trolley is a low cost a 2-wheel remote control toy named &lt;code&gt;flywheels&lt;/code&gt;. The toy is from 2012 but 2 wheeled equivalents exist.
Its electronics is removed.
Two pairs of wires power two DC motors in either direction through an &lt;code&gt;L298N&lt;/code&gt; H bridge board module.&lt;/p&gt;
&lt;div class=&#34;gallery caption-position-bottom caption-effect-slide hover-effect-zoom hover-transition&#34; itemscope itemtype=&#34;http://schema.org/ImageGallery&#34;&gt;
&lt;div class=&#34;box&#34; &gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34; style=&#34;background-image: url(&#39;/img/pendulum_toysrus_flywheels_package.jpg&#39;);&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_package.jpg&#34; alt=&#34;FlyWheels toy package&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_package.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;FlyWheels toy package&lt;/h4&gt;
&lt;p&gt;FlyWheels toy package&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class=&#34;box&#34; &gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34; style=&#34;background-image: url(&#39;/img/pendulum_toysrus_flywheels_open.jpg&#39;);&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_open.jpg&#34; alt=&#34;Two DC motors&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_open.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Two DC motors&lt;/h4&gt;
&lt;p&gt;Two DC motors&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--
(pictures: [Package](Toysrus_FlyWheels_package.jpg), [vehicle](Toysrus_FlyWheels_Vehicle.jpg), [RC+vehicle](Toysrus_FlyWheels_Vehicle_Remote.jpg), [Inside](Toysrus_FlyWheels_Open.jpg))--&gt;
&lt;h3 id=&#34;power-electronics&#34;&gt;Power electronics&lt;/h3&gt;
&lt;p&gt;The L298N H bridge controls two DC motors. For each motor:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Two logic signals set the 4 states: direction CW or CCW, brake, or freewheel.&lt;/li&gt;
&lt;li&gt;The third logic signal power the motor depending on to the state defined.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The third signal is modulated with a 100Hz square periodic signal whose duty cycle vary from 0% to 100% (PWM). It sets the torque for the motor.&lt;/p&gt;
&lt;p&gt;The flat multicolour ribbon connects 6 logic control signals (3 for each motor) from the Microstick II dsPIC output to the of the L298N H bridge.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:60%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_base.png&#34; alt=&#34;A L298N H bridge (for Arduino) power board drives the two DC motors of a modified FlyWheels toy. Four AA batteries powers the pendulum.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_base.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Base trolley of the inverted pendulum&lt;/h4&gt;
&lt;p&gt;A &lt;em&gt;L298N H bridge&lt;/em&gt; (for Arduino) power board drives the two DC motors of a modified &lt;em&gt;FlyWheels&lt;/em&gt; toy. &lt;em&gt;Four AA batteries&lt;/em&gt; powers the pendulum.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id=&#34;batteries&#34;&gt;Batteries&lt;/h3&gt;
&lt;p&gt;Four $1.2V$ AA Ni-Mh batteries are dispatched on both side of the trolley.
$\approx 4.8V$ powers the motors and the electronics.
The black and red wire from the trolley to the top of the pendulum powers the Microstick II electronic and sensors.&lt;/p&gt;
&lt;h1 id=&#34;pendulum-model&#34;&gt;Pendulum Model&lt;/h1&gt;
&lt;p&gt;The pendulum model is composed of two intertwined sub-system:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The pendulum*, with 1 rotation DoF&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DoF&#34;&gt;&lt;a href=&#34;#fn:DoF&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; $\theta$ angle around the wheel&amp;rsquo;s axis&lt;/li&gt;
&lt;li&gt;The trolley*, with 1 translation DoF&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DoF&#34;&gt;&lt;a href=&#34;#fn:DoF&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; $x$ position.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum-free-body-diagram.png&#34; alt=&#34;$\vec{P}$ is the weight at the center of gravity. $\vec{R}$ is the reaction force from the stiff rod and the floor. $\vec{F}$ is a friction force when the pendulum is rotating. $\{ \vec{i},\vec{j} \}$ is the earth frame and $\{ \vec{r},\vec{n} \}$ is the rotating pendulum frame. The inertial sensors are placed on top of the pendulum and measure all accelerations.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum-free-body-diagram.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Pendulum free body diagram&lt;/h4&gt;
&lt;p&gt;$\vec{P}$ is the weight at the center of gravity. $\vec{R}$ is the reaction force from the stiff rod and the floor. $\vec{F}$ is a friction force when the pendulum is rotating. $\{ \vec{i},\vec{j} \}$ is the earth frame and $\{ \vec{r},\vec{n} \}$ is the rotating pendulum frame. The inertial sensors are placed on top of the pendulum and measure all accelerations.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&#34;pendul-equations&#34;&gt;Pendul Equations&lt;/h2&gt;
&lt;p&gt;The Dynamic fundamental law applied on the pendulum:
$$ \sum \vec{Force} = m.\vec{a} $$&lt;/p&gt;
&lt;p&gt;The three forces presents are the weight $\vec{P}$, the Friction $\vec{F}$, and the Reaction $\vec{R}$ from the rod &amp;amp; floor:&lt;/p&gt;
&lt;p&gt;$$ \underbrace{ -mg\vec{j} }_{\vec{P}} \
- \ \underbrace{ k \frac{\partial \vec{r}}{\partial t} }_{\vec{F}} \
+ \ \underbrace{ ( mg\vec{j} . \vec{r} + \underbrace{Ctfg}_{\text{Centrifugal}} } _{\vec{R} } ) . \vec{r} = ml \frac{\partial^2\vec{ r }}{\partial t^2}
$$&lt;/p&gt;
&lt;p&gt;With $ \{ \vec{i},\vec{j} \} $ the static earth frame and $ \{ \vec{r},\vec{n} \} $ the pendulum frame (rod and normal direction).
$m$ is the mass of the pendulum (without the trolley).
$l$ is the length from the inter-wheel&amp;rsquo;s axis to the center of mass of the pendulum (without the trolley)&lt;/p&gt;
&lt;p&gt;$$
\left\{ \begin{array}{rcl}
\vec{i} &amp;amp; = &amp;amp; \vec{n} . cos(\theta) - \vec{r} . sin(\theta) \\&lt;br /&gt;
\vec{j} &amp;amp; = &amp;amp; \vec{n} . sin(\theta) + \vec{r} . cos(\theta)
\end{array} \right.
$$&lt;/p&gt;
&lt;p&gt;$$\vec{j}.\vec{r} = cos(\theta)$$&lt;/p&gt;
&lt;p&gt;Considering the rotation $\theta$, the first and second time derivative of $\vec{r}$ are:&lt;/p&gt;
&lt;p&gt;$$
\begin{array}{rcl}
\frac{\partial \vec{r}}{\partial t}
&amp;amp; = &amp;amp;
- \dot{\theta} \vec{n} \\&lt;br /&gt;
\frac{\partial^2\vec{ r }}{\partial t^2}
&amp;amp; = &amp;amp;
- \frac{\partial }{\partial t} \left( \dot{\theta} \vec{n} \right) \\&lt;br /&gt;
&amp;amp; = &amp;amp;
- \ddot{\theta} \vec{n} - \dot{\theta}^2 \vec{r}
\end{array}
$$&lt;/p&gt;
&lt;p&gt;The projection of the forces equation in the pendulum frame $ \{ \vec{r},\vec{n} \} $ is:
$$
\left\{ \begin{array}{rcl}
\left( ml\dot{\theta}^2 + Ctfg \right) \vec{r} = \vec{0} \\&lt;br /&gt;
\left( l \ddot{\theta} + \frac{k}{m}\dot{\theta} - g . sin(\theta) \right) \vec{n} = \vec{0}&lt;br /&gt;
\end{array} \right.
$$&lt;/p&gt;
&lt;p&gt;The first equation for the $\vec{r}$ axis shows internal forces which cancel each other: the weight $\vec{P} = -mg\vec{j}$ which is compensated on the $\vec{r}$ axis by the term $mg\vec{j}.\vec{r}$ from the reaction force which will also compensate for the Centrifugal force $ml\dot{\theta}^2$.&lt;/p&gt;
&lt;p&gt;The second differential equation on the $\vec{n}$ axis allows to solve for the evolution of the angle $\theta$.
It can be made linear with $sin(\theta) \approx \theta$ when the pendulum is up near $0$, or with $sin(\theta) \approx - (\theta - \pi)$ when the pendulum is down near $\pi$.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum-model-rod.png&#34; alt=&#34;non-linear model of the $\theta$ angle evolution derived from the forces projected on the normal $\vec{n}$ axis of the rod. The trolley linear acceleration input is added.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum-model-rod.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Pendulum model for rod rotation&lt;/h4&gt;
&lt;p&gt;non-linear model of the $\theta$ angle evolution derived from the forces projected on the normal $\vec{n}$ axis of the rod. The trolley linear acceleration input is added.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;The linear approximation for $\theta$ in the laplace domain is a $2^{nd}$ order system:
$$ \theta(s) \left ( \frac{1}{w_n^2}s^2 + \frac{2 \zeta}{w_n}s \pm 1 \right ) = 0 $$&lt;/p&gt;
&lt;p&gt;The pendulum transfer function $F_p = \frac{\theta(s)}{E(s)}$ with a null input $E(s) = 1$
$$ F_p(s) = \frac{1}{ \frac{1}{w_n^2}s^2 + \frac{2 \zeta}{w_n}s \pm 1 } $$&lt;/p&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
&lt;div&gt;
The linear term for $sin$ is positive when the pendulum is up when $\theta \approx 0$ (unstable), and negative when pendulum is down when $\theta \approx \pm \pi$ (stable).
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This transfer function is characterized when the pendulum is down by its natural frequency $w_n = \sqrt{ \frac{g}{l} } $, and a damping factor $\zeta$.&lt;/p&gt;
&lt;h2 id=&#34;pendul-identification&#34;&gt;Pendul identification&lt;/h2&gt;
&lt;p&gt;The parameter $l$ could be estimated from the platform mechanical but the damping parameter $\zeta$ (or frictions coefficient $k$) could not be estimated easily from the platform.&lt;/p&gt;
&lt;p&gt;The simulation model is satisfactory when the calculation it performs make realistic prediction.
Experimental measurement is a good method to refine a model and tune its parameters.
In our case, the parameters $l$ and $\zeta$ (or $k$) are identified from the experiment explained below.&lt;/p&gt;
&lt;h3 id=&#34;experimental-logs&#34;&gt;Experimental logs&lt;/h3&gt;
&lt;p&gt;The pendulum is placed on a track (two chairs back to back) so as to be able to make a complete rotation.
Motor are off and the pendulum is released up-side with in the unstable condition ($\theta = -18°$ , $\dot \theta = 0$).&lt;/p&gt;
&lt;p&gt;It oscillates until the damping friction ($\zeta$) stops the free oscillations.&lt;/p&gt;
&lt;p&gt;The $1kHz$ sampled rate gyro and accelerometers values are recorded onboard an &lt;a href=&#34;https://github.com/d-ronin/openlager/wiki&#34;&gt;openlager&lt;/a&gt; board connected on the dsPIC &lt;a href=&#34;#UARTINTERFACE&#34;&gt;UART&lt;/a&gt; interface.&lt;/p&gt;
&lt;h3 id=&#34;simulation-from-logs&#34;&gt;Simulation from logs&lt;/h3&gt;
&lt;p&gt;The measured inertial sensors are then re-used as data source in a Simulink model. $\theta$ angle is reconstructed using an IMU complementary filter algorithm implemented in the quaternion angle representation.&lt;/p&gt;
&lt;p&gt;The pendulum model is initialized with the experimentation initial condition ($\theta = -18°$ , $\dot \theta = 0$). Trolley linear acceleration input is null.
Parameters $l$ and $k$ are iteratively tuned until the model $\hat{\theta}$ angle fit with the measured oscillation $\theta$.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum-identification-theta.png&#34; alt=&#34;$\theta$ angle from free oscillation experiment is compared against two pendulum models. The pendulum is released at time $16.7s$ up side ($18°$) and let free to oscillate. The grey curve is the experimental angle reference reconstructed from inertial sensors measurements. The blue dashed curve is a pendulum model using a linear damping with $k = 0.4$. The red doted curve use a non linear damping with the non linear term -1.1*$sign(\dot{\theta})$ added to the linear damping with $k = 0.17$.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum-identification-theta.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Identification - experimental $\theta$ angle reconstructed from inertial sensors (wide grey curve) vs pendulum model (read and blue dashed curves)&lt;/h4&gt;
&lt;p&gt;$\theta$ angle from free oscillation experiment is compared against two pendulum models. The pendulum is released at time $16.7s$ up side ($18°$) and let free to oscillate. The grey curve is the experimental angle reference reconstructed from inertial sensors measurements. The blue dashed curve is a pendulum model using a linear damping with $k = 0.4$. The red doted curve use a non linear damping with the non linear term -1.1*$sign(\dot{\theta})$ added to the linear damping with $k = 0.17$.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Pendulum Parameters&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Identified Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;$l$&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;$0.45 m$&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;$k$&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;$0.4$&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;$w_n = \sqrt{\frac{g}{l}}$&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;$4.67\ rad.s^{-1}$ ( $0.74 Hz$ or $1.35s$ period )&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;⬆ Identified pendulum parameters&lt;/p&gt;
&lt;h3 id=&#34;validation-and-imu-improvement&#34;&gt;Validation and IMU improvement&lt;/h3&gt;
&lt;p&gt;Parameters $l$ and $k$ can be further validated using the force equation and the estimated pendulum angle $\theta$.&lt;/p&gt;
&lt;p&gt;The IMU input measurements is composed of the rate gyro and the accelerometers data. Magnetometers is not used in this pendulum example.
The IMU input also require the predicted acceleration vector (resp magnetometer is used).
The IMU output the sensor orientation and provides the gravity vector prediction as seen in the sensor estimated attitude (i.e. quaternion angle).&lt;/p&gt;
&lt;p&gt;Comparing the gravity vector predicted with the accelerometers measurement do not match because the sensor measures both the gravity plus the dynamic acceleration induced by the pendulum movements.&lt;/p&gt;
&lt;p&gt;Considering the pendulum principal movement rotation $\theta$, the equations of forces applied on the pendulum derive from $\hat \theta$ a prediction for the dynamic acceleration.
The good match between the predicted acceleration and the experimental measurement confirm somehow the correctness of parameters $l$ and $k$ involved in theses calculations.&lt;/p&gt;
&lt;p&gt;The updated acceleration comprising both a static and dynamic part is fed into the IMU algorithm improving the IMU correction of the rate gyro integration drift even when the pendulum is not static.&lt;/p&gt;
&lt;h1 id=&#34;trolley-model&#34;&gt;Trolley Model&lt;/h1&gt;
&lt;h2 id=&#34;trolley-equations&#34;&gt;Trolley Equations&lt;/h2&gt;
&lt;div class=&#34;alert alert-warning&#34;&gt;
&lt;div&gt;
🚦 Below is under construction 🚧
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The translational movement of the trolley is modeled as a $1^{st}$ order system characterized by its time constant $\tau$.
This dynamic includes the motor dynamics when it is loaded with the trolley considering the pendulum as vertical.&lt;/p&gt;
&lt;p&gt;The model considers as negligible the effect of the pendulum forces (translational and rotational) applied on the trolley.&lt;/p&gt;
&lt;p&gt;$$ x(s) = \frac{1}{\tau s + 1} $$&lt;/p&gt;
&lt;h2 id=&#34;trolley-identification&#34;&gt;Trolley Identification&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Trolley Parameter&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Estimated Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;$\tau$&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;$0.3s$&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The trolley does not have any sensors. No encoder or current sensor are used to control the two motors.
The parameters $\tau$ is &amp;ldquo;guessed&amp;rdquo; in a first step.
In a second step, a $2^{nd}$ inertial sensor board is temporary glued in the middle of the wheel diameter to as the inertial sensor is in the wheel rotation axe.
An identification can be computed from the motor set-point and the wheel movements while the pendulum was actively controlled up by a first feedback loop.&lt;/p&gt;
&lt;p&gt;Still the pendulum model including the trolley is simulated with its feedback loop controller and results are compared against recorded data of the real system running the same feedback loop controller. The simulated pendulum states are re-initialized periodically ($\approx 2s$) with the real pendulum states as the model would diverge otherwise due to perturbations not modeled and model discrepancies. Correctness of the model can be checked between theses periodic re-initialization.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:45%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum-gy91-wheel.jpg&#34; alt=&#34;The angular speed rate of the wheel is measured with one rate gyro form one added GY-91 sensor board. The GY-91 board is hot glued on one pendulum wheel. The pendulum is stabilized with a controller using an estimated trolley model. Four wires from the GY-91 to the microcontroller power the sensor and retrieve sensor data through the I2C bus (2 wires).&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum-gy91-wheel.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Identification of trolley in real inverted pendulum condition.&lt;/h4&gt;
&lt;p&gt;The angular speed rate of the wheel is measured with one rate gyro form one added GY-91 sensor board. The GY-91 board is hot glued on one pendulum wheel. The pendulum is stabilized with a controller using an estimated trolley model. Four wires from the GY-91 to the microcontroller power the sensor and retrieve sensor data through the I2C bus (2 wires).&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h1 id=&#34;controller&#34;&gt;Controller&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;Stabilization overview:&lt;/code&gt; The microcontroller computes the angle of the pendulum from the inertial sensor measurements (accelerometers and rate gyro). A feedback loop stabilizes the pendulum up right while maintaining the pendulum position still. The pendulum translation is estimated through an internal dynamic model of the trolley stimulated with a copy of the DC motor command. The pendulum slow translations reflect the drift of the internal estimation of the displacement.&lt;/p&gt;
&lt;h2 id=&#34;linearized-model&#34;&gt;Linearized model&lt;/h2&gt;
&lt;h2 id=&#34;lqr-feedback-controller&#34;&gt;LQR feedback controller&lt;/h2&gt;
&lt;p&gt;Video of the inverted Pendulum when it encounters a wall:
&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
&lt;iframe src=&#34;//player.vimeo.com/video/309876329&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;!-- You tube alternative:
&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
&lt;iframe src=&#34;//www.youtube.com/embed/xbu4hXOnemE&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; allowfullscreen title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
&lt;/div&gt;
--&gt;&lt;/p&gt;
&lt;p&gt;Another way to stabilize a pendulum with an electric see-saw (&lt;a href=&#34;https://sciencedemonstrations.fas.harvard.edu/presentations/inverted-pendulum&#34;&gt;video&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&#34;footnotes&#34;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:DIY&#34;&gt;Do It Yourself
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:DIY&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:LQR&#34;&gt;Linear Quadratic Regulator
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:LQR&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:DoF&#34;&gt;Degree of Freedom
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:DoF&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:IMU&#34;&gt;Inertial Measurement Unit
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:IMU&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>Prototypage Rapide avec Simulink sur dsPIC</title><link>https://lubin.kerhuel.eu/slides/slides_dcmotor_insa/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/slides/slides_dcmotor_insa/</guid><description>
&lt;h1 id=&#34;prototypage-rapide&#34;&gt;Prototypage rapide&lt;/h1&gt;
&lt;h2 id=&#34;avec-simulink-sur-dspic&#34;&gt;avec Simulink sur dsPIC&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.microchip.com/SimulinkBlocks&#34;&gt;MPLAB device blocks for Simulink&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://lubin.kerhuel.eu/&#34;&gt;L.Kerhuel&lt;/a&gt; &amp;amp; &lt;a href=&#34;http://www.ctrl-elec.fr/&#34;&gt;R.Delpoux&lt;/a&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;pendule-inverse-docs-inverted-pendulum&#34;&gt;&lt;a href=&#34;https://lubin.kerhuel.eu/docs/inverted-pendulum/&#34;&gt;Pendule inverse&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;./Inverted_Pendulum_ControlLoopCloseUp.png&#34; alt=&#34;./Inverted_Pendulum_ControlLoopCloseUp.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./Model_Hardware_Test_withSampleTime.png&#34; alt=&#34;./Model_Hardware_Test_withSampleTime.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./Picooz_IdentificatoinBlockPresentation.png&#34; alt=&#34;./Picooz_IdentificatoinBlockPresentation.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;C:/M91449/MCHP_Blockset/Developpements/2013_08_19_Masters2013/Fig/Video_Logs_Shirp.avi&#34;&gt;Video&lt;/a&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./Picooz_Identificatoin_eq_01.png&#34; alt=&#34;./Picooz_Identificatoin_eq_01.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./Picooz_Identificatoin_eq_02.png&#34; alt=&#34;./Picooz_Identificatoin_eq_02.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./Picooz_SuperTwistingController.png&#34; alt=&#34;./Picooz_SuperTwistingController.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;section data-noprocess data-shortcode-slide
data-background-color=&#34;#FFFFFF&#34;
&gt;
&lt;p&gt;&lt;img src=&#34;./Picooz_SetpLarge_ClosedLoop_SimuVsReal.png&#34; alt=&#34;./Picooz_SetpLarge_ClosedLoop_SimuVsReal.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;plan&#34;&gt;Plan:&lt;/h2&gt;
&lt;p&gt;Modèle de simulation &amp;amp; génération de code&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Différences Temporel&lt;/li&gt;
&lt;li&gt;optimisation et type de données&lt;/li&gt;
&lt;li&gt;blocks et fonctionnalités Simulink&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class=&#34;notes&#34;&gt;
dSPACE
&lt;/aside&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;aspect-temporel&#34;&gt;Aspect Temporel:&lt;/h2&gt;
&lt;h3 id=&#34;simulation&#34;&gt;Simulation&lt;/h3&gt;
&lt;p&gt;Modélisation en temps continue, transformé de Laplace dans le domaine p (ou s)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Solver résout les équations différentielles&lt;/li&gt;
&lt;li&gt;Pas de contrainte temps réelle&lt;/li&gt;
&lt;li&gt;Résultat dépend du solveur ; pas de calcul variable.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;aspect-temporel-1&#34;&gt;Aspect Temporel:&lt;/h2&gt;
&lt;h3 id=&#34;implémentation&#34;&gt;Implémentation&lt;/h3&gt;
&lt;p&gt;Implémentation en temps discret avec un pas de calcul fixe&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pas de solveur&lt;/li&gt;
&lt;li&gt;Contrainte temps réel&lt;/li&gt;
&lt;li&gt;Single-Rate &amp;amp; Multi-Rate&lt;/li&gt;
&lt;li&gt;Single-Tasking &amp;amp; Multi-Tasking&lt;/li&gt;
&lt;/ul&gt;
&lt;section data-background-image=&#34;./Scope_SingleTasking_70MIPS.png&#34; data-background-opacity=0.06 data-background-position=&#34;center&#34; &gt;
&lt;/section&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;discrete-times&#34;&gt;Discrete times&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Single-rate&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Les blocks ont tous la même période d&amp;rsquo;exécution
(Même couleur)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Multi-Rate&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Les blocks peuvent avoir des périodes d&amp;rsquo;exécution différentes
(Schéma multicolore)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;section data-background-image=&#34;./Scope_SingleTasking_70MIPS.png&#34; data-background-opacity=0.06 data-background-position=&#34;center&#34; &gt;
&lt;/section&gt;
&lt;hr /&gt;
&lt;h4 id=&#34;modèle-multi-rate&#34;&gt;Modèle multi-rate&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;./Model_Hardware_Test_withSampleTime.png&#34; alt=&#34;./Model_Hardware_Test_withSampleTime.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h4 id=&#34;charge-cpu-d-un-modèle-multi-rate-single-tasking-70-mips&#34;&gt;Charge CPU d&amp;rsquo;un modèle multi-rate single-tasking (@70 mips)&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;./Scope_SingleTasking_70MIPS.png&#34; alt=&#34;./Scope_SingleTasking_70MIPS.png&#34; /&gt;&lt;/p&gt;
&lt;section data-background-image=&#34;./Scope_SingleTasking_70MIPS.png&#34; data-background-opacity=0.06 data-background-position=&#34;center&#34; &gt;
&lt;/section&gt;
&lt;hr /&gt;
&lt;h4 id=&#34;charge-cpu-d-un-modèle-multi-rate-single-tasking-20-mips&#34;&gt;Charge CPU d&amp;rsquo;un modèle multi-rate single-tasking (@20 mips)&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;./Scope_SingleTasking_20MIPS.png&#34; alt=&#34;./Scope_SingleTasking_20MIPS.png&#34; /&gt;&lt;/p&gt;
&lt;section data-background-image=&#34;./Scope_SingleTasking_20MIPS.png&#34; data-background-opacity=0.06 data-background-position=&#34;center&#34; &gt;
&lt;/section&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;single-tasking&#34;&gt;Single-Tasking&lt;/h2&gt;
&lt;p&gt;Single-Tasking: Dans le slot de temps, l&amp;rsquo;exécution de tous les blocks doit se terminer avant la fin du slot.&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;multi-tasking&#34;&gt;Multi-Tasking&lt;/h2&gt;
&lt;p&gt;Multi-Tasking: Préemption possible -&amp;gt; &lt;strong&gt;Monotonic Rate Scheduler&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;La tâche la plus fréquente à la priorité maximale
&lt;ul&gt;
&lt;li&gt;Préemptera une tache plus lente&lt;/li&gt;
&lt;li&gt;Beaucoup plus flexible&lt;/li&gt;
&lt;li&gt;Mode par défaut (voir options du solveur)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h4 id=&#34;charge-cpu-d-un-modèle-multi-rate-single-tasking-70-mips-1&#34;&gt;Charge CPU d&amp;rsquo;un modèle multi-rate single-tasking (@70 mips)&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;./Scope_MultiTasking_70MIPS.png&#34; alt=&#34;./Scope_MultiTasking_70MIPS.png&#34; /&gt;&lt;/p&gt;
&lt;section data-background-image=&#34;./Scope_MultiTasking_70MIPS.png&#34; data-background-opacity=0.06 data-background-position=&#34;center&#34; &gt;
&lt;/section&gt;
&lt;hr /&gt;
&lt;h4 id=&#34;charge-cpu-d-un-modèle-multi-rate-single-tasking-20-mips-1&#34;&gt;Charge CPU d&amp;rsquo;un modèle multi-rate single-tasking (@20 mips)&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;./Scope_MultiTasking_20MIPS.png&#34; alt=&#34;./Scope_MultiTasking_20MIPS.png&#34; /&gt;&lt;/p&gt;
&lt;section data-background-image=&#34;./Scope_MultiTasking_20MIPS.png&#34; data-background-opacity=0.06 data-background-position=&#34;center&#34; &gt;
&lt;/section&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;tasking-conclusion&#34;&gt;Tasking Conclusion&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Single-Tasking @ 20 MIPS -&amp;gt; &lt;strong&gt;Overload&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;dispatcher la tache la plus lente sur plusieurs slots&lt;/li&gt;
&lt;li&gt;(option d&amp;rsquo;offset dans &lt;strong&gt;Time Step&lt;/strong&gt; -&amp;gt; &lt;em&gt;[.001 .005])&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Multi-Tasking @ 20 MIPS -&amp;gt; &lt;strong&gt;Ok&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Rate transfert block options
&lt;ul&gt;
&lt;li&gt;Data Integrity&lt;/li&gt;
&lt;li&gt;Deterministic data transfert&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h1 id=&#34;optimisation&#34;&gt;Optimisation&lt;/h1&gt;
&lt;h2 id=&#34;type-de-données&#34;&gt;type de données&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Virgule Fixe&lt;/li&gt;
&lt;li&gt;Virgule Flottante&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./FloatFixed_1.png&#34; alt=&#34;./FloatFixed_1.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;flotant&#34;&gt;Flotant&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;IEEE 754&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Single&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Double&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Format width&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Sign bit&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;exponent width&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Precision width&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;23+1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;52+1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;1st bit of the significand is always 1. Phantom bit&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;custom-8-bit-floating-point&#34;&gt;Custom 8 bit Floating point&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Parameter&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Single&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Double&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Custom&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Format width&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;32&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;64&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Sign bit&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;exponent width&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;8&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;11&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Precision width&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;23+1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;52+1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3+1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./FloatFixed_2.png&#34; alt=&#34;./FloatFixed_2.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./FloatFixed_3.png&#34; alt=&#34;./FloatFixed_3.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./FloatFixed_4.png&#34; alt=&#34;./FloatFixed_4.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;script-matlab-pour-tester-un-flottant-8-bits&#34;&gt;Script Matlab pour tester un flottant 8 bits&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-MATLAB&#34;&gt;% 4 bit exponent (signed)
emin = -7; emax = 6;
% 3 bits significand
p = 3;
exps = 2.^[emin:emax];
vals = (2^p) + [0:(2^p-1)]; % significand with leading 1
TotalVal = vals&#39;*exps;
% add denormalized values
8bitFloat = unique([TotalVal ; 2^emin * [0:(2^m-1)]&#39;]);
8bitFloat = unique(flipud(-TotalVal) ;TotalVal]); % with neg vals
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
&lt;h1 id=&#34;simulink&#34;&gt;Simulink&lt;/h1&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;data-type&#34;&gt;Data-type&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;./Simulink_TypeCast_FixPtFormat.png&#34; alt=&#34;./Simulink_TypeCast_FixPtFormat.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;datatype&#34;&gt;Datatype&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;int8&amp;hellip;uint23&lt;/li&gt;
&lt;li&gt;fixdt(1,16,15)
&lt;ul&gt;
&lt;li&gt;Scaling is En15 (Exp neg)&lt;/li&gt;
&lt;li&gt;$$\rightarrow 2^-15$$&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;fixdt(1,16)
&lt;ul&gt;
&lt;li&gt;signed (1)&lt;/li&gt;
&lt;li&gt;16 bit width&lt;/li&gt;
&lt;li&gt;Scaling is derived from min &amp;amp; max&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;datatype-1&#34;&gt;Datatype&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;./Simulink_TypeCast_SlopeAndBias.png&#34; alt=&#34;./Simulink_TypeCast_SlopeAndBias.png&#34; /&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;fixdt(1,16,.01,0)
&lt;ul&gt;
&lt;li&gt;Scaling is sfix16&lt;strong&gt;Sp&lt;/strong&gt;01&lt;/li&gt;
&lt;li&gt;Slope point 01&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./Simulink_TypeCast_SlopeAndBias_Sat.png&#34; alt=&#34;./Simulink_TypeCast_SlopeAndBias_Sat.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h1 id=&#34;tp&#34;&gt;TP&lt;/h1&gt;
&lt;h2 id=&#34;https-www-ctrl-elec-fr&#34;&gt;&lt;a href=&#34;https://www.ctrl-elec.fr&#34;&gt;https://www.ctrl-elec.fr&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://lubin.kerhuel.eu/slides/slides_dcmotor_insa&#34;&gt;https://lubin.kerhuel.eu/slides/slides_dcmotor_insa&lt;/a&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;elements-de-correction&#34;&gt;Elements de correction&lt;/h2&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./TP_Correction_OpAmp.png&#34; alt=&#34;./TP_Correction_OpAmp.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./TP_Correction_ADC.png&#34; alt=&#34;./TP_Correction_ADC.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;pwm-settings&#34;&gt;PWM settings&lt;/h2&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./TP_Correction_PWM_Main.png&#34; alt=&#34;./TP_Correction_PWM_Main.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./TP_Correction_PWM_02.png&#34; alt=&#34;./TP_Correction_PWM_02.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./TP_Correction_PWM_03.png&#34; alt=&#34;./TP_Correction_PWM_03.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./TP_Correction_PWM_04.png&#34; alt=&#34;./TP_Correction_PWM_04.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img src=&#34;./TP_Correction_PWM_05.png&#34; alt=&#34;./TP_Correction_PWM_05.png&#34; /&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;liens&#34;&gt;Liens:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;MPLAB device blocks for Simulink:
&lt;a href=&#34;https://www.microchip.com/SimulinkBlocks&#34;&gt;https://www.microchip.com/SimulinkBlocks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;MPLAB X:
&lt;a href=&#34;https://www.microchip.com/MPLABX&#34;&gt;https://www.microchip.com/MPLABX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;XC16:
&lt;a href=&#34;https://www.microchip.com/XC16&#34;&gt;https://www.microchip.com/XC16&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://lubin.kerhuel.eu&#34;&gt;https://lubin.kerhuel.eu&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;http://www.ctrl-elec.fr&#34;&gt;http://www.ctrl-elec.fr&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>test slides</title><link>https://lubin.kerhuel.eu/slides/testslides/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/slides/testslides/</guid><description>
&lt;h1 id=&#34;test-slides&#34;&gt;Test slides&lt;/h1&gt;
&lt;hr /&gt;
&lt;section data-shortcode-section&gt;
# Vertical slide 1
&lt;/section&gt;
&lt;section data-shortcode-section&gt;
# Vertical slide 2
&lt;/section&gt;
&lt;hr /&gt;
&lt;section data-background-iframe=&#34;https://www.youtube.com/embed/algBpBeQIOY?autoplay=1&amp;controls=1&amp;showinfo=0&amp;autohide=1&amp;rel=0&amp;modestbranding=1&amp;loop=&amp;start=0&#34; data-background-opacity=0.06 data-background-repeat=&#34;repeat&#34;&gt;
&lt;/section&gt;
&lt;h1 id=&#34;my-title&#34;&gt;My Title !&lt;/h1&gt;
&lt;hr /&gt;
&lt;section data-noprocess data-shortcode-slide
data-background-iframe=&#34;https://www.youtube.com/embed/algBpBeQIOY?autoplay=1&amp;amp;controls=1&amp;amp;showinfo=0&amp;amp;autohide=1&#34;
data-background-opacity=&#34;0.1&#34;
data-backgroundTransition=&#34;none&#34;
&gt;
&lt;hr /&gt;
&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
&lt;iframe src=&#34;//www.youtube.com/embed/algBpBeQIOY?autoplay=1&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; allowfullscreen title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;p&gt;mes notes&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;controls&#34;&gt;Controls&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Next: &lt;code&gt;Right Arrow&lt;/code&gt; or &lt;code&gt;Space&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Previous: &lt;code&gt;Left Arrow&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Start: &lt;code&gt;Home&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Finish: &lt;code&gt;End&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Overview: &lt;code&gt;Esc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Speaker notes: &lt;code&gt;S&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Fullscreen: &lt;code&gt;F&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Zoom: &lt;code&gt;Alt + Click&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/hakimel/reveal.js#pdf-export&#34;&gt;PDF Export&lt;/a&gt;: &lt;code&gt;E&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;code-highlighting&#34;&gt;Code Highlighting&lt;/h2&gt;
&lt;p&gt;Inline code: &lt;code&gt;variable&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Code block:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;porridge = &amp;quot;blueberry&amp;quot;
if porridge == &amp;quot;blueberry&amp;quot;:
print(&amp;quot;Eating...&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;math&#34;&gt;Math&lt;/h2&gt;
&lt;p&gt;In-line math: $x + y = z$&lt;/p&gt;
&lt;p&gt;Block math:&lt;/p&gt;
&lt;p&gt;$$
f\left( x \right) = \;\frac{{2\left( {x + 4} \right)\left( {x - 4} \right)}}{{\left( {x + 4} \right)\left( {x + 1} \right)}}
$$&lt;/p&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;fragments&#34;&gt;Fragments&lt;/h2&gt;
&lt;p&gt;Make content appear incrementally&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{{% fragment %}} One {{% /fragment %}}
{{% fragment %}} **Two** {{% /fragment %}}
{{% fragment %}} Three {{% /fragment %}}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Press &lt;code&gt;Space&lt;/code&gt; to play!&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;fragment &#34; &gt;
One
&lt;/span&gt;
&lt;span class=&#34;fragment &#34; &gt;
&lt;strong&gt;Two&lt;/strong&gt;
&lt;/span&gt;
&lt;span class=&#34;fragment &#34; &gt;
Three
&lt;/span&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;A fragment can accept two optional parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;class&lt;/code&gt;: use a custom style (requires definition in custom CSS)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;weight&lt;/code&gt;: sets the order in which a fragment appears&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;speaker-notes&#34;&gt;Speaker Notes&lt;/h2&gt;
&lt;p&gt;Add speaker notes to your presentation&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-markdown&#34;&gt;{{% speaker_note %}}
- Only the speaker can read these notes
- Press `S` key to view
{{% /speaker_note %}}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Press the &lt;code&gt;S&lt;/code&gt; key to view the speaker notes!&lt;/p&gt;
&lt;aside class=&#34;notes&#34;&gt;
&lt;ul&gt;
&lt;li&gt;Only the speaker can read these notes&lt;/li&gt;
&lt;li&gt;Press &lt;code&gt;S&lt;/code&gt; key to view&lt;/li&gt;
&lt;/ul&gt;
&lt;/aside&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;themes&#34;&gt;Themes&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;black: Black background, white text, blue links (default)&lt;/li&gt;
&lt;li&gt;white: White background, black text, blue links&lt;/li&gt;
&lt;li&gt;league: Gray background, white text, blue links&lt;/li&gt;
&lt;li&gt;beige: Beige background, dark text, brown links&lt;/li&gt;
&lt;li&gt;sky: Blue background, thin dark text, blue links&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;ul&gt;
&lt;li&gt;night: Black background, thick white text, orange links&lt;/li&gt;
&lt;li&gt;serif: Cappuccino background, gray text, brown links&lt;/li&gt;
&lt;li&gt;simple: White background, black text, blue links&lt;/li&gt;
&lt;li&gt;solarized: Cream-colored background, dark green text, blue links&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;section data-noprocess data-shortcode-slide
data-background-image=&#34;/img/boards.jpg&#34;
&gt;
&lt;h2 id=&#34;custom-slide&#34;&gt;Custom Slide&lt;/h2&gt;
&lt;p&gt;Customize the slide style and background&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-markdown&#34;&gt;{{&amp;lt; slide background-image=&amp;quot;/img/boards.jpg&amp;quot; &amp;gt;}}
{{&amp;lt; slide background-color=&amp;quot;#0000FF&amp;quot; &amp;gt;}}
{{&amp;lt; slide class=&amp;quot;my-style&amp;quot; &amp;gt;}}
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
&lt;h2 id=&#34;custom-css-example&#34;&gt;Custom CSS Example&lt;/h2&gt;
&lt;p&gt;Let&amp;rsquo;s make headers navy colored.&lt;/p&gt;
&lt;p&gt;Create &lt;code&gt;assets/css/reveal_custom.css&lt;/code&gt; with:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-css&#34;&gt;.reveal section h1,
.reveal section h2,
.reveal section h3 {
color: navy;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;hr /&gt;
&lt;h1 id=&#34;questions&#34;&gt;Questions?&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://discourse.gohugo.io&#34;&gt;Ask&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://sourcethemes.com/academic/docs/&#34;&gt;Documentation&lt;/a&gt;&lt;/p&gt;
&lt;hr /&gt;</description></item></channel></rss>