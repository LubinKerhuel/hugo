<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rapid Control Prototyping</title><link>https://lubin.kerhuel.eu/</link><atom:link href="https://lubin.kerhuel.eu/index.xml" rel="self" type="application/rss+xml"/><description>Rapid Control Prototyping</description><generator>Hugo Blox Builder (https://hugoblox.com)</generator><language>en-us</language><lastBuildDate>Sun, 11 Oct 2020 00:00:00 +0000</lastBuildDate><image><url>https://lubin.kerhuel.eu/media/icon_hu_7804b255830ce5f.png</url><title>Rapid Control Prototyping</title><link>https://lubin.kerhuel.eu/</link></image><item><title>block receiver &amp; telemetry: S.BUS, Smart Port, F.Port</title><link>https://lubin.kerhuel.eu/uxv/block-receiver-telemetry/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/uxv/block-receiver-telemetry/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;p&gt;Three blocks add support for three protocol found in receivers. Traditional PWM output receiver can be handled directly through the Input Capture or Change Notification peripheral and do not required a specific block.&lt;/p&gt;
&lt;h2 id="sbus-smart-port-and-fport"&gt;S.BUS, Smart Port and F.Port&lt;/h2&gt;
&lt;p&gt;S.BUS, Smart Port (also named S.Port) and F.Port are three protocol available in FrSky RC receiver and compatible. All three protocol rely on the UART peripheral with different settings. Their purpose is specific:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;S.BUS&lt;/strong&gt; is a unidirectional protocol from the receiver to an external device to provide channels values and RSSI&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; (i.e. radio link quality).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Smart Port (S.Port)&lt;/strong&gt; is a bidirectional protocol. The receiver ping for various connected sensors and retrieve measurements to send through telemetry to the remote control.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;F.Port&lt;/strong&gt; is a bidirectional protocol where the receiver communicate channels values and RSSI, and get values from connected sensors to send through telemetry to the remote control.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The two bidirectional protocol &lt;em&gt;Smart Port&lt;/em&gt; and &lt;em&gt;F.Port&lt;/em&gt; use one single wire for Tx and Rx. Communication is done in Half duplex mode.&lt;/p&gt;
&lt;p&gt;FrSky receiver have two variants: (model shipped with Smart port: x4r, rx4r, x6r, s6r, rx6r, x8r, s8r, xsr, xsr-m, r-xsr &amp;hellip;)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;S.Bus &amp;amp; Smart Port&lt;/strong&gt; (stock), available on two distinct three pins ports&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;F.Port&lt;/strong&gt; available on one replaced Smart Port three pin port&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Stock receiver have two ports: S.BUS and Smart Port. This is changed for a unique F.Port by flashing an alternative firmware provided by &lt;a href="https://www.frsky-rc.com/" target="_blank" rel="noopener"&gt;FrSky&lt;/a&gt;. The alternative firmware remove the S.BUS port and convert the Smart Port to an F.Port.&lt;/p&gt;
&lt;h3 id="uart-settings-and-implementation"&gt;UART settings and implementation&lt;/h3&gt;
&lt;p&gt;S.BUS, S.Port and F.Port have different UART setting defined in the table:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th style="text-align: center"&gt;Baudrate&lt;/th&gt;
&lt;th style="text-align: center"&gt;Duplex&lt;/th&gt;
&lt;th style="text-align: center"&gt;Logic&lt;/th&gt;
&lt;th style="text-align: center"&gt;parity&lt;/th&gt;
&lt;th style="text-align: center"&gt;stop-bit&lt;/th&gt;
&lt;th style="text-align: center"&gt;flow-ctrl&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;S.BUS&lt;/td&gt;
&lt;td style="text-align: center"&gt;100000&lt;/td&gt;
&lt;td style="text-align: center"&gt;Rx only&lt;/td&gt;
&lt;td style="text-align: center"&gt;3.3V inverted&lt;/td&gt;
&lt;td style="text-align: center"&gt;even&lt;/td&gt;
&lt;td style="text-align: center"&gt;2&lt;/td&gt;
&lt;td style="text-align: center"&gt;no&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Smart Port&lt;/td&gt;
&lt;td style="text-align: center"&gt;57600&lt;/td&gt;
&lt;td style="text-align: center"&gt;&lt;strong&gt;Half&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: center"&gt;3.3V inverted&lt;/td&gt;
&lt;td style="text-align: center"&gt;no&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;td style="text-align: center"&gt;no&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;F.Port&lt;/td&gt;
&lt;td style="text-align: center"&gt;115200&lt;/td&gt;
&lt;td style="text-align: center"&gt;&lt;strong&gt;Half&lt;/strong&gt;&lt;/td&gt;
&lt;td style="text-align: center"&gt;3.3V inverted&lt;/td&gt;
&lt;td style="text-align: center"&gt;no&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;td style="text-align: center"&gt;no&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Implementation on dsPIC with the MPLAB block for Simulink was successfully used with the implementation below set through the UART Configuration block:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th style="text-align: center"&gt;Implementation&lt;/th&gt;
&lt;th style="text-align: center"&gt;Buffer size&lt;/th&gt;
&lt;th style="text-align: center"&gt;Interrupt priority&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;S.BUS Rx&lt;/td&gt;
&lt;td style="text-align: center"&gt;Circular Buffer&lt;/td&gt;
&lt;td style="text-align: center"&gt;64&lt;/td&gt;
&lt;td style="text-align: center"&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;S.BUS Tx&lt;/td&gt;
&lt;td style="text-align: center"&gt;None&lt;/td&gt;
&lt;td style="text-align: center"&gt;-&lt;/td&gt;
&lt;td style="text-align: center"&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Smart Port Rx&lt;/td&gt;
&lt;td style="text-align: center"&gt;Circular Buffer&lt;/td&gt;
&lt;td style="text-align: center"&gt;32&lt;/td&gt;
&lt;td style="text-align: center"&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Smart Port Tx&lt;/td&gt;
&lt;td style="text-align: center"&gt;Circular Buffer&lt;/td&gt;
&lt;td style="text-align: center"&gt;32&lt;/td&gt;
&lt;td style="text-align: center"&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;F.Port Rx&lt;/td&gt;
&lt;td style="text-align: center"&gt;Circular Buffer&lt;/td&gt;
&lt;td style="text-align: center"&gt;32&lt;/td&gt;
&lt;td style="text-align: center"&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;F.Port Tx&lt;/td&gt;
&lt;td style="text-align: center"&gt;Circular Buffer&lt;/td&gt;
&lt;td style="text-align: center"&gt;64&lt;/td&gt;
&lt;td style="text-align: center"&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="connecting-sbus-smart-port-and-fport-simulink-blocks-to-uart-rx--tx"&gt;Connecting S.BUS, Smart Port and F.Port simulink blocks to UART Rx &amp;amp; Tx&lt;/h3&gt;
&lt;p&gt;S.Bus, F.Port and Smart Port xxx takes receiver output stream to extract control values sent by the remote. The input stream is a vector which length is defined by end user. All values of the vector do not have to be set. The block use the N input length scalar to know how many bytes from the input vector are received values and must be processed. The block input vector can received partial data packet. The whole receiver packet can be sliced over time and sent as values are received by the MCU ; these blocks reconstruct the packet before processing it.&lt;/p&gt;
&lt;h2 id="sbus-protocol"&gt;S.BUS protocol&lt;/h2&gt;
&lt;p&gt;UART Configuration:&lt;/p&gt;
&lt;p&gt;Only Rx channel is used with the following parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;100 000 bauds/s&lt;/li&gt;
&lt;li&gt;Rx inverted logic (Idle state is low level), 3.3V&lt;/li&gt;
&lt;li&gt;Even parity&lt;/li&gt;
&lt;li&gt;2 stop bits&lt;/li&gt;
&lt;li&gt;No control flow&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Rx is implemented with a Circular Buffer with 64 bytes buffer and interrupt priority 5.&lt;/p&gt;
&lt;p&gt;UART Rx block is sampled at 1kHz (1ms).
Vector output size set to &amp;ldquo;inherited via internal rule&amp;rdquo; is given a value of 10 (no more than 10 bytes can be received in 1 ms at 100000 bauds/s with two stop bits)&lt;/p&gt;
&lt;p&gt;The S.BUS block GUI allows to set which block output shoudl be decoded and the scaling for each channels decoded.&lt;/p&gt;
&lt;div class="box" style="max-width:40%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/uxv-block-sbus-gui-control-frame.png" loading="lazy" alt="This simulink block decode S.BUS input stream. Scaling for output RC channels can be selected for each channels."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/uxv-block-sbus-gui-control-frame.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Simulink S.BUS block user interface&lt;/h4&gt;
&lt;p&gt;This simulink block decode S.BUS input stream. Scaling for output RC channels can be selected for each channels.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/uxv-block-sbus-scheme-uart-connection.png" loading="lazy" alt="Scheme to decode S.BUS for use in a dsPIC"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/uxv-block-sbus-scheme-uart-connection.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Scheme of the UART Rx block connected to the S.BUS block.&lt;/h4&gt;
&lt;p&gt;Scheme to decode S.BUS for use in a dsPIC&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/uxv-block-sbus-sport-channels-scaling.png" loading="lazy" alt="raw values from S.BUS are not centered and scaled with power of 2."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/uxv-block-sbus-sport-channels-scaling.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Scheme to center and scale S.BUS channels output within [-1000 1000]&lt;/h4&gt;
&lt;p&gt;raw values from S.BUS are not centered and scaled with power of 2.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id="smart-port-protocol"&gt;Smart Port protocol&lt;/h2&gt;
&lt;p&gt;Smart Port (S.Port) use UART where Rx and Tx pins are set on the same pin with inverted logic (1 is high level). One single wire is used in half duplex communication mode.&lt;/p&gt;
&lt;p&gt;UART configuration setting:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;57600 bauds/s&lt;/li&gt;
&lt;li&gt;Half duplex&lt;/li&gt;
&lt;li&gt;Rx and Tx inverted logic (Idle state is low level), 3.3V&lt;/li&gt;
&lt;li&gt;No parity&lt;/li&gt;
&lt;li&gt;1 stop bit&lt;/li&gt;
&lt;li&gt;No control flow&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Implementation:&lt;/p&gt;
&lt;p&gt;Rx is implemented with a Circular Buffer with 32 bytes buffer and interrupt priority 5.&lt;br&gt;
Tx is implemented with a circular buffer with 32 bytes buffer and interrupt priority 6.&lt;/p&gt;
&lt;p&gt;The Smart port block decode inputs from the receiver and from other sensors connected to the one wire bus.&lt;/p&gt;
&lt;p&gt;If a sensor frame is received, it is decoded and values are available at the block output.&lt;/p&gt;
&lt;p&gt;When a receiver request for one sensor Id is received and if this sensor Id is set in one of the sensor block of the model, then the Smart port block generates the sensor frame with the latest values set in the sensor block.
The message is sent through an UART Tx block.&lt;/p&gt;
&lt;h2 id="fport-protocol"&gt;F.Port protocol&lt;/h2&gt;
&lt;div class="box" style="max-width:40%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/uxv-block-fport-gui-control-frame.png" loading="lazy" /&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/uxv-block-fport-gui-control-frame.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/uxv-block-fport-scheme-uart-connection.png" loading="lazy" /&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/uxv-block-fport-scheme-uart-connection.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="gallery caption-position-bottom caption-effect-slide hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery"&gt;
&lt;div class="box" &gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img" style="background-image: url('/img/uxv-block-rc-pwm-gui.png');"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/uxv-block-rc-pwm-gui.png" loading="lazy" alt="caption"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/uxv-block-rc-pwm-gui.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Title&lt;/h4&gt;
&lt;p&gt;caption&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" &gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img" style="background-image: url('/img/uxv-block-rc-pwm-input-scaling.png');"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/uxv-block-rc-pwm-input-scaling.png" loading="lazy" alt="caption"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/uxv-block-rc-pwm-input-scaling.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;title&lt;/h4&gt;
&lt;p&gt;caption&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;UART configuration:
Rx and Tx channels are used. They are assigned to the same pin. UART is configured for to half duplex.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;115200 bauds/s&lt;/li&gt;
&lt;li&gt;Half duplex&lt;/li&gt;
&lt;li&gt;Rx and Tx inverted logic (Idle state is low level), 3.3V&lt;/li&gt;
&lt;li&gt;No parity&lt;/li&gt;
&lt;li&gt;1 stop bit&lt;/li&gt;
&lt;li&gt;No control flow&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Rx is implemented with a Circular Buffer with 32 bytes buffer and interrupt priority 5.&lt;/p&gt;
&lt;p&gt;Tx is implemented with a circular buffer with 64 bytes buffer and interrupt priority 5.&lt;/p&gt;
&lt;h3 id="ressources"&gt;Ressources&lt;/h3&gt;
&lt;p&gt;FrSky protocol are not always documented. The following website helped understanding the various protocol:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.robotmaker.eu/home/quadcopters-360-degree-proximity-sensing-project-overview/frsky-s-port-interface" target="_blank" rel="noopener"&gt;Smart Port on ROBOTmaker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://code.google.com/archive/p/telemetry-convert/wikis/FrSkySPortProtocol.wiki" target="_blank" rel="noopener"&gt;Smart Port on telemetry-convert project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/yaapu/FrskyTelemetryScript/wiki/FrSky-SPort-protocol-specs" target="_blank" rel="noopener"&gt;Smart Port TelemetryScript by Allesandro Apostoli&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/bolderflight/SBUS" target="_blank" rel="noopener"&gt;S.BUS on Arduino lib project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/athertop/MavLink_FrSkySPort/wiki" target="_blank" rel="noopener"&gt;Smart Port on MavLink-FrSkySPort project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/betaflight/betaflight/tree/master/src/main/telemetry" target="_blank" rel="noopener"&gt;betaflight source code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ardupilot.org/copter/docs/common-frsky-passthrough.html" target="_blank" rel="noopener"&gt;ArduCopter project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://sbustelemetrysensors.blogspot.com/" target="_blank" rel="noopener"&gt;SBUS2 by Jerry Chapman&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Received Signal Strength Indicator&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>block Sensor</title><link>https://lubin.kerhuel.eu/uxv/block-sensor/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/uxv/block-sensor/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css" integrity="sha384-yX+tSqQp3yF8BiTuLLOwNyaqtmZ9yFQT7IYg7U9YU9Dz/JDlh6JJQmNClCmvYl+b" crossorigin="anonymous"&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css" integrity="sha384-R6P/wJIrxjHcm//YCjb0S6rRgebsNn3u6U4NxVI8R03iSPAR5CwPqoq1n6U/tjFE" crossorigin="anonymous"&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js" integrity="sha384-jkeJ/ETDRD/P4Y3I3CQi1QIwrEJjR9GdAZV2/aqDwwgA5ldCNiExYJeBwKyQC/+q" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js" integrity="sha384-HotcxRWS6/oszHPwknjGnd066fV8+ycnO5TXDcOscFWvTtaiCtEEv+9s5Qrn1iJD" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"&gt;
&lt;div class="pswp__bg"&gt;&lt;/div&gt;
&lt;div class="pswp__scroll-wrap"&gt;
&lt;div class="pswp__container"&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__ui pswp__ui--hidden"&gt;
&lt;div class="pswp__top-bar"&gt;
&lt;div class="pswp__counter"&gt;&lt;/div&gt;
&lt;button class="pswp__button pswp__button--close" title="Close (Esc)"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--share" title="Share"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--fs" title="Toggle fullscreen"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--zoom" title="Zoom in/out"&gt;&lt;/button&gt;
&lt;div class="pswp__preloader"&gt;
&lt;div class="pswp__preloader__icn"&gt;
&lt;div class="pswp__preloader__cut"&gt;
&lt;div class="pswp__preloader__donut"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"&gt;
&lt;div class="pswp__share-tooltip"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"&gt;
&lt;/button&gt;
&lt;button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"&gt;
&lt;/button&gt;
&lt;div class="pswp__caption"&gt;
&lt;div class="pswp__caption__center"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The block adds a sensor &amp;ldquo;packet&amp;rdquo; to be transmitted to a receiver through the Smart Port of the F.Port. The receiver send the telemetry packet to the Remote controller (RC). Thus the Simulink should have either a Smart Port or a F.Port block.&lt;/p&gt;
&lt;p&gt;Each sensor block declare the sensor reference composed of the two parameters PhysId and {Address+Offset}. Sensor value is composed of 4 bytes array block input. Multiple instance of the sensor block can be added in a model. Two instance can have the same sensor reference which is used for sensor sending multiple packets with various values (see FrSky FVLSS or GPS sensor).&lt;/p&gt;
&lt;p&gt;Each block instance add a 4 bytes buffer to store the sensor value which is updated at block execution time. The block sample rate defines the update rate of the internal buffer.&lt;/p&gt;
&lt;p&gt;The behaviour vary between Smart Port and F.Port protocol:&lt;/p&gt;
&lt;h3 id="behaviour-with-smart-port"&gt;behaviour with Smart Port&lt;/h3&gt;
&lt;p&gt;The receiver ping the electronics connected on Smart Port for one sensor reference. When a given sensor is ping, it must reply by providing its 4 bytes values within 3ms.&lt;/p&gt;
&lt;p&gt;If more than one instance of the sensor block address the same sensor reference (PhysId, Address+Offset), each blocks data packet are sent one after another.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If a specific sensor Id is ping twice with his (none of his when multiple) block beeing updated in between, the same content is sent again.&lt;/li&gt;
&lt;li&gt;If a sensor block is updated while its previous content has not been sent yet, the block update has no effect and the newer value is lost.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="behaviour-with-fport"&gt;behaviour with F.Port&lt;/h3&gt;
&lt;p&gt;The unique controller connected to the F.Port send a sensor value each RC channel packet received. The sensor to be send depends only on the controller which might send any sensor.&lt;/p&gt;
&lt;p&gt;Each sensor block update add the sensor in a FIFO queue list of sensor request to send.
Only one request for each sensor block instance can be present in this FIFO.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If a sensor block is updated while its previous value has not been sent yet ; this block sensor request to send is still in the FIFO, then the update has no effect and the newer value is lost.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Unlike the Smart Port, a sensor cannot be sent twice without having been updated once first because the sensor is placed in the send request FIFO while being updated.&lt;/p&gt;
&lt;p&gt;for its corresponding sensor
The block update sample rate is selected by end user. whose value will be sent to the receiver. The receiver send then the sensor Id and the corresponding values to the remote through telemetry.&lt;/p&gt;
&lt;p&gt;Communication with the receiver can use either the Smart Port, or the F.Port.&lt;/p&gt;
&lt;p&gt;The sensor PhyId, APPID and APPID Offset variant are set within the block.
The PRIM field must be set to 0X10 for a sensor. The sensor value unit is set within the block.
Block input is the 4 bytes coding for the sensor value.&lt;/p&gt;</description></item><item><title>Replacement motor for Parrot Disco FPV Flying Wing</title><link>https://lubin.kerhuel.eu/post/parrot-disco-motor-replacement/</link><pubDate>Sun, 11 Oct 2020 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/parrot-disco-motor-replacement/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css" integrity="sha384-yX+tSqQp3yF8BiTuLLOwNyaqtmZ9yFQT7IYg7U9YU9Dz/JDlh6JJQmNClCmvYl+b" crossorigin="anonymous"&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css" integrity="sha384-R6P/wJIrxjHcm//YCjb0S6rRgebsNn3u6U4NxVI8R03iSPAR5CwPqoq1n6U/tjFE" crossorigin="anonymous"&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js" integrity="sha384-jkeJ/ETDRD/P4Y3I3CQi1QIwrEJjR9GdAZV2/aqDwwgA5ldCNiExYJeBwKyQC/+q" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js" integrity="sha384-HotcxRWS6/oszHPwknjGnd066fV8+ycnO5TXDcOscFWvTtaiCtEEv+9s5Qrn1iJD" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"&gt;
&lt;div class="pswp__bg"&gt;&lt;/div&gt;
&lt;div class="pswp__scroll-wrap"&gt;
&lt;div class="pswp__container"&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__ui pswp__ui--hidden"&gt;
&lt;div class="pswp__top-bar"&gt;
&lt;div class="pswp__counter"&gt;&lt;/div&gt;
&lt;button class="pswp__button pswp__button--close" title="Close (Esc)"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--share" title="Share"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--fs" title="Toggle fullscreen"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--zoom" title="Zoom in/out"&gt;&lt;/button&gt;
&lt;div class="pswp__preloader"&gt;
&lt;div class="pswp__preloader__icn"&gt;
&lt;div class="pswp__preloader__cut"&gt;
&lt;div class="pswp__preloader__donut"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"&gt;
&lt;div class="pswp__share-tooltip"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"&gt;
&lt;/button&gt;
&lt;button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"&gt;
&lt;/button&gt;
&lt;div class="pswp__caption"&gt;
&lt;div class="pswp__caption__center"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Original motor of my parrot Disco Flying wing is broken after few flights. It is not burned. The CHUCK controller is still ok including the motor power stage. The problem comes from wires connections cut at the interface between motor and power cable. It is difficult to repair as the connection break is just few millimeters from the motor windings.&lt;/p&gt;
&lt;p&gt;The root cause for these wire cuts seems to be vibrations: On the original PF070253 DISCO motor, the power cable is not attached on the motor but directly connected on the thin motor wiring. Vibration of the cable powering the motor is likely to break thin motor wiring at the interface between cable and motor.&lt;/p&gt;
&lt;link rel="stylesheet" href="https://lubin.kerhuel.eu/css/hugo-easy-gallery.css" /&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/parrot-original-motor-front-small.jpg" loading="lazy" alt="Parrot DISCO original PF070253 motor (1280KV) with added connectors - front"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/parrot-original-motor-front.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Parrot DISCO original PF070253 motor (1280KV) with added connectors - front&lt;/h4&gt;
&lt;p&gt;Parrot DISCO original PF070253 motor (1280KV) with added connectors - front&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/parrot-original-motor-back-small.jpg" loading="lazy" alt="Parrot DISCO original PF070253 motor - back"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/parrot-original-motor-back.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Attempt to repair the motor PF070253 of the DISCO FPV&lt;/h4&gt;
&lt;p&gt;Parrot DISCO original PF070253 motor - back&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;The original DISCO motor (PF070253, 1280KV) is difficult to find and out-priced. The SURPASS Hobby C2826 (size 2208) - 1350KV have similar shape and electrical characteristics. It is compatible with the Parrot stock foldable propeller and DISCO wing motor mount. The motor reference is unclear as the motor size correspond to a &amp;ldquo;2208&amp;rdquo; but the motor is stamped (and sold) with reference C2826. Box of the SURPASS Hobby motor mention is &amp;ldquo;C2826 (2208) - 1350KV&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;With this motor upgrade, the DISCO Flying wing is flying as with the original motor. The Parrot CHUCK controller handle motor speed as if it was the original one. Power consumption seems similar than the one with the original motor. It has been tested with the original DISCO propeller.&lt;/p&gt;
&lt;p&gt;I get a propeller replacement candidate in case the original did not fit the motor: the GEMFAN 8040 which fit that motor and has the same size as the stock propeller (Not tested).&lt;/p&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/parrot-surpass-c2826-mount-wires-small.jpg" loading="lazy" alt="Parrot DISCO with SURPASS Hobby C2826 (2208) - 1350KV replacement motor - inside"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/parrot-surpass-c2826-mount-wires.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Parrot DISCO with SURPASS Hobby C2826 (2208) - 1350KV replacement motor - inside&lt;/h4&gt;
&lt;p&gt;Parrot DISCO with SURPASS Hobby C2826 (2208) - 1350KV replacement motor - inside&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/parrot-surpass-c2826-mount-final-small.jpg" loading="lazy" alt="Parrot DISCO with SURPASS Hobby C2826 (2208) - 1350KV replacement motor - detail"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/parrot-surpass-c2826-mount-final.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Parrot DISCO with SURPASS Hobby C2826 (2208) - 1350KV replacement motor - detail&lt;/h4&gt;
&lt;p&gt;Parrot DISCO with SURPASS Hobby C2826 (2208) - 1350KV replacement motor - detail&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;</description></item><item><title>Electric Kombi bike</title><link>https://lubin.kerhuel.eu/post/motorized-kombi-bike/</link><pubDate>Thu, 16 Jan 2020 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/motorized-kombi-bike/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css" integrity="sha384-yX+tSqQp3yF8BiTuLLOwNyaqtmZ9yFQT7IYg7U9YU9Dz/JDlh6JJQmNClCmvYl+b" crossorigin="anonymous"&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css" integrity="sha384-R6P/wJIrxjHcm//YCjb0S6rRgebsNn3u6U4NxVI8R03iSPAR5CwPqoq1n6U/tjFE" crossorigin="anonymous"&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js" integrity="sha384-jkeJ/ETDRD/P4Y3I3CQi1QIwrEJjR9GdAZV2/aqDwwgA5ldCNiExYJeBwKyQC/+q" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js" integrity="sha384-HotcxRWS6/oszHPwknjGnd066fV8+ycnO5TXDcOscFWvTtaiCtEEv+9s5Qrn1iJD" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"&gt;
&lt;div class="pswp__bg"&gt;&lt;/div&gt;
&lt;div class="pswp__scroll-wrap"&gt;
&lt;div class="pswp__container"&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__ui pswp__ui--hidden"&gt;
&lt;div class="pswp__top-bar"&gt;
&lt;div class="pswp__counter"&gt;&lt;/div&gt;
&lt;button class="pswp__button pswp__button--close" title="Close (Esc)"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--share" title="Share"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--fs" title="Toggle fullscreen"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--zoom" title="Zoom in/out"&gt;&lt;/button&gt;
&lt;div class="pswp__preloader"&gt;
&lt;div class="pswp__preloader__icn"&gt;
&lt;div class="pswp__preloader__cut"&gt;
&lt;div class="pswp__preloader__donut"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"&gt;
&lt;div class="pswp__share-tooltip"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"&gt;
&lt;/button&gt;
&lt;button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"&gt;
&lt;/button&gt;
&lt;div class="pswp__caption"&gt;
&lt;div class="pswp__caption__center"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;A KOMBI bike motorized with the TSDZ2 mid drive motor.
The motor firmware is upgraded with the &lt;a href="https://github.com/OpenSource-EBike-firmware/TSDZ2_wiki/wiki" target="_blank" rel="noopener"&gt;TSDZ2 Flexible OpenSource firmware&lt;/a&gt; initiated by Casainho.&lt;/p&gt;
&lt;p&gt;Typically, empty or loaded with two kids; three in rare occasions; 2300km so far with original bike chain and original motor blue gear and clutch.&lt;/p&gt;
&lt;p&gt;The first blue bike (pictures below) uses a 36V motor - 36V battery (battery swing from 33V to 42.4V). A second bike realized with the 48V TSDZ2 motor - 48V battery (swing from 40V to 52V).
The 48V version is more comfortable than the 36V version. With the 36V version, the battery swing does not allows to benefit the full potential of the motor when once it is half empty. This is not noticed with the 48V motor.&lt;/p&gt;
&lt;p&gt;Problems encountered:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2300 km: crank bearing noise.
Seems crank were not tight enough. Noise in warm weather (&amp;gt;15°C) Not changed yet but working fine (it&amp;rsquo;s winter time).&lt;/li&gt;
&lt;/ul&gt;
&lt;link rel="stylesheet" href="https://lubin.kerhuel.eu/css/hugo-easy-gallery.css" /&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-pedal-removal-01.jpg" loading="lazy" alt="Original pedals"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-pedal-removal-01.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Motor Installation (1/3)&lt;/h4&gt;
&lt;p&gt;Original pedals&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-pedal-removal-02.jpg" loading="lazy" alt="Accessing the BSA 68 bottom bracket"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-pedal-removal-02.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Motor Installation (2/3)&lt;/h4&gt;
&lt;p&gt;Accessing the BSA 68 bottom bracket&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-pedal-removal-03.jpg" loading="lazy" alt="BSA 68 bottom bracket"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-pedal-removal-03.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Motor Installation (3/3)&lt;/h4&gt;
&lt;p&gt;BSA 68 bottom bracket&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-motor-installation.jpg" loading="lazy" alt="TSDZ2 lying against the front tube protected by an air tube"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-motor-installation.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;TSDZ2 motor installed&lt;/h4&gt;
&lt;p&gt;TSDZ2 lying against the front tube protected by an air tube&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-battery-installation.jpg" loading="lazy" alt="Battery vertically installed behind the seat"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-battery-installation.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Yuba KOMBI bike equipped with TSDZ2 motor and battery&lt;/h4&gt;
&lt;p&gt;Battery vertically installed behind the seat&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-tracting-bike-01.jpg" loading="lazy" alt="Setup for trailing a BMX race-mini bike (no-one on the BMX). The trailed bike is free to rotate about its steering wheel axis and vertically (up-down) following smoothly the front bike."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-tracting-bike-01.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Yuba KOMBI bike trailing a bike&lt;/h4&gt;
&lt;p&gt;Setup for trailing a BMX race-mini bike (no-one on the BMX). The trailed bike is free to rotate about its steering wheel axis and vertically (up-down) following smoothly the front bike.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-tracting-bike-02.jpg" loading="lazy" alt="The front wheel of the trailed bike is engaged in a fence of the foot pod. A strap maintains the front wheel firmly attached to the trailing bike providing two degree of freedom to the trailed bike frame. A second strap helps to maintain the bike the same vertical plane. Note the foot-pod fence small angle providing space for kids foots on the front bike."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-tracting-bike-02.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Attachment setup for trailing another bike&lt;/h4&gt;
&lt;p&gt;The front wheel of the trailed bike is engaged in a fence of the foot pod. A strap maintains the front wheel firmly attached to the trailing bike providing two degree of freedom to the trailed bike frame. A second strap helps to maintain the bike the same vertical plane. Note the foot-pod fence small angle providing space for kids foots on the front bike.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-on-car.jpg" loading="lazy" alt="Yuba KOMBI bike attached with two other bikes on the car rack."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/yuba-kombi-tsdz2-on-car.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;KOMBI bike on a car rack&lt;/h4&gt;
&lt;p&gt;Yuba KOMBI bike attached with two other bikes on the car rack.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id="various"&gt;Various&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://em3ev.com/" target="_blank" rel="noopener"&gt;https://em3ev.com/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;36V battery: 3.385 kg&lt;/li&gt;
&lt;li&gt;42V battery: 3.965 kg&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Miniature airspeed sensor for RC plane and UAVs.</title><link>https://lubin.kerhuel.eu/post/pitot-build/</link><pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/pitot-build/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;details class="toc-inpage d-print-none " open&gt;
&lt;summary class="font-weight-bold"&gt;Table of Contents&lt;/summary&gt;
&lt;nav id="TableOfContents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#pitot-tube-principle"&gt;Pitot tube principle&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#pitot-prandtl-tube"&gt;Pitot-Prandtl tube&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#electronics"&gt;Electronics&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#sensitivity-requirements-and-pressure-sensor"&gt;Sensitivity requirements and Pressure sensor&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#signal-conditioning-and-conversion"&gt;Signal conditioning and conversion&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#sensor-static-tests"&gt;Sensor static tests&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#flight-setup"&gt;Flight setup&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#experimental-results"&gt;Experimental results&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#gps-vs-airspeed"&gt;Comparison with GPS ground speed&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#wind-estimation"&gt;Wind estimation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/nav&gt;
&lt;/details&gt;
&lt;h2 id="pitot-tube-principle"&gt;Pitot tube principle&lt;/h2&gt;
&lt;p&gt;A Pitot-Darcy probe is an airspeed sensor commonly used in aviation. It consists of a tube pointing in the forward direction. When the sensor moves forward a stop pressure $P_t$ is added at its tip. The differential pressure $P_{diff}$ is measured between the tip of the tube $P_t$ and the static pressure $P_s$. One variant named from its inventor Prandtl tube has static air ports directly on the side of the tube.&lt;/p&gt;
&lt;p&gt;The pressure added at tube tip is the square of the airspeed : $P_t = P_s + \frac{1}{2}\rho v^2$ where $ P_t $ and $P_s$ are measured in Pascal unit (Pa). $\rho$ is the air density constant typically in $[1.14 \ 1.34]$ depending on temperature &amp;amp; altitude. $v$ is the airspeed in $m.s^{-1}$. The differential pressure measured is $P_{diff} = P_t - P_s = \frac{1}{2}\rho v^2$&lt;/p&gt;
&lt;h2 id="pitot-prandtl-tube"&gt;Pitot-Prandtl tube&lt;/h2&gt;
&lt;p&gt;Prandtl tube is one version of a Pitot probe where an inner tube is placed in the center of an outer tube. Space between the two tubes is filled-in on few mm near the tip with an epoxy adhesive (Araldite or equivalent). The side of the outer tube is drilled to sense the static pressure. At the bottom, the inner tube which is longer act as a connector for the dynamic pressure sensor and third short tube is added to create a connector to the static pressure area which lies in the empty space between the two tube.&lt;/p&gt;
&lt;p&gt;The static pressure holes must be drilled at a minimum distance from the tube tip where airflow perturbations are reduced. A distance 4 times the diameter (d=4mm)of the outer tube is retains here (16mm). Four 1mm holes were drilled with a Dremel hand tool. The three tubes are presented on the figure below.&lt;/p&gt;
&lt;p&gt;First test was done using brass tubes. Inner tube width is 2/1mm (outside/inside) and outer tube is 4/3mm.&lt;/p&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-brasstubes.jpg" loading="lazy" alt="Tube alfer from Leroy Merlin. Inner tube is 2mm/1mm. Outer tube is 4mm/3mm. Outer tube length is m=86mm. Four 1mm holes are drilled at l=16mm from the tip."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-brasstubes.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Brass inner and outer tubes of the Pitot tube.&lt;/h4&gt;
&lt;p&gt;Tube alfer from Leroy Merlin. Inner tube is 2mm/1mm. Outer tube is 4mm/3mm. Outer tube length is m=86mm. Four 1mm holes are drilled at l=16mm from the tip.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;References:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://ntrs.nasa.gov/api/citations/19930092297/downloads/19930092297.pdf" target="_blank" rel="noopener"&gt;report WIND-TUNNEL INVESTIGATION OF &amp;lsquo;A NUMBER OF TOTAL-PRESSURE TUBES AT HIGH ANGLES OF ATTACK SUBSONIC, TRANSONIC, AND SUPERSONIC SPEEDS&amp;rsquo;&lt;/a&gt; by W.Gracey on the impact of the various shape on the measurement.&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.planete-sciences.org/espace/IMG/pdf/tube_de_pitot.pdf" target="_blank" rel="noopener"&gt;report (french)&lt;/a&gt; from ANSTJ with general information on Pitot sensor.&lt;/li&gt;
&lt;li&gt;&lt;a href="http://voiletech.free.fr/skyassistant/pitot.htm" target="_blank" rel="noopener"&gt;website (French)&lt;/a&gt; from Rémi Bourgin with experimental Pitot tube for RC plane&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- Tube laiton macif (alfer) au Leroy Merlin;
Tube intèrieur: 2mm, trou 1mm
Tube extèrieur: 4mm, trou 3mm
Longueur total:
d = 4mm
l = 4d =&gt; 16mm
m = 11d =&gt;44mm
Tube altigator:
d = 4mm
l = 18mm
m = 72mm
--&gt;
&lt;h2 id="electronics"&gt;Electronics&lt;/h2&gt;
&lt;h3 id="sensitivity-requirements-and-pressure-sensor"&gt;Sensitivity requirements and Pressure sensor&lt;/h3&gt;
&lt;p&gt;The differential pressure measured vary with the square of the speed. RC plane speed can be quite low. Challenge is to be sensitive enough to obtain good measurement even in the low speed range of few meters per seconds.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://www.nxp.com/part/MP3V5004DP#/" target="_blank" rel="noopener"&gt;MP3V5004dp&lt;/a&gt; from NXP is a sensitive differential pressure sensor. Its differential measurement range goes from 0 to 3.92 kPa. The analog output is ratio-metric and swing from 0.6V to 3V ($\Delta V =2.4V$). For reference, 1 kPa is approximately the pressure of 10cm of water.&lt;/p&gt;
&lt;p&gt;We are interested in speed range varying from $0$ to $25 m.s^{-1}$ ($90km/h$) which correspond to a maximum differential pressure of 3.75 cm of water, or 0.375 kPa. The MP3V5004DP sensor is used in 10% of its nominal range.&lt;/p&gt;
&lt;p&gt;Table below provide theoretical differential pressure expected for various speed using $P_{diff} = \frac{1}{2}\rho v^2$ with $\rho=1.15$.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;v (m/s)&lt;/th&gt;
&lt;th style="text-align: center"&gt;v (Km/h)&lt;/th&gt;
&lt;th style="text-align: center"&gt;$P_{diff}$ (Pa)&lt;/th&gt;
&lt;th style="text-align: center"&gt;~ $H_2O$ (cm)&lt;/th&gt;
&lt;th style="text-align: center"&gt;&lt;a href="https://www.nxp.com/part/MP3V5004DP#/" target="_blank" rel="noopener"&gt;MP3V5004dp&lt;/a&gt; &amp;amp; &lt;a href="https://www.microchip.com/wwwproducts/en/MCP3428" target="_blank" rel="noopener"&gt;MCP3428&lt;/a&gt; (0.2041Pa / LSB&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;td style="text-align: center"&gt;3.6&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.6&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.006&lt;/td&gt;
&lt;td style="text-align: center"&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;2&lt;/td&gt;
&lt;td style="text-align: center"&gt;7.2&lt;/td&gt;
&lt;td style="text-align: center"&gt;2.4&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.024&lt;/td&gt;
&lt;td style="text-align: center"&gt;12&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;4&lt;/td&gt;
&lt;td style="text-align: center"&gt;14.4&lt;/td&gt;
&lt;td style="text-align: center"&gt;9.6&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.096&lt;/td&gt;
&lt;td style="text-align: center"&gt;47&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;7&lt;/td&gt;
&lt;td style="text-align: center"&gt;25.2&lt;/td&gt;
&lt;td style="text-align: center"&gt;29.4&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.294&lt;/td&gt;
&lt;td style="text-align: center"&gt;144&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;10&lt;/td&gt;
&lt;td style="text-align: center"&gt;36&lt;/td&gt;
&lt;td style="text-align: center"&gt;60&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.6&lt;/td&gt;
&lt;td style="text-align: center"&gt;294&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;15&lt;/td&gt;
&lt;td style="text-align: center"&gt;54&lt;/td&gt;
&lt;td style="text-align: center"&gt;135&lt;/td&gt;
&lt;td style="text-align: center"&gt;1.3&lt;/td&gt;
&lt;td style="text-align: center"&gt;661&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;20&lt;/td&gt;
&lt;td style="text-align: center"&gt;72&lt;/td&gt;
&lt;td style="text-align: center"&gt;240&lt;/td&gt;
&lt;td style="text-align: center"&gt;2.4&lt;/td&gt;
&lt;td style="text-align: center"&gt;1176&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;25&lt;/td&gt;
&lt;td style="text-align: center"&gt;90&lt;/td&gt;
&lt;td style="text-align: center"&gt;375&lt;/td&gt;
&lt;td style="text-align: center"&gt;3.75&lt;/td&gt;
&lt;td style="text-align: center"&gt;1837&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;30&lt;/td&gt;
&lt;td style="text-align: center"&gt;108&lt;/td&gt;
&lt;td style="text-align: center"&gt;540&lt;/td&gt;
&lt;td style="text-align: center"&gt;5.4&lt;/td&gt;
&lt;td style="text-align: center"&gt;2646&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;40&lt;/td&gt;
&lt;td style="text-align: center"&gt;144&lt;/td&gt;
&lt;td style="text-align: center"&gt;960&lt;/td&gt;
&lt;td style="text-align: center"&gt;9.6&lt;/td&gt;
&lt;td style="text-align: center"&gt;&lt;em&gt;4704&lt;/em&gt; (4095 sat)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="signal-conditioning-and-conversion"&gt;Signal conditioning and conversion&lt;/h3&gt;
&lt;p&gt;The pressure sensor electronics is placed in the wing close (~10cm) to the Pitot tube. The analog to digital conversion is integrated in the sensor board. The &lt;a href="https://www.microchip.com/wwwproducts/en/MCP3428" target="_blank" rel="noopener"&gt;MCP3428&lt;/a&gt; from Microchip is a high resolution sigma-delta converter with a programmable gain factor from 1 to 8. It has a digital I2C bus interface and its I2C address can be selected. Similar DAC to consider are MCP342x, the newer MCP346x family or the MCP356x providing increased accuracy and higher sampling rate but its package is smaller thus more difficult to handle for a DIY project.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://www.nxp.com/part/MP3V5004DP#/" target="_blank" rel="noopener"&gt;MP3V5004dp&lt;/a&gt; output analog signal is connected to the &lt;a href="https://www.microchip.com/wwwproducts/en/MCP3428" target="_blank" rel="noopener"&gt;MCP3428&lt;/a&gt; Sigma-Delta ADC through a first order RC low pass filter with a cut off frequency at $28Hz$ ($R=5.6 kOhm$,$C=1\mu F$). The 2nd differential input is connected on a voltage divisor to obtain 1V from the 3.3V reference (480 &amp;amp; 1kOhms). $10\mu F$ decoupling capacitor are used on power supply. The I2C bus wires are pulled up with 10kOhm and are connected to a 10pf capacitor protecting from glitches.&lt;/p&gt;
&lt;!-- Measured 480 840 for the divisor. Write down 560 and 1.2k --&gt;
&lt;p&gt;The &lt;a href="https://www.microchip.com/wwwproducts/en/MCP3428" target="_blank" rel="noopener"&gt;MCP3428&lt;/a&gt; Sigma-Delta ADC is configured for&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;12 bits&lt;/li&gt;
&lt;li&gt;x8 Gain&lt;/li&gt;
&lt;li&gt;240 Samples Per Seconds (SPS)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The resulting resolution is provided from:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;(1) &lt;a href="https://www.nxp.com/part/MP3V5004DP#/" target="_blank" rel="noopener"&gt;MP3V5004dp&lt;/a&gt; Analog output sensitivity is 1633 Pa/V&lt;/li&gt;
&lt;li&gt;(2) &lt;a href="https://www.microchip.com/wwwproducts/en/MCP3428" target="_blank" rel="noopener"&gt;MCP3428&lt;/a&gt; 12 bits with a gain of 8 : 0.125mV/LSB&lt;sup id="fnref1:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With (1) and (2), we obtain a resolution of $1633 * 0.125e^{-3} $ = &lt;em&gt;&lt;strong&gt;0.2041 Pa / LSB&lt;sup id="fnref2:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg" loading="lazy" alt="Differential pressure sensor (MP3V5004dp) with Analog to Digital converter integrating a differential amplifier (MCP3428). The MCP3428 communicate with the microcontroller through an I2C BUS. A MCP1700 3.3V voltage regulator adapt and filter out the 5V input voltage."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Pressure sensor and electronics mounted on a DIP adapter board.&lt;/h4&gt;
&lt;p&gt;Differential pressure sensor (MP3V5004dp) with Analog to Digital converter integrating a differential amplifier (MCP3428). The MCP3428 communicate with the microcontroller through an I2C BUS. A MCP1700 3.3V voltage regulator adapt and filter out the 5V input voltage.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id="sensor-static-tests"&gt;Sensor static tests&lt;/h3&gt;
&lt;p&gt;A 90 minutes lasting measurement is performed indoor without movements. Sensor output were logged at 100Hz. The figure below shows a slow drift (correlated with temperature or battery decay ? TBD). The sensor standard deviation measured on the overall measurement is 0.54 Pa (including the drift).&lt;/p&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-static-characteristic.png" loading="lazy" alt="90 minutes lasting static measurement indoor shows a slow drift and a standard deviation of 0.54 Pa. Resolution is 0.2041 Pa / LSB"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-static-characteristic.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Experimental pitot-tube static characteristic with the MP3V5004dp differential pressure sensor&lt;/h4&gt;
&lt;p&gt;90 minutes lasting static measurement indoor shows a slow drift and a standard deviation of 0.54 Pa. Resolution is 0.2041 Pa / LSB&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h4 id="possible-noiseoffset-sources"&gt;possible noise/offset sources&lt;/h4&gt;
&lt;p&gt;The sensor is sensitive to its own orientation. Flipping the sensor up-side down creates an negative offset of 12.5mV (100 LSB&lt;sup id="fnref3:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; with the analog to digital circuit setting).&lt;/p&gt;
&lt;p&gt;MCP5398 and MP3V5004dp are both powered with 3.3V. A linear voltage regulator (&lt;a href="https://ww1.microchip.com/downloads/en/DeviceDoc/20001826D.pdf" target="_blank" rel="noopener"&gt;MCP 1700&lt;/a&gt;) filter-out the 5V sensor board input to 3.3V. The analog signal remains however sensitive to fluctuation on the 5v input. Particular attention should be taken with telemetry which pollute power supply if they do not have their dedicated regulator. Also the electromagnetic burst from telemetry module might pollute the overall electronic including the ground; A periodic burst correlated with MAVLink packets sent was noticed on pitot output (20 to 300 LSB, nothing noticed on IMU sensors) caused by a 3DR telemetry module when its antenna is placed too close to non protected electronics part. Problem solved by moving the antenna away and reducing the Tx emitting power.&lt;/p&gt;
&lt;h2 id="flight-setup"&gt;Flight setup&lt;/h2&gt;
&lt;p&gt;The sensor is mounted on the wing of a FirStar 1600 RC plane.&lt;/p&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg" loading="lazy" alt="Platform used for tests"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;FirStar 1600 Volantex RC plane&lt;/h4&gt;
&lt;p&gt;Platform used for tests&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;A 2mm flexible tube, originally for protecting fish lines, connect the sensor to the Pitot tube.&lt;/p&gt;
&lt;div class="box" style="max-width:50%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg" loading="lazy" alt="Fishing Tube used to connect the differential pressure MP3V5004dp sensor to Pitot tube."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Flashmer – flexible Tube 2mm. Image from Decathlon (france).&lt;/h4&gt;
&lt;p&gt;Fishing Tube used to connect the differential pressure MP3V5004dp sensor to Pitot tube.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;One magnet is glued on the Pitot tube. A 2nd magnet integrated in the wing allows to fix the Pitot tube. Both magnet are in contact. The tube stays firmly in place during flights and ejects in case of hard landing reducing damages. It is a flexible solution for testing other Pitot tube design ; It&amp;rsquo;s also practical for storage and transportation.&lt;/p&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg" loading="lazy" /&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Brass Pitot tube with its electronic board mounted onboard the Firstar 1600 fixed wing platform.&lt;/h4&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" style="max-width:60%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-carbon2.jpg" loading="lazy" alt="Outer tube is a 5/3mm carbon tube. Inner tube is a brass 2mm/1mm tube."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-carbon2.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Carbon-Brass light Pitot tube sensor attached to the wing with a magnet.&lt;/h4&gt;
&lt;p&gt;Outer tube is a 5/3mm carbon tube. Inner tube is a brass 2mm/1mm tube.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id="experimental-results"&gt;Experimental results&lt;/h2&gt;
&lt;p&gt;The MCP3428 samples $P_{diff}$ at 250Hz during flights. $V_{Pitot}=\sqrt{\frac{2}{\rho}*P_{diff}}$ with $\rho = 1.15$.&lt;/p&gt;
&lt;p&gt;No calibration were required. Sensor theoretical output scaling were used with the formula to compute the speed from the pressure. $\rho$ value was tune from a default value 1.2 to 1.16 which minimized the mean error however the improvement was not a big deal. The only value to adjust is the raw pressure measurement offset (zero). The zero value for the sensor used is -1800.&lt;/p&gt;
&lt;p&gt;Matlab script converting 250Hz raw MCP3428 to Pressure (Pa) and Speed (m/s):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-matlab" data-lang="matlab"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% Pitot Calibration. P_pitot is a vector with raw MCP3428 output read from I2C bus.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;P_pitot_cal&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;0.2041&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;double&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;P_pitot&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1800&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c"&gt;% to Pa unit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% Compute Speed (m/s) from diff pressure (in Pa).&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;V_pitot&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;sqrt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;1.15&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;P_pitot_cal&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="gps-vs-airspeed"&gt;Comparison with GPS ground speed&lt;/h3&gt;
&lt;p&gt;In calm condition, the ground speed $V_{GPS}$ and airspeed $V_{Pitot}$ are equal.&lt;/p&gt;
&lt;p&gt;In windy condition, wind average direction and strength are estimated combining $V_{GPS}$, $V_{Pitot}$ and the plane yaw $\Theta_{heading}$ direction (using GPS COG&lt;sup id="fnref:2"&gt;&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt;). This &lt;a href="#wind-estimation"&gt;wind estimation&lt;/a&gt; is described below.&lt;/p&gt;
&lt;p&gt;The airplane ground speed (GPS) is estimated with the difference of the airspeed (Pitot) with the projected wind to the aircraft forward direction:&lt;/p&gt;
&lt;p&gt;$V_{GPS} \approx V_{Pitot} - V_{wind}*cos(\Theta_{heading} + \Theta_{wind}) $&lt;/p&gt;
&lt;p&gt;The figure below presents the airspeed in blue. The reconstructed ground speed (black) matches accurately with the GPS velocity (red) which prove the correctness of the airspeed measurement as well as the wind strength and direction. The onshore wind is laminar with limited turbulences. The airspeed measurement presents a high sensitivity even at low speed.&lt;/p&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-gps-wind-calibration.png" loading="lazy" alt="GPS Speed over ground (red). Pitot airspeed (blue) computed with $\rho=1.15$. Reconstructed up-front wind (green). Pitot airspeed minus wind estimated (black) where $V_pitot$ is averaged and under-sampled by a factor 5 reducing its sampling rate from 250Hz to 50Hz. Up-front wind is estimated from the GPS COG angle ($\approx \theta_{heading}$), and the estimated wind strength ($V_{wind}= 2.5 m/s$) and direction ($\theta_{wind} = 101°$)."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-gps-wind-calibration.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Experimental measurement comparing GPS ground speed with pitot-tube airspeed on 200s of a Firstar 1600 RC plane flight. Match between the GPS ground speed and the pitot tube subtracted from the estimated wind.&lt;/h4&gt;
&lt;p&gt;GPS Speed over ground (red). Pitot airspeed (blue) computed with $\rho=1.15$. Reconstructed up-front wind (green). Pitot airspeed minus wind estimated (black) where $V_pitot$ is averaged and under-sampled by a factor 5 reducing its sampling rate from 250Hz to 50Hz. Up-front wind is estimated from the GPS COG angle ($\approx \theta_{heading}$), and the estimated wind strength ($V_{wind}= 2.5 m/s$) and direction ($\theta_{wind} = 101°$).&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;More figures in &lt;a href="https://lubin.kerhuel.eu/slides/pitot-build/#/10"&gt;online presentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The GPS update rate is 10Hz. It is sampled at 50Hz to minimize delay. The pitot-tube sensor update rate is 260Hs but it is sampled at 250Hz.&lt;/p&gt;
&lt;p&gt;The error is defined with $error = V_{gps} - \left( V_{Pitot} - V_{wind}*cos(\Theta_{heading} + \Theta_{wind}) \right) $. For the 200s of the flight shown on the figure, the error measured is:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;error&lt;/th&gt;
&lt;th style="text-align: center"&gt;m/s&lt;/th&gt;
&lt;th style="text-align: center"&gt;km/h&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;mean&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.017&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.06&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;standard deviation&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.74&lt;/td&gt;
&lt;td style="text-align: center"&gt;2.6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;RMS error is relatively low regarding the measured speed value. Part of the error is also due to wind gust and GPS limited accuracy particularly at estimating fast change of vertical speed.&lt;/p&gt;
&lt;h3 id="wind-estimation"&gt;Wind estimation&lt;/h3&gt;
&lt;p&gt;Wind model considered is constant and characterized by&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;its constant direction $\Theta_{wind}$&lt;/li&gt;
&lt;li&gt;its constant strength $V_{wind}$&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="wind--v_pitot---v_gps"&gt;Wind =&amp;gt; $V_{Pitot} - V_{gps}$&lt;/h4&gt;
&lt;p&gt;The curve below shows the difference between the Ground speed (GPS) with the airspeed (Pitot) in function of the plane flight direction. This error (blue dashed points) fit with a sine wave. This sine wave is the speed offset added for each plane direction in $[0 \ 2\pi]$ by a wind with a constant strength and direction. Sine wave amplitude and phase is the wind strength and direction.&lt;/p&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-speed-error-wind-estimation.png" loading="lazy" alt="Blue dots are speed difference between GPS and Pitot. The continuous green curve is the wind sine wave projection on the $\Theta_{heading}$ plane direction. Sine phase is wind direction ($(\pi-1.37*\frac{180}{\pi})=101°$, from East to West) and sine amplitude is wind strength (2.56m/s). Pitot values are averaged and under-sample by a factor 5."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-speed-error-wind-estimation.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Experimental result presenting GPS ground speed and Pitot airspeed difference in function of the plane direction of 450s flight of the RC Firstar 1600 plane.&lt;/h4&gt;
&lt;p&gt;Blue dots are speed difference between GPS and Pitot. The continuous green curve is the wind sine wave projection on the $\Theta_{heading}$ plane direction. Sine phase is wind direction ($(\pi-1.37*\frac{180}{\pi})=101°$, from East to West) and sine amplitude is wind strength (2.56m/s). Pitot values are averaged and under-sample by a factor 5.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;This wind estimation is used to compensate the airspeed when comparing the GPS ground speed $V_{gps}$ with the Pitot airspeed $V_{Pitot}$ &lt;a href="https://lubin.kerhuel.eu/post/pitot-build/#gps-vs-airspeed"&gt;above&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id="script"&gt;Script&lt;/h4&gt;
&lt;p&gt;Matlab script to estimate wind off-line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-matlab" data-lang="matlab"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% V_gps and V_pitot are two vector with all data measured.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% V_pitot was under-sampled (averaging) by a factor 5 to fit the 50Hz log from the GPS.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% GPS chip update frequency is 10Hz, but it is logged at 50Hz.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;V_err&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;V_pitot&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;V_gps&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% Ground and Airspeed difference (i.e. wind) &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;M&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;cos&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;COG&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="nb"&gt;sin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;COG&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% COG is the direction (Theta in rad) vector data measured from the GPS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;V_err&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;M&lt;/span&gt;&lt;span class="o"&gt;\&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% Solve wind strength and direction using linear algebra (MMSE)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;Theta_Wind&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;atan2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt; &lt;span class="c"&gt;% Wind (go to) direction. Azimuth direction is opposite to trigo&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;V_Wind&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;sqrt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.^&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt; &lt;span class="c"&gt;% Wind strength (m/s)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;COG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;V_err&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;hold&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c"&gt;% plot Error blue dots &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:.&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nb"&gt;pi&lt;/span&gt;&lt;span class="p"&gt;)],&lt;/span&gt;&lt;span class="n"&gt;V_Wind&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;cos&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:.&lt;/span&gt;&lt;span class="mi"&gt;01&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nb"&gt;pi&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;Theta_Wind&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;-k&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;linewidth&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c"&gt;% plot wind&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="discussion"&gt;Discussion&lt;/h4&gt;
&lt;p&gt;Using the GPS COG&lt;sup id="fnref1:2"&gt;&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt; field is not exactly the plane yaw direction $\Theta_{heading}$ but the plane flight direction.
Thus the COG is a biased plane yaw $\Theta_{heading}$ direction. It would be best to use plane orientation from the IMU sensor. It is not done here to reduce the number of sensors for this demonstration. The COG bias is small enough if we assume the wind speed to be small compared to the airplane airspeed. It might be possible with a more sophisticated script to compensate this bias.&lt;/p&gt;
&lt;p&gt;W. Premerlani propose a &lt;a href="https://drive.google.com/file/d/0ByvTkVQo3tqXVzBYQUZicUNvbEE/view" target="_blank" rel="noopener"&gt;wind estimation&lt;/a&gt; using exclusively GPS data. Tests with this GPS dataset was not conclusive while trying to use all GPS sample while the platform direction is modified (i.e. COG derivative is above a given threshold). GPS dynamic seems too slow to provide robust results.&lt;/p&gt;
&lt;h4 id="other-flight-data"&gt;Other flight data&lt;/h4&gt;
&lt;p&gt;Plane was equipped with two GPS:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;one uBlox M8N GPS and&lt;/li&gt;
&lt;li&gt;one MTK3339.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The uBlox trace presented on the map below is better than the MTK trace. The uBlox chip was used exclusively for the curves above. The MTK trace can be shown on the &lt;a href="https://www.google.com/maps/d/u/0/embed?mid=1-K7dsmfbMCDL3IQK1z3IEtSduB2OWXr9" target="_blank" rel="noopener"&gt;map&lt;/a&gt; (top left icon). The KML file can be opened with Google Earth which provide a 3D view of the trace showing the height of the plane.&lt;/p&gt;
&lt;iframe src="https://www.google.com/maps/d/u/0/embed?mid=1-K7dsmfbMCDL3IQK1z3IEtSduB2OWXr9" style="width: 100% ; height: 480px"&gt;&lt;/iframe&gt;
&lt;!--
Project folder:
C:\M91449\MCHP_Blockset\Projects\2017_10_Autopilote\2018_04_12_LogChampdeTir_PitotNum_magOk_LowWind
--&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Least Significant Bit&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href="#fnref1:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href="#fnref2:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href="#fnref3:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;Course Over Ground&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href="#fnref1:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>Fixed-wing autopilot based on Simulink model</title><link>https://lubin.kerhuel.eu/project/autopilot-plane/</link><pubDate>Sun, 19 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/project/autopilot-plane/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css" integrity="sha384-yX+tSqQp3yF8BiTuLLOwNyaqtmZ9yFQT7IYg7U9YU9Dz/JDlh6JJQmNClCmvYl+b" crossorigin="anonymous"&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css" integrity="sha384-R6P/wJIrxjHcm//YCjb0S6rRgebsNn3u6U4NxVI8R03iSPAR5CwPqoq1n6U/tjFE" crossorigin="anonymous"&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js" integrity="sha384-jkeJ/ETDRD/P4Y3I3CQi1QIwrEJjR9GdAZV2/aqDwwgA5ldCNiExYJeBwKyQC/+q" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js" integrity="sha384-HotcxRWS6/oszHPwknjGnd066fV8+ycnO5TXDcOscFWvTtaiCtEEv+9s5Qrn1iJD" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"&gt;
&lt;div class="pswp__bg"&gt;&lt;/div&gt;
&lt;div class="pswp__scroll-wrap"&gt;
&lt;div class="pswp__container"&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__ui pswp__ui--hidden"&gt;
&lt;div class="pswp__top-bar"&gt;
&lt;div class="pswp__counter"&gt;&lt;/div&gt;
&lt;button class="pswp__button pswp__button--close" title="Close (Esc)"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--share" title="Share"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--fs" title="Toggle fullscreen"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--zoom" title="Zoom in/out"&gt;&lt;/button&gt;
&lt;div class="pswp__preloader"&gt;
&lt;div class="pswp__preloader__icn"&gt;
&lt;div class="pswp__preloader__cut"&gt;
&lt;div class="pswp__preloader__donut"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"&gt;
&lt;div class="pswp__share-tooltip"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"&gt;
&lt;/button&gt;
&lt;button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"&gt;
&lt;/button&gt;
&lt;div class="pswp__caption"&gt;
&lt;div class="pswp__caption__center"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id="a-16-bits-autopilot-designed-with-simulink-and-rapid-control-prototyping-tools"&gt;A 16-bits autopilot designed with Simulink and rapid control prototyping tools&lt;/h2&gt;
&lt;h3 id="motivation"&gt;Motivation&lt;/h3&gt;
&lt;p&gt;Building a platform for testing various autopilot control loop has become simple thanks to the many low cost elements available. To cite few of them:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;10 DoF IMU&lt;/strong&gt;: (~$5\ $$),&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GPS board&lt;/strong&gt;: (~$10\ $$),&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pitot tube&lt;/strong&gt; (&lt;a href="https://lubin.kerhuel.eu/post/pitot-build/"&gt;custom&lt;/a&gt;): (~$20\ $$),&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Microcontroller board&lt;/strong&gt;: depend on the board; rely on $\approx 5\ $$ mcu,&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Plane&lt;/strong&gt; platform: from $60$ to $120\ $$ including servos and motors.&lt;/li&gt;
&lt;li&gt;You also need few RC hardware:
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;receiver&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;remote control&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;battery pack&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;few optional hardware for &lt;strong&gt;data logging&lt;/strong&gt;, &lt;strong&gt;telemetry&lt;/strong&gt;, &lt;strong&gt;camera&lt;/strong&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="difference-with-existing-autopilot"&gt;Difference with existing autopilot&lt;/h3&gt;
&lt;p&gt;Many off the shelf autopilot exists and works great. To mention few of them:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://ardupilot.org/" target="_blank" rel="noopener"&gt;Ardupilot&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://px4.io/" target="_blank" rel="noopener"&gt;PX4&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://inavflight.com/" target="_blank" rel="noopener"&gt;iNav&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.librepilot.org/site/index.html" target="_blank" rel="noopener"&gt;LibrePilot&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.paparazziuav.org/wiki/Main_Page" target="_blank" rel="noopener"&gt;Paparazzi&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Others are listed on the &lt;a href="https://blog.dronetrest.com/flight-controller-firmware/" target="_blank" rel="noopener"&gt;DroneTrest review&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Usually, their internal parameters can be tuned. But, inserting your customized control-loop in such autopilot requires understanding the code structure underneath. Even well documented, it represents hundreds of C functions to navigate into, before starting any changes.
Your custom control loop might not fit within the existing structure. You might want to implement a more advanced controller than existing PIDs, use a different sample rate etc&amp;hellip;&lt;/p&gt;
&lt;p&gt;Starting a new project is sometime faster than re-use a pre-existing advanced one.
The presented autopilot uses a Model Based Design (MBD) approach: The autopilot code is generated from a unique Simulink model. Everything is within the diagram, from low level sensors handling up to the controller design. This MBD aproach is also named Rapid Control Prototyping (RCP).&lt;/p&gt;
&lt;p&gt;The autopilot control-loop uses standard math blocks. Low level systems is taken care with the Microchip blockset driving the microcontroller peripherals. The UxV blockset provide easily access to GPS, Remote Control S.BUS, F.Port and Smart Port protocol, MAVLink messaging including Way Point and Parameters protocols.
Such Simulink model allows to &amp;ldquo;get-in&amp;rdquo; the project graphically. It allows simulating parts of the system based on a simulated plane or based on values previously logged from a real flight which is helpful to design feed-forward sensor fusions algorithms.&lt;/p&gt;
&lt;p&gt;Another key difference is the use of a 16-bit microcontroller while other autopilot uses 32-bit microcontroller. 16-bits dsPIC prove to provide all required resources thanks to the efficient architecture underneath which handle the many peripheral used in an efficient way (UART, I2C, Output Capture, Input Compare&amp;hellip;).&lt;/p&gt;
&lt;p&gt;Note however a similar model based design using dsPIC microcontroller beeing developed at UCSC by Pr G.H.Elkaim in a project named SLUG. Their design is independent from the one presented here. The original project handled by M.I Lizarraga [SLUG] (&lt;a href="https://slugsuav.soe.ucsc.edu/" target="_blank" rel="noopener"&gt;https://slugsuav.soe.ucsc.edu/&lt;/a&gt;) is available online. The update &lt;a href="https://doi.org/10.1155/2018/6892153" target="_blank" rel="noopener"&gt;SLUG II&lt;/a&gt; projects rely on the same tool used here to target the dsPIC: the blockset for Microchip microcontrollers (free).&lt;/p&gt;
&lt;h3 id="hardware-list"&gt;Hardware list&lt;/h3&gt;
&lt;p&gt;Various combination of material was tested. Below is a selected list of hardware which prove to be efficient.&lt;/p&gt;
&lt;link rel="stylesheet" href="https://lubin.kerhuel.eu/css/hugo-easy-gallery.css" /&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg" loading="lazy" alt="Volantex Firstar 1600 with Qx7 remote control."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;autopilot platform&lt;/h4&gt;
&lt;p&gt;Volantex Firstar 1600 with Qx7 remote control.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RC platform&lt;/strong&gt;: Volantex Firstar 1600 with stock motors and servos (Alternative platform are Bixler 2 and Ranger 1600)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Remote Control&lt;/strong&gt;: FrSky QX7&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Receiver&lt;/strong&gt;: FrSky XSR-M / XSR used with either the S.Bus (receiver channel output) and Smart Port (Telemetry) protocol or with the F.Port protocol which combine both both S.bus with Smart Port saving one UART peripheral of the microcontroller. Each protocol uses only one wire thus half duplex UART. dsPIC UART peripheral enable configuring Tx and Rx on one line.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Microcontroller&lt;/strong&gt;: dsPIC 33EP on a AUAV V3 board. External motion sensor is used instead of built-in AUAV3 sensors. Tiny sensor board with recent chip are easier to firmly attach near the CG reducing vibrations. A custom board based on a dsPIC might replace the AUAV3 board which is difficult to find now. The UDB5 mini is similar and can still be found.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IMU sensor&lt;/strong&gt;: Gy-91 (10 DoF with 3 accelerometers, 3 rate gyro, 3 magnetometers and one barometer). Firmly attached near the CG of the plane. I2C bus is used between sensors and MCU.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pitot tube&lt;/strong&gt;:
&lt;ul&gt;
&lt;li&gt;An inner tube and an outer tube on which four holes are done laterally.&lt;/li&gt;
&lt;li&gt;Signal conditioning: the pitot tube pressure sensor (MP3V 5004 DP) is done with a MCHP ADC converter which integrate an analog amplifier. Converted pressure is sent to the microcontroller through the I2C bus. See &lt;a href="https://lubin.kerhuel.eu/post/pitot-build/"&gt;build and test&lt;/a&gt; page.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;GPS&lt;/strong&gt;: based on a $\mu$blox M8N chip providing up to 10Hz refresh rate and provided good results compared to competitors chips.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Data logger&lt;/strong&gt;: OpenLager board to log on SD card. It allows logging continuous UART output flow with at a baud up to 2 470 000 (much higher than a 115 200 baud rate that OpenLog data logger cannot sustain.).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Radio link&lt;/strong&gt;: 3DR Sik based Radio module for MAVLink telemetry (plane attitude, position, Way Point and Parameters tuning) with &lt;a href="https://qgroundcontrol.com/" target="_blank" rel="noopener"&gt;qgroundcontrol&lt;/a&gt; base station running on most platforms (PC, android, windows, Linux).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Action cam&lt;/strong&gt;: RunCam2 to film the plane and its surface control from the top; getting a visual behavior of the autopilot in the action.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/autopilot-electronic-sensors-bundle_1.jpg" loading="lazy" /&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/autopilot-electronic-sensors-bundle_1.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Embedded electronics. One early configuration for testing various sensors. Elements used: X8R receiver, PDB-XPM power board, OpenLager SD data logger, AUAV3 16-bit dsPIC microcontroller with sensors (MPU6050), IMU board 1, IMU board 2, Pressure sensor MP3V5004DP for pitot tube, GPS1, GPS2, 3S 2200maH LiPo battery, Qx7 transmitter.&lt;/h4&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id="results"&gt;Results&lt;/h3&gt;
&lt;p&gt;Sliding mode-based controller tested in both pitch and roll axis with two mode:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Control plane angular rate control (angular speed set-point given through the remote control)&lt;/li&gt;
&lt;li&gt;Control plane angle attitude (angle set point provided through the remote control)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Average CPU load was 7 to 8% on a dsPIC 33EP running at 70 MIPS. It includes the IMU estimation algorithm, autopilot control loop and all low tasks (handle various protocols (I2C, NMEA for GPS, F.Port, MAVLink and log sensors data at 1Khz through an UART configured at 24700000)&lt;/p&gt;
&lt;p&gt;Tested with strong wind. Showing good robustness despite the low number of parameters tuned so far (video link on top).&lt;/p&gt;
&lt;p&gt;Pitot tube airspeed estimation validated using GPS speed measurement as reference (&lt;a href="https://lubin.kerhuel.eu/post/pitot-build"&gt;here&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Validated the wind speed and direction estimation based on a difference between the GPS and pitot tube speed measurement considering the plane orientation.&lt;/p&gt;
&lt;p&gt;Validated automatic calibration of the magnetometer&amp;rsquo;s axis offset and gain. Once in the air, the magnetic perturbation near the floor are negligible. An algorithm automatically determines if the calibration can be refined using current data (using standard flight input data, no looping or specific roll required).&lt;/p&gt;
&lt;h3 id="next-steps"&gt;Next steps&lt;/h3&gt;
&lt;p&gt;Reduce chattering on ailerons when sliding mode control is enabled.&lt;/p&gt;
&lt;p&gt;Test in flight MAVLink protocol parameters tuning.&lt;/p&gt;
&lt;p&gt;Add automatic guidance of the plane, using MAVLink Way point sets.&lt;/p&gt;
&lt;h3 id="site-content"&gt;Site content&lt;/h3&gt;
&lt;p&gt;Time constraints does not allow writing a complete description of the project as originally planned. Part of projects which I find interesting and inspiring will be posted.&lt;/p&gt;
&lt;p&gt;Ideas to develop:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IMU&lt;/li&gt;
&lt;li&gt;&lt;a href="https://lubin.kerhuel.eu/post/pitot-build/"&gt;Pitot tube&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://lubin.kerhuel.eu/post/pitot-build/#wind-estimation"&gt;Wind estimation&lt;/a&gt; combining GPS ground-speed with Pitot tube airspeed&lt;/li&gt;
&lt;li&gt;UxV blocks including GPS, Remote Control and MAVLink blocks and functionalities&lt;/li&gt;
&lt;li&gt;Magnetometers auto calibration&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>MATEKSYS PDB-XPW Dual BEC &amp; Current Module tweak to increase current measurement sensitivity</title><link>https://lubin.kerhuel.eu/post/matek-pdb-xpw/</link><pubDate>Sat, 18 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/matek-pdb-xpw/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;p&gt;The board &lt;a href="https://www.mateksys.com/?portfolio=pdb-xpw" target="_blank" rel="noopener"&gt;PDB-XPW&lt;/a&gt; from MATEK System is a voltage regulator with an current measurement adapted for quad copters current with a max current measurement of 140 Amps. For an RC plane project, the current measurement might be reduced to increase current measurement resolution.&lt;/p&gt;
&lt;p&gt;The chip &amp;ldquo;INA1x9 High-Side Measurement Current Shunt Monitor&amp;rdquo; from Texas Instrument condition and amplify the shunt resistor voltage drop providing an analog output proportional to the current.&lt;/p&gt;
&lt;p&gt;On the PDB-XPW board, the INA1x9 chip is the black 5 pins component tagged E39 below the 0.05 Ohms shunt resistor, itself just below to the Power supply input connector.&lt;/p&gt;
&lt;p&gt;The amplification gain is set with the 47 kOhm resistor next to the INA1x9 component. This original value of 47 kOhm correspond to a gain of 47.
The gain is the value in kOhm as stated by the chip documentation:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;Resistor&lt;/th&gt;
&lt;th style="text-align: center"&gt;Gain&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;1 kOhm&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;5 Kohm&lt;/td&gt;
&lt;td style="text-align: center"&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;10 Kohm&lt;/td&gt;
&lt;td style="text-align: center"&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;50 Kohm&lt;/td&gt;
&lt;td style="text-align: center"&gt;50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;100 Kohm&lt;/td&gt;
&lt;td style="text-align: center"&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The 47 kOhm resistor is replaced with a 270 kOhm resistor providing a gain of 270 instead of 47.
The original current measurement range is reduced from 140 (A) to 20 (A) (140 * 47/270 = 20).&lt;/p&gt;
&lt;p&gt;The current measurement output is an analog signal swinging from 0 to 3.3V coding linearly for current in [0 - 20] Amps range. This lower current range fit with the RC plane platform like Bixler 2, Firstar 1600 or Ranger 1600.&lt;/p&gt;</description></item><item><title>Start/Stop signal for RunCam2 action cam</title><link>https://lubin.kerhuel.eu/post/runcam-remote-control-cable/</link><pubDate>Sat, 18 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/runcam-remote-control-cable/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css" integrity="sha384-yX+tSqQp3yF8BiTuLLOwNyaqtmZ9yFQT7IYg7U9YU9Dz/JDlh6JJQmNClCmvYl+b" crossorigin="anonymous"&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css" integrity="sha384-R6P/wJIrxjHcm//YCjb0S6rRgebsNn3u6U4NxVI8R03iSPAR5CwPqoq1n6U/tjFE" crossorigin="anonymous"&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js" integrity="sha384-jkeJ/ETDRD/P4Y3I3CQi1QIwrEJjR9GdAZV2/aqDwwgA5ldCNiExYJeBwKyQC/+q" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js" integrity="sha384-HotcxRWS6/oszHPwknjGnd066fV8+ycnO5TXDcOscFWvTtaiCtEEv+9s5Qrn1iJD" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"&gt;
&lt;div class="pswp__bg"&gt;&lt;/div&gt;
&lt;div class="pswp__scroll-wrap"&gt;
&lt;div class="pswp__container"&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__ui pswp__ui--hidden"&gt;
&lt;div class="pswp__top-bar"&gt;
&lt;div class="pswp__counter"&gt;&lt;/div&gt;
&lt;button class="pswp__button pswp__button--close" title="Close (Esc)"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--share" title="Share"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--fs" title="Toggle fullscreen"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--zoom" title="Zoom in/out"&gt;&lt;/button&gt;
&lt;div class="pswp__preloader"&gt;
&lt;div class="pswp__preloader__icn"&gt;
&lt;div class="pswp__preloader__cut"&gt;
&lt;div class="pswp__preloader__donut"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"&gt;
&lt;div class="pswp__share-tooltip"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"&gt;
&lt;/button&gt;
&lt;button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"&gt;
&lt;/button&gt;
&lt;div class="pswp__caption"&gt;
&lt;div class="pswp__caption__center"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Cable exist to connect a RunCam2 action cam to an RC receiver for remotely start and stop a record from the receiver PWM output (20ms period, 1ms to 2ms duty cycle).
The cable has logic to decode the RC PWM signal and generate the signal pulse scheme to start and stop the RunCam2 record.&lt;/p&gt;
&lt;p&gt;Controlling the camera can be done with a microcontroller by generating the required pulse scheme described below.&lt;/p&gt;
&lt;p&gt;The micro USB cable pinout is&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pin 1 (VCC): +5V (higher voltage possible for the RunCam2 connector)&lt;/li&gt;
&lt;li&gt;Pin 3 (D+): TTL signal (5V)&lt;/li&gt;
&lt;li&gt;Pin 5 (GND): GND&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When the Camera USB port is set for &amp;ldquo;Remote Control&amp;rdquo; and not for &amp;ldquo;mass storage&amp;rdquo; with the configuration application, it is possible to switch back and forth the camera from video mode to photo mode, and to start/stop recording, or take a picture.&lt;/p&gt;
&lt;p&gt;The pulse scheme is the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;One pulse switch the camera from video recording mode to Photo mode.&lt;/li&gt;
&lt;li&gt;Two pulses separated with 85ms start or stop a video record (or take a picture in photo mode).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pulse level is 5V but it works with 3.3V. Line is low state when idle. Pulses are 85ms in high state duration separated by 85ms on multiple pulse.&lt;/p&gt;
&lt;p&gt;Tested with a runCam2 powered from a 3S LiPo battery (10 to 14V), no battery in the camera and pulse generated with a 3.3V dsPIC pin configured as digital output.&lt;/p&gt;
&lt;p&gt;The figure below is the Simulink diagram with the logic used to generate the appropriate pulse on a dsPIC. Code is generated through the Simulink Coder and the &lt;a href="https://www.microchip.com/DevelopmentTools/ProductDetails/PartNO/SW007023" target="_blank" rel="noopener"&gt;MPLAB block&lt;/a&gt; from Microchip.&lt;/p&gt;
&lt;link rel="stylesheet" href="https://lubin.kerhuel.eu/css/hugo-easy-gallery.css" /&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/runcam2-startstop-simulink-logic.png" loading="lazy" alt="Simulink logic to control a runCam2 action Cam. The subsystem time step resolution is 1ms. The integrator is reset on each state change of the subsystem input, which trig the generation of two 85ms pulse pattern. Integrator reset is locked while pulses are being generated. Logic at the output of the integrator generate the pulses. The generated code was tested on a dsPIC target"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/runcam2-startstop-simulink-logic.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;
&lt;p&gt;Simulink logic to control a runCam2 action Cam. The subsystem time step resolution is 1ms. The integrator is reset on each state change of the subsystem input, which trig the generation of two 85ms pulse pattern. Integrator reset is locked while pulses are being generated. Logic at the output of the integrator generate the pulses. The generated code was tested on a dsPIC target&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;</description></item><item><title>Inverted Pendulum</title><link>https://lubin.kerhuel.eu/project/inverted-pendulum/</link><pubDate>Sat, 01 Dec 2018 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/project/inverted-pendulum/</guid><description>&lt;p&gt;Simulink Rapid Prototyping based inverted pendulum running on a microstick II dsPIC board.
The embedded IMU data fusion algorithm use the ICM-20608 inertial sensor to estimate the angle.
LQR control loop drives two DC motors of the modified toy.
No encoder sensor are present.&lt;/p&gt;</description></item><item><title>Lab INSA - Real Time Control for a DC / PMSM Motors</title><link>https://lubin.kerhuel.eu/project/lab-dc-motor/</link><pubDate>Sat, 01 Dec 2018 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/project/lab-dc-motor/</guid><description>&lt;p&gt;Control a 24V motor (Pravalux 24v DC) using the MCLV-V2 board with a dsPIC 33EP256MC506.
This hands-on is for 5th year students at INSA-Lyon.&lt;/p&gt;
&lt;p&gt;The hands-on Lab subject available at: &lt;a href="https://rtdc.ctrl-elec.fr/" target="_blank" rel="noopener"&gt;https://rtdc.ctrl-elec.fr/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Slides presents the adaptation required to go from a Simulink model for Simulation (or DSPACE) to a Simulink model targeting a microcontrollers. Two topics are presented:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Real-time scheduler / CPU load analysis&lt;/li&gt;
&lt;li&gt;Fixed-point datatypes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2021: Dspace project not feasible in labs due to Covid-19. It was replaced with home lab on MCLV-2 boards (sent to students) replacing Dspace.
lab subject is availalbe at: &lt;a href="https://rcp.ctrl-elec.fr/" target="_blank" rel="noopener"&gt;https://rcp.ctrl-elec.fr/&lt;/a&gt;&lt;/p&gt;</description></item><item><title>Inverted Pendulum</title><link>https://lubin.kerhuel.eu/docs/inverted-pendulum/</link><pubDate>Sun, 09 Sep 2018 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/docs/inverted-pendulum/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;div class="box" style="max-width:45%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum_platform_top.png" loading="lazy" alt="Top of the inverted pendulum"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum_platform_top.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;
&lt;p&gt;Top of the inverted pendulum&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h1 id="presentation"&gt;Presentation&lt;/h1&gt;
&lt;p&gt;Stabilization of an inverted pendulum is a common engineering challenge. Objective is to build a low-cost DIY&lt;sup id="fnref:1"&gt;&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref"&gt;1&lt;/a&gt;&lt;/sup&gt; platform to test various feedback control loop.&lt;/p&gt;
&lt;p&gt;This document describes the hardware and the theoretical model of the pendulum.
Simulation are presented with Simulink models and an LQR&lt;sup id="fnref:2"&gt;&lt;a href="#fn:2" class="footnote-ref" role="doc-noteref"&gt;2&lt;/a&gt;&lt;/sup&gt; feedback control loop finally stabilizes the platform.&lt;/p&gt;
&lt;!-- test code --&gt;
&lt;div
style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"&gt;
&lt;iframe
src="https://player.vimeo.com/video/309876246?dnt=0"
style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allow="fullscreen"&gt;
&lt;/iframe&gt;
&lt;/div&gt;
&lt;!-- You tube alternative: &lt;div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"&gt;
&lt;iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/dWTK7dTUvCo?autoplay=0&amp;amp;controls=1&amp;amp;end=0&amp;amp;loop=0&amp;amp;mute=0&amp;amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"&gt;&lt;/iframe&gt;
&lt;/div&gt;
--&gt;
&lt;p&gt;Video of the stabilized platform with a 4 state LQR feedback loop. The platform is completely autonomous (no user input).&lt;/p&gt;
&lt;p&gt;The electronic placed at the top of the pendulum composed of a dsPIC 16 bits microcontroller and an inertial sensor (accelerometers and rate gyro).
The base of the pendulum is a modified RC toys comprising two wheels driven by two independent DC motor (see &lt;a href="#hw_trolley"&gt;pictures below&lt;/a&gt;).&lt;/p&gt;
&lt;h1 id="hardware"&gt;Hardware&lt;/h1&gt;
&lt;h2 id="overview"&gt;Overview&lt;/h2&gt;
&lt;p&gt;The head and the base trolley are described successively. They are separated with an $8mm$ carbon tube.
The pendulum length is $0.52m$ from wheel axis to the top. Wheels diameters is $8cm$. Pendulum total weight is $200g$ comprising $111g$ for the 4 AA batteries.&lt;/p&gt;
&lt;div class="box" style="max-width:60%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum_platform_reduced_horizontal.png" loading="lazy" alt="Inverted Pendulum platform"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum_platform.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;
&lt;p&gt;Inverted Pendulum platform&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id="head-electronics"&gt;Head electronics&lt;/h2&gt;
&lt;h3 id="microcontroller"&gt;Microcontroller&lt;/h3&gt;
&lt;p&gt;The controller is a &lt;code&gt;Microstick II&lt;/code&gt; board equipped with a &lt;code&gt;dsPIC 33EP128MC202&lt;/code&gt; running at $70\ MIPS$.
It is powered through the USB connector which &lt;strong&gt;only provide the power supply&lt;/strong&gt; from 4 AA batteries hold in the base.&lt;/p&gt;
&lt;div class="box" style="max-width:80%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum_top.png" loading="lazy" alt="A prototyping board support a Microstick II board with the dsPIC 33EP128MC202. A board from Drotek endowing the Invensense ICM-20608 inertial sensor is screwed on the base board."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum_top.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Microcontroller and sensor on top of the inverted pendulum&lt;/h4&gt;
&lt;p&gt;A prototyping board support a Microstick II board with the &lt;em&gt;dsPIC 33EP128MC202&lt;/em&gt;. A board from Drotek endowing the Invensense ICM-20608 inertial sensor is screwed on the base board.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id="imu-sensor"&gt;IMU sensor&lt;/h3&gt;
&lt;p&gt;The unique sensor used is the 6 DoF&lt;sup id="fnref:3"&gt;&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref"&gt;3&lt;/a&gt;&lt;/sup&gt; Invensense &lt;code&gt;ICM-20608&lt;/code&gt; mounted on a &lt;a href="https://store.drotek.com/sensors/779-imu-6dof-icm20608-invensense-pcb-8944595424761.html" target="_blank" rel="noopener"&gt;Drotek sensor board&lt;/a&gt;. It endows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a 3 axis Accelerometers and&lt;/li&gt;
&lt;li&gt;a 3 axis rate gyros.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The I2C blocks set the BUS clock at $400kHz$ and fetch the 6 sensors values every $1ms$ $(1kHz)$.
The Simulink I2C blocks setting enable hot plug of the I2C sensor: The microcontroller initializes the sensor each time it is newly detected on the I2C bus.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The accelerometer is configured with a range of $\pm 8g$ low pass filtered at $99Hz$.&lt;/li&gt;
&lt;li&gt;The rage gyro is configured with a range of $\pm 500 \deg/s$ low pass filtered at $250Hz$.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A Simulink IMU&lt;sup id="fnref:4"&gt;&lt;a href="#fn:4" class="footnote-ref" role="doc-noteref"&gt;4&lt;/a&gt;&lt;/sup&gt; sub-system run a data fusion algorithm to reconstruct a drift-free quaternion angular position at $1kHz$ (the yaw angle drift when magnetometer is not present).
The stabilization control loop uses the drift-free pitch angle.&lt;/p&gt;
&lt;p&gt;It is possible to use other sensors like the MPU9250 or MPU6050 with either an I2C or SPI interface.
The GY-91 board is a 10 DoF&lt;sup id="fnref1:3"&gt;&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref"&gt;3&lt;/a&gt;&lt;/sup&gt; widespread board based on the 9 DoF MPU9250 (3 accelerometers, 3 magnetometers, 3 rate gyros) and has a pressure sensor.&lt;/p&gt;
&lt;h3 id="UARTINTERFACE"&gt;UART interface&lt;/h3&gt;
&lt;p&gt;The PCB board provides a $3.3V$ regulator and 4 pin extra interface ( GND, +3.3v, Tx, Rx ) to connect either an UART &lt;a href="https://github.com/d-ronin/openlager/wiki" target="_blank" rel="noopener"&gt;data-logger&lt;/a&gt; or &lt;a href="https://ardupilot.org/copter/docs/common-sik-telemetry-radio.html#common-sik-telemetry-radio" target="_blank" rel="noopener"&gt;radio link&lt;/a&gt; for telemetry module or an &lt;a href="https://www.frsky-rc.com/product/xsr/" target="_blank" rel="noopener"&gt;RC receiver&lt;/a&gt; capable of S.BUS, Smart Port or P.Port protocol (all UART based).&lt;/p&gt;
&lt;h2 id="hw_trolley"&gt;Base trolley&lt;/h2&gt;
&lt;h3 id="motors"&gt;Motors&lt;/h3&gt;
&lt;p&gt;The base trolley is a low cost a 2-wheel remote control toy named &lt;code&gt;flywheels&lt;/code&gt;. The toy is from 2012 but 2 wheeled equivalents exist.
Its electronics is removed.
Two pairs of wires power two DC motors in either direction through an &lt;code&gt;L298N&lt;/code&gt; H bridge board module.&lt;/p&gt;
&lt;div class="gallery caption-position-bottom caption-effect-slide hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery"&gt;
&lt;div class="box" &gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img" style="background-image: url('/img/pendulum_toysrus_flywheels_package.jpg');"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_package.jpg" loading="lazy" alt="FlyWheels toy package"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_package.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;FlyWheels toy package&lt;/h4&gt;
&lt;p&gt;FlyWheels toy package&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class="box" &gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img" style="background-image: url('/img/pendulum_toysrus_flywheels_open.jpg');"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_open.jpg" loading="lazy" alt="Two DC motors"/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_open.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption &gt;&lt;h4&gt;Two DC motors&lt;/h4&gt;
&lt;p&gt;Two DC motors&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--
(pictures: [Package](Toysrus_FlyWheels_package.jpg), [vehicle](Toysrus_FlyWheels_Vehicle.jpg), [RC+vehicle](Toysrus_FlyWheels_Vehicle_Remote.jpg), [Inside](Toysrus_FlyWheels_Open.jpg))--&gt;
&lt;h3 id="power-electronics"&gt;Power electronics&lt;/h3&gt;
&lt;p&gt;The L298N H bridge controls two DC motors. For each motor:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Two logic signals set the 4 states: direction CW or CCW, brake, or freewheel.&lt;/li&gt;
&lt;li&gt;The third logic signal power the motor depending on to the state defined.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The third signal is modulated with a 100Hz square periodic signal whose duty cycle vary from 0% to 100% (PWM). It sets the torque for the motor.&lt;/p&gt;
&lt;p&gt;The flat multicolor ribbon connects 6 logic control signals (3 for each motor) from the Microstick II dsPIC output to the of the L298N H bridge.&lt;/p&gt;
&lt;div class="box" style="max-width:60%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum_base.png" loading="lazy" alt="A L298N H bridge (for Arduino) power board drives the two DC motors of a modified FlyWheels toy. Four AA batteries powers the pendulum."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum_base.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Base trolley of the inverted pendulum&lt;/h4&gt;
&lt;p&gt;A &lt;em&gt;L298N H bridge&lt;/em&gt; (for Arduino) power board drives the two DC motors of a modified &lt;em&gt;FlyWheels&lt;/em&gt; toy. &lt;em&gt;Four AA batteries&lt;/em&gt; powers the pendulum.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id="batteries"&gt;Batteries&lt;/h3&gt;
&lt;p&gt;Four $1.2V$ AA Ni-Mh batteries are dispatched on both side of the trolley.
$\approx 4.8V$ powers the motors and the electronics.
The black and red wire from the trolley to the top of the pendulum powers the Microstick II electronic and sensors.&lt;/p&gt;
&lt;h1 id="pendulum-model"&gt;Pendulum Model&lt;/h1&gt;
&lt;p&gt;The pendulum model is composed of two intertwined sub-system:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The pendulum*, with 1 rotation DoF&lt;sup id="fnref2:3"&gt;&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref"&gt;3&lt;/a&gt;&lt;/sup&gt; $\theta$ angle around the wheel&amp;rsquo;s axis&lt;/li&gt;
&lt;li&gt;The trolley*, with 1 translation DoF&lt;sup id="fnref3:3"&gt;&lt;a href="#fn:3" class="footnote-ref" role="doc-noteref"&gt;3&lt;/a&gt;&lt;/sup&gt; $x$ position.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum-free-body-diagram.png" loading="lazy" alt="$\vec{P}$ is the weight at the center of gravity. $\vec{R}$ is the reaction force from the stiff rod and the floor. $\vec{F}$ is a friction force when the pendulum is rotating. $\{ \vec{i},\vec{j} \}$ is the earth frame and $\{ \vec{r},\vec{n} \}$ is the rotating pendulum frame. The inertial sensors are placed on top of the pendulum and measure all accelerations."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum-free-body-diagram.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Pendulum free body diagram&lt;/h4&gt;
&lt;p&gt;$\vec{P}$ is the weight at the center of gravity. $\vec{R}$ is the reaction force from the stiff rod and the floor. $\vec{F}$ is a friction force when the pendulum is rotating. $\{ \vec{i},\vec{j} \}$ is the earth frame and $\{ \vec{r},\vec{n} \}$ is the rotating pendulum frame. The inertial sensors are placed on top of the pendulum and measure all accelerations.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id="pendulum-equations"&gt;Pendulum Equations&lt;/h2&gt;
&lt;p&gt;The Dynamic fundamental law applied on the pendulum:
$$ \sum \vec{Force} = m.\vec{a} $$&lt;/p&gt;
&lt;p&gt;The three forces presents are the weight $\vec{P}$, the Friction $\vec{F}$, and the Reaction $\vec{R}$ from the rod &amp;amp; floor:&lt;/p&gt;
&lt;p&gt;$$ \underbrace{ -mg\vec{j} }_{\vec{P}} \ - \ \underbrace{ k \frac{\partial \vec{r}}{\partial t} }_{\vec{F}} \ + \ \underbrace{ ( mg\vec{j} . \vec{r} + \underbrace{Ctfg}_{\text{Centrifugal}} } _{\vec{R} } ) . \vec{r} = ml \frac{\partial^2\vec{ r }}{\partial t^2} $$&lt;/p&gt;
&lt;p&gt;With $ \{ \vec{i},\vec{j} \} $ the static earth frame and $ \{ \vec{r},\vec{n} \} $ the pendulum frame (rod and normal direction).
$m$ is the mass of the pendulum (without the trolley).
$l$ is the length from the inter-wheel&amp;rsquo;s axis to the center of mass of the pendulum (without the trolley)&lt;/p&gt;
&lt;p&gt;$$
\left\{ \begin{array}{rcl}
\vec{i} &amp;amp; = &amp;amp; \vec{n} . cos(\theta) - \vec{r} . sin(\theta) \\\
\vec{j} &amp;amp; = &amp;amp; \vec{n} . sin(\theta) + \vec{r} . cos(\theta)
\end{array} \right.
$$&lt;/p&gt;
&lt;p&gt;$$\vec{j}.\vec{r} = cos(\theta)$$&lt;/p&gt;
&lt;p&gt;Considering the rotation $\theta$, the first and second time derivative of $\vec{r}$ are:&lt;/p&gt;
&lt;p&gt;$$
\begin{array}{rcl}
\frac{\partial \vec{r}}{\partial t}
&amp;amp; = &amp;amp;
- \dot{\theta} \vec{n} \\\
\frac{\partial^2\vec{ r }}{\partial t^2}
&amp;amp; = &amp;amp;
- \frac{\partial }{\partial t} \left( \dot{\theta} \vec{n} \right) \\\
&amp;amp; = &amp;amp;
- \ddot{\theta} \vec{n} - \dot{\theta}^2 \vec{r}
\end{array}
$$&lt;/p&gt;
&lt;p&gt;The projection of the forces equation in the pendulum frame $ \{ \vec{r},\vec{n} \} $ is:
$$
\left\{ \begin{array}{rcl}
\left( ml\dot{\theta}^2 + Ctfg \right) \vec{r} = \vec{0} \\\
\left( l \ddot{\theta} + \frac{k}{m}\dot{\theta} - g . sin(\theta) \right) \vec{n} = \vec{0}&lt;br&gt;
\end{array} \right.
$$&lt;/p&gt;
&lt;p&gt;The first equation for the $\vec{r}$ axis shows internal forces which cancel each other: the weight $\vec{P} = -mg\vec{j}$ which is compensated on the $\vec{r}$ axis by the term $mg\vec{j}.\vec{r}$ from the reaction force which will also compensate for the Centrifugal force $ml\dot{\theta}^2$.&lt;/p&gt;
&lt;p&gt;The second differential equation on the $\vec{n}$ axis allows to solve for the evolution of the angle $\theta$.
It can be made linear with $sin(\theta) \approx \theta$ when the pendulum is up near $0$, or with $sin(\theta) \approx - (\theta - \pi)$ when the pendulum is down near $\pi$.&lt;/p&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum-model-rod.png" loading="lazy" alt="non-linear model of the $\theta$ angle evolution derived from the forces projected on the normal $\vec{n}$ axis of the rod. The trolley linear acceleration input is added."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum-model-rod.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Pendulum model for rod rotation&lt;/h4&gt;
&lt;p&gt;non-linear model of the $\theta$ angle evolution derived from the forces projected on the normal $\vec{n}$ axis of the rod. The trolley linear acceleration input is added.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;The linear approximation for $\theta$ in the laplace domain is a $2^{nd}$ order system:
$$ \theta(s) \left ( \frac{1}{w_n^2}s^2 + \frac{2 \zeta}{w_n}s \pm 1 \right ) = 0 $$&lt;/p&gt;
&lt;p&gt;The pendulum transfer function $F_p = \frac{\theta(s)}{E(s)}$ with a null input $E(s) = 1$
$$ F_p(s) = \frac{1}{ \frac{1}{w_n^2}s^2 + \frac{2 \zeta}{w_n}s \pm 1 } $$&lt;/p&gt;
&lt;div class="alert alert-note"&gt;
&lt;div&gt;
The linear term for $sin$ is positive when the pendulum is up when $\theta \approx 0$ (unstable), and negative when pendulum is down when $\theta \approx \pm \pi$ (stable).
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This transfer function is characterized when the pendulum is down by its natural frequency $w_n = \sqrt{ \frac{g}{l} } $, and a damping factor $\zeta$.&lt;/p&gt;
&lt;h2 id="pendul-identification"&gt;Pendul identification&lt;/h2&gt;
&lt;p&gt;The parameter $l$ could be estimated from the platform mechanical but the damping parameter $\zeta$ (or frictions coefficient $k$) could not be estimated easily from the platform.&lt;/p&gt;
&lt;p&gt;The simulation model is satisfactory when the calculation it performs make realistic prediction.
Experimental measurement is a good method to refine a model and tune its parameters.
In our case, the parameters $l$ and $\zeta$ (or $k$) are identified from the experiment explained below.&lt;/p&gt;
&lt;h3 id="experimental-logs"&gt;Experimental logs&lt;/h3&gt;
&lt;p&gt;The pendulum is placed on a track (two chairs back to back) to be able to make a complete rotation.
Motor are off and the pendulum is released up-side with in the unstable condition ($\theta = -18°$ , $\dot \theta = 0$).&lt;/p&gt;
&lt;p&gt;It oscillates until the damping friction ($\zeta$) stops the free oscillations.&lt;/p&gt;
&lt;p&gt;The $1kHz$ sampled rate gyro and accelerometers values are recorded onboard an &lt;a href="https://github.com/d-ronin/openlager/wiki" target="_blank" rel="noopener"&gt;openlager&lt;/a&gt; board connected on the dsPIC &lt;a href="#UARTINTERFACE"&gt;UART&lt;/a&gt; interface.&lt;/p&gt;
&lt;h3 id="simulation-from-logs"&gt;Simulation from logs&lt;/h3&gt;
&lt;p&gt;The measured inertial sensors are then re-used as data source in a Simulink model. $\theta$ angle is reconstructed using an IMU complementary filter algorithm implemented in the quaternion angle representation.&lt;/p&gt;
&lt;p&gt;The pendulum model is initialized with the experimentation initial condition ($\theta = -18°$ , $\dot \theta = 0$). Trolley linear acceleration input is null.
Parameters $l$ and $k$ are iteratively tuned until the model $\hat{\theta}$ angle fit with the measured oscillation $\theta$.&lt;/p&gt;
&lt;div class="box" style="max-width:100%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum-identification-theta.png" loading="lazy" alt="$\theta$ angle from free oscillation experiment is compared against two pendulum models. The pendulum is released at time $16.7s$ upside ($18°$) and let free to oscillate. The grey curve is the experimental angle reference reconstructed from inertial sensors measurements. The blue dashed curve is a pendulum model using a linear damping with $k = 0.4$. The red doted curve use a nonlinear damping with the nonlinear term -1.1*$sign(\dot{\theta})$ added to the linear damping with $k = 0.17$."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum-identification-theta.png" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Identification - experimental $\theta$ angle reconstructed from inertial sensors (wide grey curve) vs pendulum model (read and blue dashed curves)&lt;/h4&gt;
&lt;p&gt;$\theta$ angle from free oscillation experiment is compared against two pendulum models. The pendulum is released at time $16.7s$ upside ($18°$) and let free to oscillate. The grey curve is the experimental angle reference reconstructed from inertial sensors measurements. The blue dashed curve is a pendulum model using a linear damping with $k = 0.4$. The red doted curve use a nonlinear damping with the nonlinear term -1.1*$sign(\dot{\theta})$ added to the linear damping with $k = 0.17$.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;Pendulum Parameters&lt;/th&gt;
&lt;th style="text-align: center"&gt;Identified Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;$l$&lt;/td&gt;
&lt;td style="text-align: center"&gt;$0.45 m$&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;$k$&lt;/td&gt;
&lt;td style="text-align: center"&gt;$0.4$&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;$w_n = \sqrt{\frac{g}{l}}$&lt;/td&gt;
&lt;td style="text-align: center"&gt;$4.67\ rad.s^{-1}$ ( $0.74 Hz$ or $1.35s$ period )&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;⬆ Identified pendulum parameters&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="validation-and-imu-improvement"&gt;Validation and IMU improvement&lt;/h3&gt;
&lt;p&gt;Parameters $l$ and $k$ can be further validated using the force equation and the estimated pendulum angle $\theta$.&lt;/p&gt;
&lt;p&gt;The IMU input measurements is composed of the rate gyro and the accelerometers data. Magnetometers is not used in this pendulum example.
The IMU input also require the predicted acceleration vector (resp magnetometer is used).
The IMU output the sensor orientation and provides the gravity vector prediction as seen in the sensor estimated attitude (i.e. quaternion angle).&lt;/p&gt;
&lt;p&gt;Comparing the gravity vector predicted with the accelerometer&amp;rsquo;s measurement do not match because the sensor measures both the gravity plus the dynamic acceleration induced by the pendulum movements.&lt;/p&gt;
&lt;p&gt;Considering the pendulum principal movement rotation $\theta$, the equations of forces applied on the pendulum derive from $\hat \theta$ a prediction for the dynamic acceleration.
The good match between the predicted acceleration and the experimental measurement confirm somehow the correctness of parameters $l$ and $k$ involved in these calculations.&lt;/p&gt;
&lt;p&gt;The updated acceleration comprising both a static and dynamic part is fed into the IMU algorithm improving the IMU correction of the rate gyro integration drift even when the pendulum is not static.&lt;/p&gt;
&lt;h1 id="trolley-model"&gt;Trolley Model&lt;/h1&gt;
&lt;h2 id="trolley-equations"&gt;Trolley Equations&lt;/h2&gt;
&lt;div class="alert alert-warning"&gt;
&lt;div&gt;
Below is under construction &amp;#x1f6a7;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The translational movement of the trolley is modeled as a $1^{st}$ order system characterized by its time constant $\tau$.
This dynamic includes the motor dynamics when it is loaded with the trolley considering the pendulum as vertical.&lt;/p&gt;
&lt;p&gt;The model considers as negligible the effect of the pendulum forces (translational and rotational) applied on the trolley.&lt;/p&gt;
&lt;p&gt;$$ x(s) = \frac{1}{\tau s + 1} $$&lt;/p&gt;
&lt;h2 id="trolley-identification"&gt;Trolley Identification&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;Trolley Parameter&lt;/th&gt;
&lt;th style="text-align: center"&gt;Estimated Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;$\tau$&lt;/td&gt;
&lt;td style="text-align: center"&gt;$0.3s$&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The trolley does not have any sensors. No encoder or current sensor are used to control the two motors.
The parameters $\tau$ is &amp;ldquo;guessed&amp;rdquo; in a first step.
In a second step, a $2^{nd}$ inertial sensor board is temporary glued in the middle of the wheel diameter to as the inertial sensor is in the wheel rotation axe.
An identification can be computed from the motor set-point and the wheel movements while the pendulum was actively controlled up by a first feedback loop.&lt;/p&gt;
&lt;p&gt;Still the pendulum model including the trolley is simulated with its feedback loop controller and results are compared against recorded data of the real system running the same feedback loop controller. The simulated pendulum states are re-initialized periodically ($\approx 2s$) with the real pendulum states as the model would diverge otherwise due to perturbations not modeled and model discrepancies. Correctness of the model can be checked between these periodic re-initializations.&lt;/p&gt;
&lt;div class="box" style="max-width:45%"&gt;
&lt;figure itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"&gt;
&lt;div class="img"&gt;
&lt;img itemprop="thumbnail" src="https://lubin.kerhuel.eu/img/pendulum-gy91-wheel.jpg" loading="lazy" alt="The angular speed rate of the wheel is measured with one rate gyro form one added GY-91 sensor board. The GY-91 board is hot glued on one pendulum wheel. The pendulum is stabilized with a controller using an estimated trolley model. Four wires from the GY-91 to the microcontroller power the sensor and retrieve sensor data through the I2C bus (2 wires)."/&gt;
&lt;/div&gt;
&lt;a href="https://lubin.kerhuel.eu/img/pendulum-gy91-wheel.jpg" itemprop="contentUrl"&gt;&lt;/a&gt;
&lt;figcaption data-pre="Figure " data-post=":" class="numbered"&gt;&lt;h4&gt;Identification of trolley in real inverted pendulum condition.&lt;/h4&gt;
&lt;p&gt;The angular speed rate of the wheel is measured with one rate gyro form one added GY-91 sensor board. The GY-91 board is hot glued on one pendulum wheel. The pendulum is stabilized with a controller using an estimated trolley model. Four wires from the GY-91 to the microcontroller power the sensor and retrieve sensor data through the I2C bus (2 wires).&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h1 id="controller"&gt;Controller&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;Stabilization overview:&lt;/code&gt; The microcontroller computes the angle of the pendulum from the inertial sensor measurements (accelerometers and rate gyro). A feedback loop stabilizes the pendulum up right while maintaining the pendulum position still. The pendulum translation is estimated through an internal dynamic model of the trolley stimulated with a copy of the DC motor command. The pendulum slow translations reflect the drift of the internal estimation of the displacement.&lt;/p&gt;
&lt;h2 id="linearized-model"&gt;Linearized model&lt;/h2&gt;
&lt;h2 id="lqr-feedback-controller"&gt;LQR feedback controller&lt;/h2&gt;
&lt;p&gt;Video of the inverted Pendulum when it encounters a wall:
&lt;div
style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"&gt;
&lt;iframe
src="https://player.vimeo.com/video/309876329?dnt=0"
style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allow="fullscreen"&gt;
&lt;/iframe&gt;
&lt;/div&gt;
&lt;/p&gt;
&lt;!-- You tube alternative: &lt;div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"&gt;
&lt;iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/xbu4hXOnemE?autoplay=0&amp;amp;controls=1&amp;amp;end=0&amp;amp;loop=0&amp;amp;mute=0&amp;amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"&gt;&lt;/iframe&gt;
&lt;/div&gt;
--&gt;
&lt;p&gt;Another way to stabilize a pendulum with an electric seesaw (&lt;a href="https://sciencedemonstrations.fas.harvard.edu/presentations/inverted-pendulum" target="_blank" rel="noopener"&gt;video&lt;/a&gt;).&lt;/p&gt;
&lt;div class="footnotes" role="doc-endnotes"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Do It Yourself&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;Linear Quadratic Regulator&amp;#160;&lt;a href="#fnref:2" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:3"&gt;
&lt;p&gt;Degree of Freedom&amp;#160;&lt;a href="#fnref:3" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href="#fnref1:3" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href="#fnref2:3" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&amp;#160;&lt;a href="#fnref3:3" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:4"&gt;
&lt;p&gt;Inertial Measurement Unit&amp;#160;&lt;a href="#fnref:4" class="footnote-backref" role="doc-backlink"&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>Old website</title><link>https://lubin.kerhuel.eu/project/www-kerhuel-eu-wiki/</link><pubDate>Sat, 25 Jun 2011 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/project/www-kerhuel-eu-wiki/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;!--
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.css" integrity="sha384-yX+tSqQp3yF8BiTuLLOwNyaqtmZ9yFQT7IYg7U9YU9Dz/JDlh6JJQmNClCmvYl+b" crossorigin="anonymous"&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/default-skin/default-skin.min.css" integrity="sha384-R6P/wJIrxjHcm//YCjb0S6rRgebsNn3u6U4NxVI8R03iSPAR5CwPqoq1n6U/tjFE" crossorigin="anonymous"&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe.min.js" integrity="sha384-jkeJ/ETDRD/P4Y3I3CQi1QIwrEJjR9GdAZV2/aqDwwgA5ldCNiExYJeBwKyQC/+q" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.3/photoswipe-ui-default.min.js" integrity="sha384-HotcxRWS6/oszHPwknjGnd066fV8+ycnO5TXDcOscFWvTtaiCtEEv+9s5Qrn1iJD" crossorigin="anonymous"&gt;&lt;/script&gt;
&lt;div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"&gt;
&lt;div class="pswp__bg"&gt;&lt;/div&gt;
&lt;div class="pswp__scroll-wrap"&gt;
&lt;div class="pswp__container"&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;div class="pswp__item"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__ui pswp__ui--hidden"&gt;
&lt;div class="pswp__top-bar"&gt;
&lt;div class="pswp__counter"&gt;&lt;/div&gt;
&lt;button class="pswp__button pswp__button--close" title="Close (Esc)"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--share" title="Share"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--fs" title="Toggle fullscreen"&gt;&lt;/button&gt;
&lt;button class="pswp__button pswp__button--zoom" title="Zoom in/out"&gt;&lt;/button&gt;
&lt;div class="pswp__preloader"&gt;
&lt;div class="pswp__preloader__icn"&gt;
&lt;div class="pswp__preloader__cut"&gt;
&lt;div class="pswp__preloader__donut"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"&gt;
&lt;div class="pswp__share-tooltip"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"&gt;
&lt;/button&gt;
&lt;button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"&gt;
&lt;/button&gt;
&lt;div class="pswp__caption"&gt;
&lt;div class="pswp__caption__center"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
--&gt;</description></item><item><title>miniature airspeed sensor</title><link>https://lubin.kerhuel.eu/slides/pitot-build/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/slides/pitot-build/</guid><description>&lt;h2 id="pitot-tube"&gt;Pitot tube&lt;/h2&gt;
&lt;h3 id="miniature-airspeed-sensor"&gt;Miniature airspeed sensor&lt;/h3&gt;
&lt;h4 id="for-rc-plane--uav"&gt;for RC plane &amp;amp; UAV&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://lubin.kerhuel.eu/post/pitot-build"&gt;full&lt;/a&gt; description&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="https://lubin.kerhuel.eu/post/pitot-build/featured.jpg" alt="/post/pitot-build/featured.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="brass-tube"&gt;Brass tube&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-brasstubes.jpg" alt="/img/pitot-darcy-prandtl-build-brasstubes.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="mp3v5004dp--mcp3428"&gt;mp3v5004dp &amp;amp; mcp3428&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg" alt="/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Resolution: 0.2041 Pa/LSB&lt;/li&gt;
&lt;li&gt;Range: [0 836] Pa ($\approx 100km/h $)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="static-sensor-noise"&gt;Static sensor noise&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;90 min log @ 100Hz, indoor, still&lt;/li&gt;
&lt;li&gt;Standard Dev : 0.5 Pa&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;section data-background-image="/img/pitot-darcy-prandtl-static-characteristic.png" data-background-opacity=1 data-background-position="center" data-background-size="contain"&gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h2 id="flight-tests"&gt;Flight tests&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg" alt="Plane" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p class="stretch"&gt;
&lt;img data-src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg"&gt;
&lt;/p&gt;
&lt;!-- ![Wing with Pitot](/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg) --&gt;
&lt;hr&gt;
&lt;p class="stretch"&gt;
&lt;img data-src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-carbon2.jpg"&gt;
&lt;/p&gt;
&lt;!-- &lt;section data-background-image="/img/pitot-darcy-prandtl-wing-carbon2.jpg" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt; --&gt;
&lt;hr&gt;
&lt;h2 id="pressure---speed"&gt;Pressure - Speed&lt;/h2&gt;
&lt;p&gt;$P_{diff} = \frac{1}{2}\rho v^2$&lt;/p&gt;
&lt;p&gt;$v = \sqrt{\frac{2}{\rho} * P_{diff}}$&lt;/p&gt;
&lt;p&gt;with $\rho = 1.16 $&lt;/p&gt;
&lt;hr&gt;
&lt;section data-background-image="/img/pitot-darcy-prandtl-gps-wind-calibration-0.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="/img/pitot-darcy-prandtl-gps-wind-calibration-1.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="/img/pitot-darcy-prandtl-speed-error-wind-estimation.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="/img/pitot-darcy-prandtl-gps-wind-calibration-2.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="/img/pitot-darcy-prandtl-gps-wind-calibration-3.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="/img/pitot-darcy-prandtl-gps-wind-calibration.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h2 id="results"&gt;results&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;$\underbrace{v_{pitot}-v_{wind}^{p}-v_{gps}}_{error}$&lt;/th&gt;
&lt;th style="text-align: center"&gt;m/s&lt;/th&gt;
&lt;th style="text-align: center"&gt;km/h&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;mean&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.017&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.06&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;standard deviation&lt;/td&gt;
&lt;td style="text-align: center"&gt;0.74&lt;/td&gt;
&lt;td style="text-align: center"&gt;2.6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;&lt;/td&gt;
&lt;td style="text-align: center"&gt;&lt;/td&gt;
&lt;td style="text-align: center"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;with wind:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;2.6 m/s&lt;/li&gt;
&lt;li&gt;from 101° (east)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href="https://lubin.kerhuel.eu/post/pitot-build"&gt;page&lt;/a&gt; with further details&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="flight-trace"&gt;flight trace&lt;/h3&gt;
&lt;section data-background-iframe="https://www.google.com/maps/d/u/0/embed?mid=1-K7dsmfbMCDL3IQK1z3IEtSduB2OWXr9" data-background-opacity=1&gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h3 id="connecting-fish-line-protection"&gt;connecting (fish line protection)&lt;/h3&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg" alt="/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;</description></item><item><title>Prototypage Rapide avec Simulink sur dsPIC</title><link>https://lubin.kerhuel.eu/slides/slides_dcmotor_insa/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/slides/slides_dcmotor_insa/</guid><description>&lt;h2 id="prototypage-rapide"&gt;Prototypage Rapide&lt;/h2&gt;
&lt;h3 id="model-based-design"&gt;Model Based Design&lt;/h3&gt;
&lt;p class="stretch"&gt;
&lt;a href="https://fr.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink-dspic-pic32-and-sam-mcu/"&gt;
&lt;img data-src="https://lubin.kerhuel.eu/img/logo_mplab-deviceblocksforsimulink-whitebackground.png"&gt;
&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;[&lt;a href="https://rtdc.ctrl-elec.fr/" target="_blank" rel="noopener"&gt;Lab&lt;/a&gt;] - &lt;a href="https://lubin.kerhuel.eu/authors/lubin"&gt;L.Kerhuel&lt;/a&gt; - &lt;a href="https://lubin.kerhuel.eu/authors/romain-delpoux"&gt;R.Delpoux&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="plan"&gt;Plan:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Model Based Design&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Model&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;De la simulation au programme embarqué&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Différences temporelles&lt;/li&gt;
&lt;li&gt;type de données et optimisation&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-transition="fade"
data-transition_speed="slow"
&gt;
&lt;h2 id="model-based-design-mdb"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_01_Close.jpg" alt="./Picooz_01_Close.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-transition="fade"
data-transition_speed="slow"
&gt;
&lt;h2 id="model-based-design-mdb-1"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_02_Open.jpg" alt="./Picooz_01_Open.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-transition="fade"
data-transition_speed="slow"
&gt;
&lt;h2 id="model-based-design-mdb-2"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_03_Motor.jpg" alt="./Picooz_03_Close.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-background-color="#FFFFFF"
&gt;
&lt;p class="stretch"&gt;
&lt;img data-src="./Picooz_DC_Motor_Electronic_All.png"&gt;
&lt;/p&gt;
&lt;aside class="notes"&gt;
Commande en Vitesse
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="model-based-design-mdb-3"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_IdentificatoinBlockPresentation.png" alt="./Picooz_IdentificatoinBlockPresentation.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class="notes"&gt;
Identification
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="model-based-design-mdb-4"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;div
style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"&gt;
&lt;iframe
src="https://player.vimeo.com/video/309895581?dnt=0"
style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allow="fullscreen"&gt;
&lt;/iframe&gt;
&lt;/div&gt;
&lt;!--
&lt;div
class="stretch"&gt;
&lt;iframe
src="https://player.vimeo.com/video/309895581?dnt=0" allow="fullscreen" title="test"&gt;
&lt;/iframe&gt;
&lt;/div&gt;
--&gt;
&lt;!-- [Video](C:/M91449/MCHP_Blockset/Developpements/2013_08_19_Masters2013/Fig/Video_Logs_Shirp.avi) --&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_Identificatoin_eq_01.png" alt="./Picooz_Identificatoin_eq_01.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_Identificatoin_eq_02.png" alt="./Picooz_Identificatoin_eq_02.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class="notes"&gt;
rasoir d&amp;rsquo;Ockham
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_SuperTwistingController.png" alt="./Picooz_SuperTwistingController.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-background-color="#FFFFFF"
&gt;
&lt;section data-background-image="./Picooz_SetpLarge_ClosedLoop_SimuVsReal.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;aside class="notes"&gt;
Prediction Simu vs reel
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="model-based-design-1"&gt;&lt;span style="color:yellow"&gt;Model&lt;/span&gt; Based Design&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Identification&lt;/li&gt;
&lt;li&gt;Simulation / synthèse commande&lt;/li&gt;
&lt;li&gt;Test&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id="tp-validation-du-modèle-de-moteur-dc-fournit"&gt;TP: Validation du modèle de moteur DC fournit&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;log de command &amp;amp; réponse&lt;/li&gt;
&lt;li&gt;Simulation comparaison
&lt;ul&gt;
&lt;li&gt;commande avec modèle moteur
vs&lt;/li&gt;
&lt;li&gt;système réel&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="tp-validation-du-modèle-de-moteur-dc-fournit-1"&gt;TP: Validation du modèle de moteur DC fournit&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Simulink_DCMotorPravalux_LogVsSimu.png" alt="./Simulink_DCMotorPravalux_LogVsSimu.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="de-la-simulation-au-programme-embarqué"&gt;De la simulation au programme embarqué&lt;/h2&gt;
&lt;hr&gt;
&lt;div
style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"&gt;
&lt;iframe
src="https://player.vimeo.com/video/309876246?dnt=0"
style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allow="fullscreen"&gt;
&lt;/iframe&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;h2 id="pendule-inverse"&gt;&lt;a href="https://lubin.kerhuel.eu/docs/inverted-pendulum/"&gt;Pendule inverse&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Inverted_Pendulum_ControlLoopCloseUp.png" alt="./Inverted_Pendulum_ControlLoopCloseUp.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;aside class="notes"&gt;
&lt;ol&gt;
&lt;li&gt;Couleurs : Period echantillonnage&lt;/li&gt;
&lt;li&gt;Datatype&lt;/li&gt;
&lt;/ol&gt;
&lt;/aside&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="aspect-temporel"&gt;Aspect Temporel:&lt;/h2&gt;
&lt;h3 id="simulation"&gt;Simulation&lt;/h3&gt;
&lt;p&gt;Modélisation en temps continue:&lt;/p&gt;
&lt;p&gt;transformé de Laplace en p (s)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Solver résoud les équations différentielles
&lt;ul&gt;
&lt;li&gt;approximation numérique&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Pas de contraintes temps réelle
&lt;ul&gt;
&lt;li&gt;différent solveurs (Runge-Kutta, ODEx,&amp;hellip;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class="notes"&gt;
&lt;ol&gt;
&lt;li&gt;Couleurs : Period echantillonnage
DSPACE discretise le modèle&lt;/li&gt;
&lt;/ol&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="aspect-temporel-1"&gt;Aspect Temporel:&lt;/h2&gt;
&lt;h3 id="implémentation"&gt;Implémentation&lt;/h3&gt;
&lt;p&gt;Implémentation en temps discret:&lt;/p&gt;
&lt;p&gt;&amp;ldquo;pas&amp;rdquo; de calcul fixe&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pas de solveur&lt;/li&gt;
&lt;li&gt;Contrainte temps réel
&lt;ul&gt;
&lt;li&gt;model Single-Rate &amp;amp; Multi-Rate&lt;/li&gt;
&lt;li&gt;implementation Single-Tasking &amp;amp; Multi-Tasking&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class="notes"&gt;
Single Rate / Multi rate
Single Tasking / Multi Tasking
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="discrete-times"&gt;Discrete times&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Single-rate&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Les blocks ont tous la même période d&amp;rsquo;exécution
(Même couleur)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Multi-Rate&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Les blocks peuvent avoir des périodes d&amp;rsquo;exécution différentes
(Schéma multicolore)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="modèle-multi-rate"&gt;Modèle multi-rate&lt;/h4&gt;
&lt;p class="stretch"&gt;
&lt;img data-src="./Model_Hardware_Test_withSampleTime.png"&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_SingleTasking_70MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h4 id="charge-cpu-dun-modèle-multi-rate-single-tasking-70-mips"&gt;Charge CPU d&amp;rsquo;un modèle multi-rate single-tasking (@70 mips)&lt;/h4&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_SingleTasking_70MIPS.png" alt="./Scope_SingleTasking_70MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_SingleTasking_70MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h4 id="charge-cpu-dun-modèle-multi-rate-single-tasking-20-mips"&gt;Charge CPU d&amp;rsquo;un modèle multi-rate single-tasking (@20 mips)&lt;/h4&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_SingleTasking_20MIPS.png" alt="./Scope_SingleTasking_20MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_SingleTasking_20MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;aside class="notes"&gt;
OVERLOAD
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="single-tasking"&gt;Single-Tasking&lt;/h2&gt;
&lt;p&gt;Single-Tasking: Dans le slot de temps, l&amp;rsquo;exécution de tous les blocks doit se terminer avant la fin du slot.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="multi-tasking"&gt;Multi-Tasking&lt;/h2&gt;
&lt;p&gt;Multi-Tasking: Préemption possible -&amp;gt; &lt;strong&gt;Monotonic Rate Scheduler&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;La tâche la plus fréquente à la priorité maximale
&lt;ul&gt;
&lt;li&gt;Préemptera une tache plus lente&lt;/li&gt;
&lt;li&gt;Beaucoup plus flexible&lt;/li&gt;
&lt;li&gt;Mode par défaut (voir options du solveur)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="charge-cpu-dun-modèle-multi-rate-multi-tasking-70-mips"&gt;Charge CPU d&amp;rsquo;un modèle multi-rate multi-tasking (@70 mips)&lt;/h4&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_MultiTasking_70MIPS.png" alt="./Scope_MultiTasking_70MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_MultiTasking_70MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h4 id="charge-cpu-dun-modèle-multi-rate-multi-tasking-20-mips"&gt;Charge CPU d&amp;rsquo;un modèle multi-rate multi-tasking (@20 mips)&lt;/h4&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_MultiTasking_20MIPS.png" alt="./Scope_MultiTasking_20MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_MultiTasking_20MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_MultiTasking_SchedulerIllustration.png" alt="./Scope_MultiTasking_70MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_MultiTasking_70MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h2 id="tasking-conclusion"&gt;Tasking Conclusion&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Single-Tasking @ 20 MIPS -&amp;gt; &lt;strong&gt;Overload&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatcher la tache la plus lente sur plusieurs slots&lt;/li&gt;
&lt;li&gt;(option d&amp;rsquo;offset dans &lt;strong&gt;Time Step&lt;/strong&gt; -&amp;gt; &lt;em&gt;[.001 .005])&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Multi-Tasking @ 20 MIPS -&amp;gt; &lt;strong&gt;Ok&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rate transfert block options
&lt;ul&gt;
&lt;li&gt;Data Integrity&lt;/li&gt;
&lt;li&gt;Deterministic data transfert&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class="notes"&gt;
20 MIPS ok avec multi-tasking
Single tasking: deterministe
&lt;/aside&gt;
&lt;hr&gt;
&lt;h1 id="optimisation"&gt;Optimisation&lt;/h1&gt;
&lt;h2 id="type-de-données"&gt;type de données&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Virgule Fixe&lt;/li&gt;
&lt;li&gt;Virgule Flottante&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="virgule-fixe"&gt;Virgule fixe&lt;/h2&gt;
&lt;h3 id="int8"&gt;int8&lt;/h3&gt;
&lt;p&gt;$\underbrace{1}_{sign\ (1)} \ \underbrace{1111111}_{mantisse\ (7)} * \underbrace{slope}_{\text{LSB value}}$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;$v = (mantisse-sign*128) * slope $&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plage: $\pm 2^{7} * slope$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2 digit [0-9] significatifs&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class="notes"&gt;
slope est fixe
&lt;/aside&gt;
&lt;hr&gt;
&lt;section data-background-image="./FloatFixed_1.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-shortcode-section&gt;
&lt;h2 id="virgule-flotante"&gt;Virgule flotante&lt;/h2&gt;
&lt;h3 id="single-32-bits"&gt;Single (32 bits)&lt;/h3&gt;
&lt;p&gt;$\underbrace{1}_{sign\ (1)} \ \underbrace{11111111}_{exponent\ (8)} \ \color{yellow}{1}\underbrace{11111111111111111111111}_{mantisse\ (23)} $&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;$v \approx (1-2 sign) * mantisse * 2^{exponent-127}$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plage: $\pm 2^{128} = \pm 3.4*10^{38}$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;7 digit [0-9] significatifs&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/section&gt;
&lt;section data-shortcode-section&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;IEEE 754&lt;/th&gt;
&lt;th style="text-align: center"&gt;Single&lt;/th&gt;
&lt;th style="text-align: center"&gt;Double&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Format width&lt;/td&gt;
&lt;td style="text-align: center"&gt;32&lt;/td&gt;
&lt;td style="text-align: center"&gt;64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Sign bit&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;exponent width&lt;/td&gt;
&lt;td style="text-align: center"&gt;8&lt;/td&gt;
&lt;td style="text-align: center"&gt;11&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Precision width&lt;/td&gt;
&lt;td style="text-align: center"&gt;23&lt;span style="color:yellow"&gt;+1&lt;/span&gt;&lt;/td&gt;
&lt;td style="text-align: center"&gt;52&lt;span style="color:yellow"&gt;+1&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;span style="color:yellow"&gt;1st&lt;/span&gt; phantom bitof the significand is always 1.&lt;/p&gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h2 id="virgule-flotante-1"&gt;Virgule flotante&lt;/h2&gt;
&lt;h3 id="custom-8-bits"&gt;Custom (8 bits)&lt;/h3&gt;
&lt;p&gt;$\underbrace{1}_{sign\ (1)} \ \underbrace{1111}_{exponent\ (4)} \ \color{yellow}{1}\underbrace{111}_{mantisse\ (3)} $&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;$v \approx (1-2 sign) * mantisse * 2^{exponent-127}$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plage: $\pm 2^{128} = 3.4*10^{38}$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;0.9 digit [0-9] significatifs&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="custom-8-bit-floating-point"&gt;Custom 8 bit Floating point&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;Parameter&lt;/th&gt;
&lt;th style="text-align: center"&gt;Single&lt;/th&gt;
&lt;th style="text-align: center"&gt;Double&lt;/th&gt;
&lt;th style="text-align: center"&gt;Custom&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Format width&lt;/td&gt;
&lt;td style="text-align: center"&gt;32&lt;/td&gt;
&lt;td style="text-align: center"&gt;64&lt;/td&gt;
&lt;td style="text-align: center"&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Sign bit&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;exponent width&lt;/td&gt;
&lt;td style="text-align: center"&gt;8&lt;/td&gt;
&lt;td style="text-align: center"&gt;11&lt;/td&gt;
&lt;td style="text-align: center"&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Precision width&lt;/td&gt;
&lt;td style="text-align: center"&gt;23+1&lt;/td&gt;
&lt;td style="text-align: center"&gt;52+1&lt;/td&gt;
&lt;td style="text-align: center"&gt;3+1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;section data-background-image="./FloatFixed_2.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="./FloatFixed_3.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="./FloatFixed_4.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;aside class="notes"&gt;
Integrateur (avec petit TS)
GPS
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="script-matlab-pour-tester-un-flottant-8-bits"&gt;Script Matlab pour tester un flottant 8 bits&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-MATLAB" data-lang="MATLAB"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% 4 bit exponent (signed)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;emin&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;emax&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% 3 bits significand&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;exps&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;2.&lt;/span&gt;^&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;emin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;emax&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;vals&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;^&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;^&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)];&lt;/span&gt; &lt;span class="c"&gt;% significand with leading 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;TotalVal&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vals&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;*&lt;/span&gt;&lt;span class="n"&gt;exps&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% add denormalized values&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="n"&gt;bitFloat&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;unique&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;TotalVal&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;^&lt;span class="n"&gt;emin&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;^&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="n"&gt;bitFloat&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;unique&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;flipud&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;TotalVal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="n"&gt;TotalVal&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt; &lt;span class="c"&gt;% with neg vals&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id="simulink"&gt;Simulink&lt;/h1&gt;
&lt;hr&gt;
&lt;h2 id="data-type"&gt;Data-type&lt;/h2&gt;
&lt;p class="stretch"&gt;
&lt;img data-src="./Simulink_TypeCast_FixPtFormat.png"&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="data-type-notation"&gt;Data-type notation&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;int8&amp;hellip;uint23&lt;/li&gt;
&lt;li&gt;fixdt(1,16)
&lt;ul&gt;
&lt;li&gt;signed (1)&lt;/li&gt;
&lt;li&gt;16 bit width&lt;/li&gt;
&lt;li&gt;Scaling is derived from defined min &amp;amp; max&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;fixdt(1,16,15)
&lt;ul&gt;
&lt;li&gt;Scaling is &lt;span style="color:yellow"&gt;En&lt;/span&gt;15 (Exp neg $\rightarrow 2^{-15}$)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;fixdt(1,16,-15)
&lt;ul&gt;
&lt;li&gt;Scaling is &lt;span style="color:yellow"&gt;E&lt;/span&gt;15 (Exp $\rightarrow 2^{15}$)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="datatype-notation"&gt;Datatype notation&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Simulink_TypeCast_SlopeAndBias.png" alt="./Simulink_TypeCast_SlopeAndBias.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;fixdt(1,16,.01,0)
&lt;ul&gt;
&lt;li&gt;Scaling is sfix16&lt;span style="color:yellow"&gt;Sp&lt;/span&gt;01
&lt;ul&gt;
&lt;li&gt;Slope point 01&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Simulink_TypeCast_SlopeAndBias_Sat.png" alt="./Simulink_TypeCast_SlopeAndBias_Sat.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span style="color:yellow"&gt;SI&lt;/span&gt;: Stored Integer&lt;/li&gt;
&lt;li&gt;&lt;span style="color:yellow"&gt;RWV&lt;/span&gt;: Real World Value&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="tp"&gt;TP&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://rtdc.ctrl-elec.fr/" target="_blank" rel="noopener"&gt;https://rtdc.ctrl-elec.fr/&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="download"&gt;download&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/rdelpoux/INSA_TP_CommandeTempsReel_MCC/raw/master/LABMatlabFiles/02_GettingStarted/MCLV2_dsPIC33EP256MC506_base_R2017a.zip" target="_blank" rel="noopener"&gt;base model&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="elements-de-correction"&gt;Elements de correction&lt;/h2&gt;
&lt;hr&gt;
&lt;h2 id="liens"&gt;Liens:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;MPLAB device blocks for Simulink:
&lt;a href="https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink" target="_blank" rel="noopener"&gt;https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MPLAB X:
&lt;a href="https://www.microchip.com/MPLABX" target="_blank" rel="noopener"&gt;https://www.microchip.com/MPLABX&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;XC16:
&lt;a href="https://www.microchip.com/XC16" target="_blank" rel="noopener"&gt;https://www.microchip.com/XC16&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://lubin.kerhuel.eu" target="_blank" rel="noopener"&gt;https://lubin.kerhuel.eu&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://www.ctrl-elec.fr" target="_blank" rel="noopener"&gt;https://www.ctrl-elec.fr&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id="slide-control"&gt;Slide control:&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Next: &lt;code&gt;Right Arrow&lt;/code&gt; or &lt;code&gt;Space&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Previous: &lt;code&gt;Left Arrow&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Start: &lt;code&gt;Home&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Finish: &lt;code&gt;End&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Overview: &lt;code&gt;Esc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Speaker notes: &lt;code&gt;S&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Fullscreen: &lt;code&gt;F&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Zoom: &lt;code&gt;Alt + Click&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Prototypage Rapide avec Simulink sur dsPIC</title><link>https://lubin.kerhuel.eu/slides/slides_dcmotor_insa_2022_12/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/slides/slides_dcmotor_insa_2022_12/</guid><description>&lt;h2 id="prototypage-rapide"&gt;Prototypage Rapide&lt;/h2&gt;
&lt;h3 id="model-based-design"&gt;Model Based Design&lt;/h3&gt;
&lt;p class="stretch"&gt;
&lt;a href="https://fr.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink-dspic-pic32-and-sam-mcu/"&gt;
&lt;img data-src="https://lubin.kerhuel.eu/img/logo_mplab-deviceblocksforsimulink-whitebackground.png"&gt;
&lt;/a&gt;
&lt;/p&gt;
&lt;p&gt;[&lt;a href="https://rtdc.ctrl-elec.fr/" target="_blank" rel="noopener"&gt;Lab&lt;/a&gt;] - &lt;a href="https://lubin.kerhuel.eu/authors/lubin"&gt;L.Kerhuel&lt;/a&gt; - &lt;a href="https://lubin.kerhuel.eu/authors/romain-delpoux"&gt;R.Delpoux&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="objectifs-du-cours"&gt;Objectifs du cours&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Comprendre l&amp;rsquo;approche Model-Based Design&lt;/li&gt;
&lt;li&gt;Maîtriser les types de données (fixed point, flottant)&lt;/li&gt;
&lt;li&gt;Implémenter un contrôleur temps réel&lt;/li&gt;
&lt;li&gt;Comprendre l&amp;rsquo;implémentation multi-rate&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-transition="fade"
data-transition_speed="slow"
&gt;
&lt;h2 id="model-based-design-mdb"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_01_Close.jpg" alt="./Picooz_01_Close.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-transition="fade"
data-transition_speed="slow"
&gt;
&lt;h2 id="model-based-design-mdb-1"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_02_Open.jpg" alt="./Picooz_02_Open.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-transition="fade"
data-transition_speed="slow"
&gt;
&lt;h2 id="model-based-design-mdb-2"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_03_Motor.jpg" alt="./Picooz_03_Motor.jpg" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-background-color="#FFFFFF"
&gt;
&lt;p class="stretch"&gt;
&lt;img data-src="./Picooz_DC_Motor_Electronic_All.png"&gt;
&lt;/p&gt;
&lt;aside class="notes"&gt;
Commande en Vitesse
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="model-based-design-mdb-3"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_IdentificatoinBlockPresentation.png" alt="./Picooz_IdentificatoinBlockPresentation.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class="notes"&gt;
Identification
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="model-based-design-mdb-4"&gt;Model Based Design (MDB)&lt;/h2&gt;
&lt;div
style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"&gt;
&lt;iframe
src="https://player.vimeo.com/video/309895581?dnt=0"
style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allow="fullscreen"&gt;
&lt;/iframe&gt;
&lt;/div&gt;
&lt;!--
&lt;div
class="stretch"&gt;
&lt;iframe
src="https://player.vimeo.com/video/309895581?dnt=0" allow="fullscreen" title="test"&gt;
&lt;/iframe&gt;
&lt;/div&gt;
--&gt;
&lt;!-- [Video](C:/M91449/MCHP_Blockset/Developpements/2013_08_19_Masters2013/Fig/Video_Logs_Shirp.avi) --&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_Identificatoin_eq_01.png" alt="./Picooz_Identificatoin_eq_01.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_Identificatoin_eq_02.png" alt="./Picooz_Identificatoin_eq_02.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;aside class="notes"&gt;
rasoir d&amp;rsquo;Ockham
&lt;/aside&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Picooz_SuperTwistingController.png" alt="./Picooz_SuperTwistingController.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;section data-noprocess data-shortcode-slide
data-background-color="#FFFFFF"
&gt;
&lt;section data-background-image="./Picooz_SetpLarge_ClosedLoop_SimuVsReal.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;aside class="notes"&gt;
Prediction Simu vs reel
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="model-based-design-1"&gt;&lt;span style="color:yellow"&gt;Model&lt;/span&gt; Based Design&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Identification&lt;/li&gt;
&lt;li&gt;Simulation / synthèse commande&lt;/li&gt;
&lt;li&gt;Test&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h1 id="type-de-données"&gt;type de données&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Virgule Fixe&lt;/li&gt;
&lt;li&gt;Virgule Flottante&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="virgule-fixe"&gt;Virgule fixe&lt;/h2&gt;
&lt;h3 id="int8"&gt;int8&lt;/h3&gt;
&lt;p&gt;$\underbrace{1}_{sign\ (1)} \ \underbrace{1111111}_{mantisse\ (7)} * \underbrace{slope}_{\text{LSB value}}$&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;$v = (mantisse-sign*128) * slope $&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plage: $\pm 2^{7} * slope$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;2 digit [0-9] significatifs&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class="notes"&gt;
slope est fixe
&lt;/aside&gt;
&lt;hr&gt;
&lt;section data-background-image="./FloatFixed_1.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-shortcode-section&gt;
&lt;h2 id="virgule-flottante"&gt;Virgule flottante&lt;/h2&gt;
&lt;h3 id="single-32-bits"&gt;Single (32 bits)&lt;/h3&gt;
&lt;p&gt;$\underbrace{1}_{sign\ (1)} \ \underbrace{11111111}_{exponent\ (8)} \ \color{yellow}{1}\underbrace{11111111111111111111111}_{mantisse\ (23)} $&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;$v \approx (1-2 sign) * mantisse * 2^{exponent-127}$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plage: $\pm 2^{128} = \pm 3.4*10^{38}$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;7 digit [0-9] significatifs&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/section&gt;
&lt;section data-shortcode-section&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;IEEE 754&lt;/th&gt;
&lt;th style="text-align: center"&gt;Single&lt;/th&gt;
&lt;th style="text-align: center"&gt;Double&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Format width&lt;/td&gt;
&lt;td style="text-align: center"&gt;32&lt;/td&gt;
&lt;td style="text-align: center"&gt;64&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Sign bit&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;exponent width&lt;/td&gt;
&lt;td style="text-align: center"&gt;8&lt;/td&gt;
&lt;td style="text-align: center"&gt;11&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Precision width&lt;/td&gt;
&lt;td style="text-align: center"&gt;23&lt;span style="color:yellow"&gt;+1&lt;/span&gt;&lt;/td&gt;
&lt;td style="text-align: center"&gt;52&lt;span style="color:yellow"&gt;+1&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;span style="color:yellow"&gt;1st&lt;/span&gt; phantom bitof the significand is always 1.&lt;/p&gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h2 id="virgule-flottante-1"&gt;Virgule flottante&lt;/h2&gt;
&lt;h3 id="custom-8-bits"&gt;Custom (8 bits)&lt;/h3&gt;
&lt;p&gt;$\underbrace{1}_{sign\ (1)} \ \underbrace{1111}_{exponent\ (4)} \ \color{yellow}{1}\underbrace{111}_{mantisse\ (3)} $&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;$v \approx (1-2 sign) * mantisse * 2^{exponent-127}$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;plage: $\pm 2^{128} = 3.4*10^{38}$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;0.9 digit [0-9] significatifs&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="custom-8-bit-floating-point"&gt;Custom 8 bit Floating point&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: center"&gt;Parameter&lt;/th&gt;
&lt;th style="text-align: center"&gt;Single&lt;/th&gt;
&lt;th style="text-align: center"&gt;Double&lt;/th&gt;
&lt;th style="text-align: center"&gt;Custom&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Format width&lt;/td&gt;
&lt;td style="text-align: center"&gt;32&lt;/td&gt;
&lt;td style="text-align: center"&gt;64&lt;/td&gt;
&lt;td style="text-align: center"&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Sign bit&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;td style="text-align: center"&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;exponent width&lt;/td&gt;
&lt;td style="text-align: center"&gt;8&lt;/td&gt;
&lt;td style="text-align: center"&gt;11&lt;/td&gt;
&lt;td style="text-align: center"&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: center"&gt;Precision width&lt;/td&gt;
&lt;td style="text-align: center"&gt;23+1&lt;/td&gt;
&lt;td style="text-align: center"&gt;52+1&lt;/td&gt;
&lt;td style="text-align: center"&gt;3+1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;section data-background-image="./FloatFixed_2.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="./FloatFixed_3.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="./FloatFixed_4.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;aside class="notes"&gt;
Integrateur (avec petit TS)
GPS
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="script-matlab-pour-tester-un-flottant-8-bits"&gt;Script Matlab pour tester un flottant 8 bits&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-MATLAB" data-lang="MATLAB"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% 4 bit exponent (signed)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;emin&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;emax&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% 3 bits significand&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;p&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;exps&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="mf"&gt;2.&lt;/span&gt;^&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;emin&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;emax&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;vals&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;^&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;^&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)];&lt;/span&gt; &lt;span class="c"&gt;% significand with leading 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;TotalVal&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;vals&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;*&lt;/span&gt;&lt;span class="n"&gt;exps&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c"&gt;% add denormalized values&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;float8bit&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;unique&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;TotalVal&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;^&lt;span class="n"&gt;emin&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;^&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;float8bit&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;unique&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="nb"&gt;flipud&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;TotalVal&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;TotalVal&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt; &lt;span class="c"&gt;% with neg vals&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;h1 id="simulink"&gt;Simulink&lt;/h1&gt;
&lt;hr&gt;
&lt;h2 id="data-type"&gt;Data-type&lt;/h2&gt;
&lt;p class="stretch"&gt;
&lt;img data-src="./Simulink_TypeCast_FixPtFormat.png"&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="data-type-notation"&gt;Data-type notation&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;int8&amp;hellip;uint23&lt;/li&gt;
&lt;li&gt;fixdt(1,16)
&lt;ul&gt;
&lt;li&gt;signed (1)&lt;/li&gt;
&lt;li&gt;16 bit width&lt;/li&gt;
&lt;li&gt;Scaling is derived from defined min &amp;amp; max&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;fixdt(1,16,15)
&lt;ul&gt;
&lt;li&gt;Scaling is &lt;span style="color:yellow"&gt;En&lt;/span&gt;15 (Exp neg $\rightarrow 2^{-15}$)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;fixdt(1,16,-15)
&lt;ul&gt;
&lt;li&gt;Scaling is &lt;span style="color:yellow"&gt;E&lt;/span&gt;15 (Exp $\rightarrow 2^{15}$)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="datatype-notation"&gt;Datatype notation&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Simulink_TypeCast_SlopeAndBias.png" alt="./Simulink_TypeCast_SlopeAndBias.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;fixdt(1,16,.01,0)
&lt;ul&gt;
&lt;li&gt;Scaling is sfix16&lt;span style="color:yellow"&gt;Sp&lt;/span&gt;01
&lt;ul&gt;
&lt;li&gt;Slope point 01&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Simulink_TypeCast_SlopeAndBias_Sat.png" alt="./Simulink_TypeCast_SlopeAndBias_Sat.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span style="color:yellow"&gt;SI&lt;/span&gt;: Stored Integer&lt;/li&gt;
&lt;li&gt;&lt;span style="color:yellow"&gt;RWV&lt;/span&gt;: Real World Value&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="tp-moteur-pmsm"&gt;&lt;a href="https://rcp.ctrl-elec.fr/" target="_blank" rel="noopener"&gt;TP: Moteur PMSM&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./motorTeknic.png" alt="./motorTeknic.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="temps-réel"&gt;Temps Réel&lt;/h2&gt;
&lt;hr&gt;
&lt;div
style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"&gt;
&lt;iframe
src="https://player.vimeo.com/video/309876246?dnt=0"
style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allow="fullscreen"&gt;
&lt;/iframe&gt;
&lt;/div&gt;
&lt;hr&gt;
&lt;h2 id="pendule-inverse"&gt;&lt;a href="https://lubin.kerhuel.eu/docs/inverted-pendulum/"&gt;Pendule inverse&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Inverted_Pendulum_ControlLoopCloseUp.png" alt="./Inverted_Pendulum_ControlLoopCloseUp.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;aside class="notes"&gt;
&lt;ol&gt;
&lt;li&gt;Couleurs : Period echantillonnage&lt;/li&gt;
&lt;li&gt;Datatype&lt;/li&gt;
&lt;/ol&gt;
&lt;/aside&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="aspect-temporel"&gt;Aspect Temporel:&lt;/h2&gt;
&lt;h3 id="simulation"&gt;Simulation&lt;/h3&gt;
&lt;p&gt;Modélisation en temps continu:&lt;/p&gt;
&lt;p&gt;transformé de Laplace en p (s)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Solver résoud les équations différentielles
&lt;ul&gt;
&lt;li&gt;approximation numérique&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Pas de contraintes temps réelle
&lt;ul&gt;
&lt;li&gt;différent solveurs (Runge-Kutta, ODEx,&amp;hellip;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class="notes"&gt;
&lt;ol&gt;
&lt;li&gt;Couleurs : Period echantillonnage
DSPACE discretise le modèle&lt;/li&gt;
&lt;/ol&gt;
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="aspect-temporel-1"&gt;Aspect Temporel:&lt;/h2&gt;
&lt;h3 id="implémentation"&gt;Implémentation&lt;/h3&gt;
&lt;p&gt;Implémentation en temps discret:&lt;/p&gt;
&lt;p&gt;&amp;ldquo;pas&amp;rdquo; de calcul fixe&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pas de solveur&lt;/li&gt;
&lt;li&gt;Contrainte temps réel
&lt;ul&gt;
&lt;li&gt;model Single-Rate &amp;amp; Multi-Rate&lt;/li&gt;
&lt;li&gt;implementation Single-Tasking &amp;amp; Multi-Tasking&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class="notes"&gt;
Single Rate / Multi rate
Single Tasking / Multi Tasking
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="discrete-times"&gt;Discrete times&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Single-rate&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Les blocks ont tous la même période d&amp;rsquo;exécution
(Même couleur)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Multi-Rate&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Les blocks peuvent avoir des périodes d&amp;rsquo;exécution différentes
(Schéma multicolore)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="modèle-multi-rate"&gt;Modèle multi-rate&lt;/h4&gt;
&lt;p class="stretch"&gt;
&lt;img data-src="./Model_Hardware_Test_withSampleTime.png"&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_SingleTasking_70MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h4 id="charge-cpu-dun-modèle-multi-rate-single-tasking-70-mips"&gt;Charge CPU d&amp;rsquo;un modèle multi-rate single-tasking (@70 mips)&lt;/h4&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_SingleTasking_70MIPS.png" alt="./Scope_SingleTasking_70MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_SingleTasking_70MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h4 id="charge-cpu-dun-modèle-multi-rate-single-tasking-20-mips"&gt;Charge CPU d&amp;rsquo;un modèle multi-rate single-tasking (@20 mips)&lt;/h4&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_SingleTasking_20MIPS.png" alt="./Scope_SingleTasking_20MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_SingleTasking_20MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;aside class="notes"&gt;
OVERLOAD
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="single-tasking"&gt;Single-Tasking&lt;/h2&gt;
&lt;p&gt;Single-Tasking: Dans le slot de temps, l&amp;rsquo;exécution de tous les blocks doit se terminer avant la fin du slot.&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="multi-tasking"&gt;Multi-Tasking&lt;/h2&gt;
&lt;p&gt;Multi-Tasking: Préemption possible -&amp;gt; &lt;strong&gt;Monotonic Rate Scheduler&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;La tâche la plus fréquente à la priorité maximale
&lt;ul&gt;
&lt;li&gt;Préemptera une tache plus lente&lt;/li&gt;
&lt;li&gt;Beaucoup plus flexible&lt;/li&gt;
&lt;li&gt;Mode par défaut (voir options du solveur)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h4 id="charge-cpu-dun-modèle-multi-rate-multi-tasking-70-mips"&gt;Charge CPU d&amp;rsquo;un modèle multi-rate multi-tasking (@70 mips)&lt;/h4&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_MultiTasking_70MIPS.png" alt="./Scope_MultiTasking_70MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_MultiTasking_70MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h4 id="charge-cpu-dun-modèle-multi-rate-multi-tasking-20-mips"&gt;Charge CPU d&amp;rsquo;un modèle multi-rate multi-tasking (@20 mips)&lt;/h4&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_MultiTasking_20MIPS.png" alt="./Scope_MultiTasking_20MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_MultiTasking_20MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;p&gt;
&lt;figure &gt;
&lt;div class="d-flex justify-content-center"&gt;
&lt;div class="w-100" &gt;&lt;img src="./Scope_MultiTasking_SchedulerIllustration.png" alt="./Scope_MultiTasking_70MIPS.png" loading="lazy" data-zoomable /&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;section data-background-image="./Scope_MultiTasking_70MIPS.png" data-background-opacity=0.06 data-background-position="center" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h2 id="tasking-conclusion"&gt;Tasking Conclusion&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Single-Tasking @ 20 MIPS -&amp;gt; &lt;strong&gt;Overload&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;dispatcher la tache la plus lente sur plusieurs slots&lt;/li&gt;
&lt;li&gt;(option d&amp;rsquo;offset dans &lt;strong&gt;Time Step&lt;/strong&gt; -&amp;gt; &lt;em&gt;[.001 .005])&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Multi-Tasking @ 20 MIPS -&amp;gt; &lt;strong&gt;Ok&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rate transfert block options
&lt;ul&gt;
&lt;li&gt;Data Integrity&lt;/li&gt;
&lt;li&gt;Deterministic data transfert&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;aside class="notes"&gt;
20 MIPS ok avec multi-tasking
Single tasking: deterministe
&lt;/aside&gt;
&lt;hr&gt;
&lt;h2 id="tp"&gt;TP&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://rcp.ctrl-elec.fr/" target="_blank" rel="noopener"&gt;moteur PMSM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://rtdc.ctrl-elec.fr/" target="_blank" rel="noopener"&gt;moteur DC&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="download"&gt;download&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/rdelpoux/INSA_TP_CommandeTempsReel_MCC/raw/master/LABMatlabFiles/02_GettingStarted/MCLV2_dsPIC33EP256MC506_base_R2017a.zip" target="_blank" rel="noopener"&gt;base model&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="liens"&gt;Liens:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;MPLAB device blocks for Simulink:
&lt;a href="https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink" target="_blank" rel="noopener"&gt;https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MPLAB X:
&lt;a href="https://www.microchip.com/MPLABX" target="_blank" rel="noopener"&gt;https://www.microchip.com/MPLABX&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;XC16:
&lt;a href="https://www.microchip.com/XC16" target="_blank" rel="noopener"&gt;https://www.microchip.com/XC16&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://lubin.kerhuel.eu" target="_blank" rel="noopener"&gt;https://lubin.kerhuel.eu&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="https://www.ctrl-elec.fr" target="_blank" rel="noopener"&gt;https://www.ctrl-elec.fr&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="elements-de-correction"&gt;Elements de correction&lt;/h2&gt;
&lt;hr&gt;
&lt;section data-background-image="./TP_Correction_OpAmp.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="./TP_Correction_ADC.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;h2 id="pwm-settings"&gt;PWM settings&lt;/h2&gt;
&lt;hr&gt;
&lt;section data-background-image="./TP_Correction_PWM_Main.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="./TP_Correction_PWM_02.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="./TP_Correction_PWM_03.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="./TP_Correction_PWM_04.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;section data-background-image="./TP_Correction_PWM_05.png" data-background-opacity=1 data-background-position="center" data-background-size="contain" &gt;
&lt;/section&gt;
&lt;hr&gt;
&lt;hr&gt;
&lt;h1 id="slide-control"&gt;Slide control:&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Next: &lt;code&gt;Right Arrow&lt;/code&gt; or &lt;code&gt;Space&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Previous: &lt;code&gt;Left Arrow&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Start: &lt;code&gt;Home&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Finish: &lt;code&gt;End&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Overview: &lt;code&gt;Esc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Speaker notes: &lt;code&gt;S&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Fullscreen: &lt;code&gt;F&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Zoom: &lt;code&gt;Alt + Click&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;</description></item></channel></rss>