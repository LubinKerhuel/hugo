<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>DIY on Rapid Control Prototyping (RCP)</title><link>https://lubin.kerhuel.eu/tags/diy/</link><description>Recent content in DIY on Rapid Control Prototyping (RCP)</description><generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><copyright>&amp;copy; {year} Lubin Kerhuel</copyright><lastBuildDate>Tue, 28 May 2019 00:00:00 +0000</lastBuildDate><atom:link href="https://lubin.kerhuel.eu/tags/diy/index.xml" rel="self" type="application/rss+xml"/><item><title>Miniature air-speed sensor for RC plane or UAVs.</title><link>https://lubin.kerhuel.eu/post/pitot-build/</link><pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/pitot-build/</guid><description>
&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;p&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;/p&gt;
&lt;h2 id=&#34;pitot-tube-principle&#34;&gt;Pitot tube principle&lt;/h2&gt;
&lt;p&gt;A Pitot-Darcy probe is an air speed sensor commonly used in aviation. It consists of a tube pointing in the forward direction. When the sensor moves forward a stop pressure $P_t$ is added at its tip. The differential pressure $P_{diff}$ is measured between the tip of the tube $P_t$ and the static pressure $P_s$. One variant named from its inventor Prandtl tube has static air ports directly on the side of the tube.&lt;/p&gt;
&lt;p&gt;The pressure added at tube tip is the square of the air-speed : $P_t = P_s + \frac{1}{2}\rho v^2$ where $ P_t $ and $P_s$ are measured in Pascal unit (Pa). $\rho$ is the air density constant typically in $[1.14 \ 1.34]$ depending on temperature &amp;amp; altitude. $v$ is the air-speed in $m.s^{-1}$. The differential pressure measured is $P_{diff} = P_t - P_s = \frac{1}{2}\rho v^2$&lt;/p&gt;
&lt;h2 id=&#34;pitot-prandtl-tube&#34;&gt;Pitot-Prandtl tube&lt;/h2&gt;
&lt;p&gt;Prandtl tube is one version of a Pitot probe where an inner tube is placed in the center of an outer tube. Space between the two tubes is filled-in on few mm near the tip with an epoxy adhesive (Araldite or equivalent). The side of the outer tube is drilled to sense the static pressure. At the bottom, the inner tube which is longer act as a connector for the dynamic pressure sensor and third short tube is added to create a connector to the static pressure area which lies in the empty space between the two tube.&lt;/p&gt;
&lt;p&gt;The static pressure holes must be drilled at a minimum distance from the tube tip where airflow perturbations are reduced. A distance 4 times the diameter (d=4mm)of the outer tube is retains here (16mm). Four 1mm holes were drilled with a Dremel hand tool. The three tubes are presented on the figure below.&lt;/p&gt;
&lt;p&gt;First test was done using brass tubes. Inner tube width is 2/1mm (outside/inside) and outer tube is 4/3mm.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-brasstubes.jpg&#34; alt=&#34;Tube alfer from Leroy Merlin. Inner tube is 2mm/1mm. Outer tube is 4mm/3mm. Outer tube length is m=86mm. Four 1mm holes are drilled at l=16mm from the tip.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-brasstubes.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Brass inner and outer tubes of the Pitot tube.&lt;/h4&gt;
&lt;p&gt;Tube alfer from Leroy Merlin. Inner tube is 2mm/1mm. Outer tube is 4mm/3mm. Outer tube length is m=86mm. Four 1mm holes are drilled at l=16mm from the tip.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;References:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://naca.central.cranfield.ac.uk/reports/1957/naca-report-1303.pdf&#34;&gt;report&lt;/a&gt; by W.Gracey on the impact of the various shape on the measurement.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.planete-sciences.org/espace/IMG/pdf/tube_de_pitot.pdf&#34;&gt;report (french)&lt;/a&gt; from ANSTJ with general information on Pitot sensor.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://voiletech.free.fr/skyassistant/Pitot.htm&#34;&gt;website (French)&lt;/a&gt; from Rémi Bourgin with experimental Pitot tube for RC plane&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- Tube laiton macif (alfer) au Leroy Merlin;
Tube intèrieur: 2mm, trou 1mm
Tube extèrieur: 4mm, trou 3mm
Longueur total:
d = 4mm
l = 4d =&gt; 16mm
m = 11d =&gt;44mm
Tube altigator:
d = 4mm
l = 18mm
m = 72mm
--&gt;
&lt;h2 id=&#34;electronics&#34;&gt;Electronics&lt;/h2&gt;
&lt;h3 id=&#34;sensitivity-requirements-and-pressure-sensor&#34;&gt;Sensitivity requirements and Pressure sensor&lt;/h3&gt;
&lt;p&gt;The differential pressure measured vary with the square of the speed. RC plane speed can be quite low. Challenge is to be sensitive enough to obtain good measurement even in the low speed range of few meters per seconds.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; from NXP is a sensitive differential pressure sensor. Its differential measurement range goes from 0 to 3.92 kPa. The analog output is ratio-metric and swing from 0.6V to 3V ($\Delta V =2.4V$). For reference, 1 kPa is approximately the pressure of 10cm of water.&lt;/p&gt;
&lt;p&gt;We are interested in speed range varying from $0$ to $25 m.s^{-1}$ ($90km/h$) which correspond to a maximum differential pressure of 3.75 cm of water, or 0.375 kPa. The MP3V5004DP sensor is used in 10% of its nominal range.&lt;/p&gt;
&lt;p&gt;Table below provide theoretical differential pressure expected for various speed using $P_{diff} = \frac{1}{2}\rho v^2$ with $\rho=1.15$.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;v (m/s)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;v (Km/h)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$P_{diff}$ (Pa)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;~ $H_2O$ (cm)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; &amp;amp; &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; (0.2041Pa / LSB&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LSB&#34;&gt;&lt;a href=&#34;#fn:LSB&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.006&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.024&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;14.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.096&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;47&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;25.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;29.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.294&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;144&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;60&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;294&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;54&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;135&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;661&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;20&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;72&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;240&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1176&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;90&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;375&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1837&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;108&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;540&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2646&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;40&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;144&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;960&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;em&gt;4704&lt;/em&gt; (4095 sat)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;signal-conditioning-and-conversion&#34;&gt;Signal conditioning and conversion&lt;/h3&gt;
&lt;p&gt;The pressure sensor is placed close (~10cm) to the Pitot tube on the wing. The analog to digital conversion is also done on site to avoid noise pollution of analog signal. The &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; from Microchip is a high resolution sigma-delta converter with four differential inputs and a programmable gain factor from 1 to 8. It has a digital I2C interface to connect to the dsPIC and its I2C address can be modified. Similar DAC to consider are MCP342x family or the newer MCP346x family or MCP356x providing increased accuracy and higher sampling rate ; The package is smaller thus more difficult to handle for a DIY project.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; output analog signal is connected to the &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; Sigma-Delta ADC through a first order RC low pass filter with a cut off frequency at $28Hz$ ($R=5.6 kOhm$,$C=1\mu F$). The 2nd differential input is connected on a voltage divisor to obtain 1V from the 3.3V reference (480 &amp;amp; 1kOhms). $10\mu F$ decoupling capacitor are used on power supply. The I2C bus wires are pulled up with 10kOhm and are connected to a 10pf capacitor protecting from glitches.
&lt;!-- Measured 480 840 for the divisor. Write down 560 and 1.2k --&gt;&lt;/p&gt;
&lt;p&gt;The ADC Sigma-Delta is configured for&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;12 bits&lt;/li&gt;
&lt;li&gt;x8 Gain&lt;/li&gt;
&lt;li&gt;240 Samples Per Seconds (SPS)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The overall resolution is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;(1) &lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; Analog output sensitivity is 1633 Pa/V&lt;/li&gt;
&lt;li&gt;(2) &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; 12 bits with a gain of 8 : 0.125mV/LSB&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LSB&#34;&gt;&lt;a href=&#34;#fn:LSB&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;with (1) and (2), we obtain $1633 * 0.125e^{-3} $ = &lt;strong&gt;&lt;em&gt;0.2041 Pa / LSB&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LSB&#34;&gt;&lt;a href=&#34;#fn:LSB&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg&#34; alt=&#34;Differential pressure sensor (MP3V5004dp) with Analog to Digital converter integrating a differential amplifier (MCP3428). The MCP3428 communicate with the microcontroller through an I2C BUS. A MCP1700 3.3V voltage regulator adapt and filter out the 5V input voltage.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Pressure sensor and electronics mounted on a DIP adapter board.&lt;/h4&gt;
&lt;p&gt;Differential pressure sensor (MP3V5004dp) with Analog to Digital converter integrating a differential amplifier (MCP3428). The MCP3428 communicate with the microcontroller through an I2C BUS. A MCP1700 3.3V voltage regulator adapt and filter out the 5V input voltage.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id=&#34;sensor-static-tests&#34;&gt;Sensor static tests&lt;/h3&gt;
&lt;p&gt;A 90 minutes lasting measurement is performed indoor without movements. Sensor output were logged at 100Hz. The figure below shows a slow drift (correlated with temperature or battery decay ? TBD). The sensor standard deviation measured on the overall measurement is 0.54 Pa (including the drift).&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-static-characteristic.png&#34; alt=&#34;90 minutes lasting static measurement indoor shows a slow drift and a standard deviation of 0.54 Pa. Resolution is 0.2041 Pa / LSB&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-static-characteristic.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Experimental static characteristic of the MP3V5004dp differential pressure sensor&lt;/h4&gt;
&lt;p&gt;90 minutes lasting static measurement indoor shows a slow drift and a standard deviation of 0.54 Pa. Resolution is 0.2041 Pa / LSB&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h4 id=&#34;possible-noise-offset-sources&#34;&gt;possible noise/offset sources&lt;/h4&gt;
&lt;p&gt;The sensor is sensitive to its own orientation. Flipping the sensor up-side down creates an negative offset of 12.5mV (100 LSB&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LSB&#34;&gt;&lt;a href=&#34;#fn:LSB&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; with the analog to digital circuit setting).&lt;/p&gt;
&lt;p&gt;MCP5398 and MP3V5004dp are both powered with 3.3V. A linear voltage regulator (&lt;a href=&#34;http://ww1.microchip.com/downloads/en/DeviceDoc/20001826D.pdf&#34;&gt;MCP 1700&lt;/a&gt;) filter-out the 5V sensor board input to 3.3V. The analog signal remains however sensitive to fluctuation on the 5v input. Particular attention should be taken with telemetry which pollute power supply if they do not have their dedicated regulator. Also the electromagnetic burst from telemetry module might pollute the overall electronic including the ground; A periodic burst correlated with MAVLink packets sent was noticed on pitot output (20 to 300 LSB, nothing noticed on IMU sensors) caused by a 3DR telemetry module when its antenna is placed too close to non protected electronics part. Problem solved by moving the antenna away and reducing the Tx emitting power.&lt;/p&gt;
&lt;h2 id=&#34;flight-setup&#34;&gt;Flight setup&lt;/h2&gt;
&lt;p&gt;The sensor is mounted on the wing of a FirStar 1600 RC plane.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg&#34; alt=&#34;Platform used for tests&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;FirStar 1600 Volantex RC plane&lt;/h4&gt;
&lt;p&gt;Platform used for tests&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;A 2mm flexible tube, originally for protecting fish lines, connect the sensor to the Pitot tube.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:50%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg&#34; alt=&#34;Fishing Tube used to connect the differential pressure MP3V5004dp sensor to Pitot tube.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Flashmer – flexible Tube 2mm. Image from Decathlon (france).&lt;/h4&gt;
&lt;p&gt;Fishing Tube used to connect the differential pressure MP3V5004dp sensor to Pitot tube.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;One magnet is glued on the Pitot tube. A 2nd magnet integrated in the wing allows to fix the Pitot tube. Both magnet are in contact. The tube stays firmly in place during flights and ejects in case of hard landing reducing damages. It is a flexible solution for testing other Pitot tube design ; It&amp;rsquo;s also practical for storage and transportation.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg&#34; /&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Brass Pitot tube with its electronic board mounted onboard the Firstar 1600 fixed wing platform.&lt;/h4&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:60%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-carbon2.jpg&#34; alt=&#34;Outer tube is a 5/3mm carbon tube. Inner tube is a brass 2mm/1mm tube.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-carbon2.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Carbon-Brass light Pitot tube sensor attached to the wing with a magnet.&lt;/h4&gt;
&lt;p&gt;Outer tube is a 5/3mm carbon tube. Inner tube is a brass 2mm/1mm tube.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&#34;experimental-results&#34;&gt;Experimental results&lt;/h2&gt;
&lt;p&gt;The MCP3428 samples $P_{diff}$ at 250Hz during flights. $V_{Pitot}=\sqrt{\frac{2}{\rho}*P_{diff}}$ with $\rho = 1.15$.&lt;/p&gt;
&lt;p&gt;No calibration were required. Sensor theoretical output scaling were used with the formula to compute the speed from the pressure. $\rho$ value was tune from a default value 1.2 to 1.16 which minimized the mean error however the improvement was not a big deal. The only value to adjust is the raw pressure measurement offset (zero). The zero value for the sensor used is -1800.&lt;/p&gt;
&lt;p&gt;Matlab script converting 250Hz raw MCP3428 to Pressure (Pa) and Speed (m/s):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-matlab&#34;&gt;% Pitot Calibration. P_pitot is a vector with raw MCP3428 output read from I2C bus.
P_pitot_cal = 0.2041* (double(P_pitot) + 1800); % to Pa unit
% Compute Speed (m/s) from diff pressure (in Pa).
V_pitot = sqrt(max(0,(2/1.15) * P_pitot_cal));
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;gps-vs-air-speed&#34;&gt;Comparison with GPS ground speed&lt;/h3&gt;
&lt;p&gt;In calm condition, the Ground Speed $V_{GPS}$ and Air Speed $V_{Pitot}$ are equal.&lt;/p&gt;
&lt;p&gt;In windy condition, wind average direction and strength are estimated combining $V_{GPS}$, $V_{Pitot}$ and the plane yaw $\Theta_{heading}$ direction (using GPS COG&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:COG&#34;&gt;&lt;a href=&#34;#fn:COG&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;). This &lt;a href=&#34;#wind-estimation&#34;&gt;wind estimation&lt;/a&gt; is described below.&lt;/p&gt;
&lt;p&gt;The airplane ground speed (GPS) is estimated with the difference of the air speed (Pitot) with the projected wind to the aircraft forward direction:&lt;/p&gt;
&lt;p&gt;$V_{GPS} \approx V_{Pitot} - V_{wind}*cos(\Theta_{heading} + \Theta_{wind}) $&lt;/p&gt;
&lt;p&gt;The figure below presents the air speed in blue. The reconstructed ground speed (black) matches accurately with the GPS velocity (red) which prove the correctness of the air-speed measurement as well as the wind strength and direction. The onshore wind is laminar with limited turbulences. The air-speed measurement presents a high sensitivity even at low speed.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-gps-wind-calibration.png&#34; alt=&#34;GPS Speed over ground (red). Pitot air-speed (blue) computed with $\rho=1.15$. Reconstructed up-front wind (green). Pitot air-speed minus wind estimated (black) where $V_pitot$ is averaged and under-sampled by a factor 5 reducing its sampling rate from 250Hz to 50Hz. Up-front wind is estimated from the GPS COG angle ($\approx \theta_{heading}$), and the estimated wind strength ($V_{wind}= 2.5 m/s$) and direction ($\theta_{wind} = 101°$).&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-gps-wind-calibration.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Experimental measurement comparing GPS ground speed with pitot-tube air speed on 200s of a Firstar 1600 RC plane flight. Match between the GPS ground speed and the ground speed estimated from the pitot tube with wind correction.&lt;/h4&gt;
&lt;p&gt;GPS Speed over ground (red). Pitot air-speed (blue) computed with $\rho=1.15$. Reconstructed up-front wind (green). Pitot air-speed minus wind estimated (black) where $V_pitot$ is averaged and under-sampled by a factor 5 reducing its sampling rate from 250Hz to 50Hz. Up-front wind is estimated from the GPS COG angle ($\approx \theta_{heading}$), and the estimated wind strength ($V_{wind}= 2.5 m/s$) and direction ($\theta_{wind} = 101°$).&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;More figures in &lt;a href=&#34;https://lubin.kerhuel.eu/slides/pitot-build/#/10&#34;&gt;online presentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The GPS update rate is 10Hz. It is sampled at 50Hz to minimize delay. The pitot-tube update rate is 260Hs and it is sampled at 250Hz.&lt;/p&gt;
&lt;p&gt;The error is defined with $error = V_{gps} - \left( V_{Pitot} - V_{wind}*cos(\Theta_{heading} + \Theta_{wind}) \right) $. For the 200s of the flight shown on the figure, the error measured is:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;error&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;m/s&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;km/h&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;mean&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.017&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.06&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;standard deviation&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.74&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;RMS error is relatively low regarding the measured speed value. Part of the error is also due to wind gust and GPS limited accuracy particularly at estimating fast change of vertical speed.&lt;/p&gt;
&lt;h3 id=&#34;wind-estimation&#34;&gt;Wind estimation&lt;/h3&gt;
&lt;p&gt;Wind model considered is constant and characterized by&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;its constant direction $\Theta_{wind}$&lt;/li&gt;
&lt;li&gt;its constant strength $V_{wind}$&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;wind-v-pitot-v-gps&#34;&gt;Wind =&amp;gt; $V_{Pitot} - V_{gps}$&lt;/h4&gt;
&lt;p&gt;The curve below shows the difference between the Ground speed (GPS) with the air speed (Pitot) in function of the plane flight direction. This error (blue dashed points) fit with a sine wave. This sine wave is the speed offset added for each plane direction in $[0 \ 2\pi]$ by a wind with a constant strength and direction. Sine wave amplitude and phase is the wind strength and direction.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-speed-error-wind-estimation.png&#34; alt=&#34;Blue dots are speed difference between GPS and Pitot. The continuous green curve is the wind sine wave projection on the $\Theta_{heading}$ plane direction. Sine phase is wind direction ($(\pi-1.37*\frac{180}{\pi})=101°$, from East to West) and sine amplitude is wind strength (2.56m/s). Pitot values are averaged and under-sample by a factor 5.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-speed-error-wind-estimation.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Experimental result presenting GPS ground speed and Pitot air speed difference in function of the plane direction of 450s flight of the RC Firstar 1600 plane.&lt;/h4&gt;
&lt;p&gt;Blue dots are speed difference between GPS and Pitot. The continuous green curve is the wind sine wave projection on the $\Theta_{heading}$ plane direction. Sine phase is wind direction ($(\pi-1.37*\frac{180}{\pi})=101°$, from East to West) and sine amplitude is wind strength (2.56m/s). Pitot values are averaged and under-sample by a factor 5.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;This wind estimation is used to compensate the air-speed when comparing the GPS ground speed $V_{gps}$ with the Pitot air-speed $V_{Pitot}$ &lt;a href=&#34;https://lubin.kerhuel.eu/post/Pitot-build/#gps-vs-air-speed&#34;&gt;above&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&#34;script&#34;&gt;Script&lt;/h4&gt;
&lt;p&gt;Matlab script to estimate wind off-line:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-matlab&#34;&gt;% V_gps and V_pitot are two vector with all data measured.
% V_pitot was under-sampled (averaging) by a factor 5 to fit the 50Hz log from the GPS.
% GPS chip update frequency is 10Hz, but it is logged at 50Hz.
V_err = V_pitot - V_gps; % Ground and Air speed difference (i.e. wind)
M = [cos(COG); sin(COG) ]&#39;; % COG is the direction (Theta in rad) vector data measured from the GPS
y = V_err&#39;;
x = M\y; % Solve wind strength and direction using linear algebra (MMSE)
Theta_Wind = -atan2(x(2),x(1)); % Wind (go to) direction. Azimuth direction is opposite to trigo
V_Wind = sqrt(sum(x(1:2).^2)); % Wind strength (m/s)
plot(COG,V_err&#39;,&#39;.&#39;); hold on; % plot Error blue dots
plot([0:.01:(2*pi)],V_Wind*(cos([0:.01:(2*pi)]+ Theta_Wind)),&#39;-k&#39;,&#39;linewidth&#39;,3); % plot wind
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;discussion&#34;&gt;Discussion&lt;/h4&gt;
&lt;p&gt;Using the GPS COG&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:COG&#34;&gt;&lt;a href=&#34;#fn:COG&#34;&gt;2&lt;/a&gt;&lt;/sup&gt; field is not exactly the plane yaw direction $\Theta_{heading}$ but the plane flight direction.
Thus the COG is a biased plane yaw $\Theta_{heading}$ direction. It would be best to use plane orientation from the IMU sensor. It is not done here to reduce the number of sensors for this demonstration. The COG bias is small enough if we assume the wind speed to be small compared to the airplane air speed. It might be possible with a more sophisticated script to compensate this bias.&lt;/p&gt;
&lt;p&gt;W. Premerlani propose a &lt;a href=&#34;https://drive.google.com/file/d/0ByvTkVQo3tqXVzBYQUZicUNvbEE/view&#34;&gt;wind estimation&lt;/a&gt; using exclusively GPS data. Tests with this GPS dataset was not conclusive while trying to use all GPS sample while the platform direction is modified (i.e. COG derivative is above a given threshold). GPS dynamic seems too slow to provide robust results.&lt;/p&gt;
&lt;h4 id=&#34;other-flight-data&#34;&gt;Other flight data&lt;/h4&gt;
&lt;p&gt;Plane was equipped with two GPS:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;one uBlox M8N GPS and&lt;/li&gt;
&lt;li&gt;one MTK3339.
&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The uBlox trace presented on the map below is better than the MTK trace. The uBlox chip was used exclusively for the curves above. The MTK trace can be shown on the &lt;a href=&#34;https://www.google.com/maps/d/u/0/embed?mid=1-K7dsmfbMCDL3IQK1z3IEtSduB2OWXr9&#34;&gt;map&lt;/a&gt; (top left icon). The KML file can be opened with Google Earth which provide a 3D view of the trace showing the height of the plane.&lt;/p&gt;
&lt;iframe src=&#34;https://www.google.com/maps/d/u/0/embed?mid=1-K7dsmfbMCDL3IQK1z3IEtSduB2OWXr9&#34; style=&#34;width: 100% ; height: 480px&#34;&gt;&lt;/iframe&gt;
&lt;!--
Project folder:
C:\M91449\MCHP_Blockset\Projects\2017_10_Autopilote\2018_04_12_LogChampdeTir_PitotNum_magOk_LowWind
--&gt;
&lt;div class=&#34;footnotes&#34;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:LSB&#34;&gt;Least Significant Bit
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:LSB&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:COG&#34;&gt;Course Over Ground
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:COG&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>Inverted Pendulum</title><link>https://lubin.kerhuel.eu/docs/inverted-pendulum/</link><pubDate>Sun, 09 Sep 2018 00:00:00 +0200</pubDate><guid>https://lubin.kerhuel.eu/docs/inverted-pendulum/</guid><description>
&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:45%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_platform_top.png&#34; alt=&#34;Top of the inverted pendulum&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_platform_top.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;
&lt;p&gt;Top of the inverted pendulum&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h1 id=&#34;presentation&#34;&gt;Presentation&lt;/h1&gt;
&lt;p&gt;Stabilization of an inverted pendulum is a common engineering challenge. Objective is to build a low-cost DIY&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DIY&#34;&gt;&lt;a href=&#34;#fn:DIY&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; platform to test various feedback control loop.&lt;/p&gt;
&lt;p&gt;This document describes the hardware and the theoretical model of the pendulum.
Simulation are presented with Simulink models and an LQR&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LQR&#34;&gt;&lt;a href=&#34;#fn:LQR&#34;&gt;2&lt;/a&gt;&lt;/sup&gt; feedback control loop finally stabilizes the platform.&lt;/p&gt;
&lt;!-- test code --&gt;
&lt;p&gt;&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
&lt;iframe src=&#34;//player.vimeo.com/video/309876246&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;!-- You tube alternative:
&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
&lt;iframe src=&#34;//www.youtube.com/embed/dWTK7dTUvCo&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; allowfullscreen title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
&lt;/div&gt;
--&gt;
Video of the stabilized platform with a 4 state LQR feedback loop. The platform is completely autonomous (no user input).&lt;/p&gt;
&lt;p&gt;The electronic placed at the top of the pendulum composed of a dsPIC 16 bits microcontroller and an inertial sensor (accelerometers and rate gyro).
The base of the pendulum is a modified RC toys comprising two wheels driven by two independent DC motor (see &lt;a href=&#34;#hw_trolley&#34;&gt;pictures below&lt;/a&gt;).&lt;/p&gt;
&lt;h1 id=&#34;hardware&#34;&gt;Hardware&lt;/h1&gt;
&lt;h2 id=&#34;overview&#34;&gt;Overview&lt;/h2&gt;
&lt;p&gt;The head and the base trolley are described successively. They are separated with an $8mm$ carbon tube.
The pendulum length is $0.52m$ from wheel axis to the top. Wheels diameters is $8cm$. Pendulum total weight is $200g$ comprising $111g$ for the 4 AA batteries.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:60%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_platform_reduced_horizontal.png&#34; alt=&#34;Inverted Pendulum platform&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_platform.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;
&lt;p&gt;Inverted Pendulum platform&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&#34;head-electronics&#34;&gt;Head electronics&lt;/h2&gt;
&lt;h3 id=&#34;microcontroller&#34;&gt;Microcontroller&lt;/h3&gt;
&lt;p&gt;The controller is a &lt;code&gt;Microstick II&lt;/code&gt; board equipped with a &lt;code&gt;dsPIC 33EP128MC202&lt;/code&gt; running at $70\ MIPS$.
It is powered through the USB connector which &lt;strong&gt;only provide the power supply&lt;/strong&gt; from 4 AA batteries hold in the base.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_top.png&#34; alt=&#34;A prototyping board support a Microstick II board with the dsPIC 33EP128MC202. A board from Drotek endowing the Invensense ICM-20608 inertial sensor is screwed on the base board.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_top.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Microcontroller and sensor on top of the inverted pendulum&lt;/h4&gt;
&lt;p&gt;A prototyping board support a Microstick II board with the &lt;em&gt;dsPIC 33EP128MC202&lt;/em&gt;. A board from Drotek endowing the Invensense ICM-20608 inertial sensor is screwed on the base board.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id=&#34;imu-sensor&#34;&gt;IMU sensor&lt;/h3&gt;
&lt;p&gt;The unique sensor used is the 6 DoF&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DoF&#34;&gt;&lt;a href=&#34;#fn:DoF&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; Invensense &lt;code&gt;ICM-20608&lt;/code&gt; mounted on a &lt;a href=&#34;https://store.drotek.com/sensors/779-imu-6dof-icm20608-invensense-pcb-8944595424761.html&#34;&gt;Drotek sensor board&lt;/a&gt;. It endows:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a 3 axis Accelerometers and&lt;/li&gt;
&lt;li&gt;a 3 axis rate gyros.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The I2C blocks set the BUS clock at $400kHz$ and fetch the 6 sensors values every $1ms$ $(1kHz)$.
The Simulink I2C blocks setting enable hot plug of the I2C sensor: The microcontroller initializes the sensor each time it is newly detected on the I2C bus.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The accelerometer is configured with a range of $\pm 8g$ low pass filtered at $99Hz$.&lt;/li&gt;
&lt;li&gt;The rage gyro is configured with a range of $\pm 500 \deg/s$ low pass filtered at $250Hz$.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A Simulink IMU&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:IMU&#34;&gt;&lt;a href=&#34;#fn:IMU&#34;&gt;4&lt;/a&gt;&lt;/sup&gt; sub-system run a data fusion algorithm to reconstruct a drift-free quaternion angular position at $1kHz$ (the yaw angle drift when magnetometer is not present).
The stabilization control loop uses the drift-free pitch angle.&lt;/p&gt;
&lt;p&gt;It is possible to use other sensors like the MPU9250 or MPU6050 with either an I2C or SPI interface.
The GY-91 board is a 10 DoF&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DoF&#34;&gt;&lt;a href=&#34;#fn:DoF&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; widespread board based on the 9 DoF MPU9250 (3 accelerometers, 3 magnetometers, 3 rate gyros) and has a pressure sensor.&lt;/p&gt;
&lt;h3 id=&#34;UARTINTERFACE&#34;&gt;UART interface&lt;/h3&gt;
&lt;p&gt;The PCB board provides a $3.3V$ regulator and 4 pin extra interface ( GND, +3.3v, Tx, Rx ) to connect either an UART &lt;a href=&#34;https://github.com/d-ronin/openlager/wiki&#34;&gt;data-logger&lt;/a&gt; or &lt;a href=&#34;http://ardupilot.org/copter/docs/common-sik-telemetry-radio.html#common-sik-telemetry-radio&#34;&gt;radio link&lt;/a&gt; for telemetry module or an &lt;a href=&#34;https://www.frsky-rc.com/product/xsr/&#34;&gt;RC receiver&lt;/a&gt; capable of S.BUS, S.Port or P.Port protocol (all UART based).&lt;/p&gt;
&lt;h2 id=&#34;hw_trolley&#34;&gt;Base trolley&lt;/h2&gt;
&lt;h3 id=&#34;motors&#34;&gt;Motors&lt;/h3&gt;
&lt;p&gt;The base trolley is a low cost a 2-wheel remote control toy named &lt;code&gt;flywheels&lt;/code&gt;. The toy is from 2012 but 2 wheeled equivalents exist.
Its electronics is removed.
Two pairs of wires power two DC motors in either direction through an &lt;code&gt;L298N&lt;/code&gt; H bridge board module.&lt;/p&gt;
&lt;div class=&#34;gallery caption-position-bottom caption-effect-slide hover-effect-zoom hover-transition&#34; itemscope itemtype=&#34;http://schema.org/ImageGallery&#34;&gt;
&lt;div class=&#34;box&#34; &gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34; style=&#34;background-image: url(&#39;/img/pendulum_toysrus_flywheels_package.jpg&#39;);&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_package.jpg&#34; alt=&#34;FlyWheels toy package&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_package.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;FlyWheels toy package&lt;/h4&gt;
&lt;p&gt;FlyWheels toy package&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class=&#34;box&#34; &gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34; style=&#34;background-image: url(&#39;/img/pendulum_toysrus_flywheels_open.jpg&#39;);&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_open.jpg&#34; alt=&#34;Two DC motors&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_toysrus_flywheels_open.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Two DC motors&lt;/h4&gt;
&lt;p&gt;Two DC motors&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--
(pictures: [Package](Toysrus_FlyWheels_package.jpg), [vehicle](Toysrus_FlyWheels_Vehicle.jpg), [RC+vehicle](Toysrus_FlyWheels_Vehicle_Remote.jpg), [Inside](Toysrus_FlyWheels_Open.jpg))--&gt;
&lt;h3 id=&#34;power-electronics&#34;&gt;Power electronics&lt;/h3&gt;
&lt;p&gt;The L298N H bridge controls two DC motors. For each motor:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Two logic signals set the 4 states: direction CW or CCW, brake, or freewheel.&lt;/li&gt;
&lt;li&gt;The third logic signal power the motor depending on to the state defined.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The third signal is modulated with a 100Hz square periodic signal whose duty cycle vary from 0% to 100% (PWM). It sets the torque for the motor.&lt;/p&gt;
&lt;p&gt;The flat multicolor ribbon connects 6 logic control signals (3 for each motor) from the Microstick II dsPIC output to the of the L298N H bridge.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:60%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum_base.png&#34; alt=&#34;A L298N H bridge (for Arduino) power board drives the two DC motors of a modified FlyWheels toy. Four AA batteries powers the pendulum.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum_base.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Base trolley of the inverted pendulum&lt;/h4&gt;
&lt;p&gt;A &lt;em&gt;L298N H bridge&lt;/em&gt; (for Arduino) power board drives the two DC motors of a modified &lt;em&gt;FlyWheels&lt;/em&gt; toy. &lt;em&gt;Four AA batteries&lt;/em&gt; powers the pendulum.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id=&#34;batteries&#34;&gt;Batteries&lt;/h3&gt;
&lt;p&gt;Four $1.2V$ AA Ni-Mh batteries are dispatched on both side of the trolley.
$\approx 4.8V$ powers the motors and the electronics.
The black and red wire from the trolley to the top of the pendulum powers the Microstick II electronic and sensors.&lt;/p&gt;
&lt;h1 id=&#34;pendulum-model&#34;&gt;Pendulum Model&lt;/h1&gt;
&lt;p&gt;The pendulum model is composed of two intertwined sub-system:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The pendulum*, with 1 rotation DoF&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DoF&#34;&gt;&lt;a href=&#34;#fn:DoF&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; $\theta$ angle around the wheel&amp;rsquo;s axis&lt;/li&gt;
&lt;li&gt;The trolley*, with 1 translation DoF&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:DoF&#34;&gt;&lt;a href=&#34;#fn:DoF&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; $x$ position.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum-free-body-diagram.png&#34; alt=&#34;$\vec{P}$ is the weight at the center of gravity. $\vec{R}$ is the reaction force from the stiff rod and the floor. $\vec{F}$ is a friction force when the pendulum is rotating. $\{ \vec{i},\vec{j} \}$ is the earth frame and $\{ \vec{r},\vec{n} \}$ is the rotating pendulum frame. The inertial sensors are placed on top of the pendulum and measure all accelerations.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum-free-body-diagram.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Pendulum free body diagram&lt;/h4&gt;
&lt;p&gt;$\vec{P}$ is the weight at the center of gravity. $\vec{R}$ is the reaction force from the stiff rod and the floor. $\vec{F}$ is a friction force when the pendulum is rotating. $\{ \vec{i},\vec{j} \}$ is the earth frame and $\{ \vec{r},\vec{n} \}$ is the rotating pendulum frame. The inertial sensors are placed on top of the pendulum and measure all accelerations.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&#34;pendul-equations&#34;&gt;Pendul Equations&lt;/h2&gt;
&lt;p&gt;The Dynamic fundamental law applied on the pendulum:
$$ \sum \vec{Force} = m.\vec{a} $$&lt;/p&gt;
&lt;p&gt;The three forces presents are the weight $\vec{P}$, the Friction $\vec{F}$, and the Reaction $\vec{R}$ from the rod &amp;amp; floor:&lt;/p&gt;
&lt;p&gt;$$ \underbrace{ -mg\vec{j} }_{\vec{P}} \
- \ \underbrace{ k \frac{\partial \vec{r}}{\partial t} }_{\vec{F}} \
+ \ \underbrace{ ( mg\vec{j} . \vec{r} + \underbrace{Ctfg}_{\text{Centrifugal}} } _{\vec{R} } ) . \vec{r} = ml \frac{\partial^2\vec{ r }}{\partial t^2}
$$&lt;/p&gt;
&lt;p&gt;With $ \{ \vec{i},\vec{j} \} $ the static earth frame and $ \{ \vec{r},\vec{n} \} $ the pendulum frame (rod and normal direction).
$m$ is the mass of the pendulum (without the trolley).
$l$ is the length from the inter-wheel&amp;rsquo;s axis to the center of mass of the pendulum (without the trolley)&lt;/p&gt;
&lt;p&gt;$$
\left\{ \begin{array}{rcl}
\vec{i} &amp;amp; = &amp;amp; \vec{n} . cos(\theta) - \vec{r} . sin(\theta) \\&lt;br /&gt;
\vec{j} &amp;amp; = &amp;amp; \vec{n} . sin(\theta) + \vec{r} . cos(\theta)
\end{array} \right.
$$&lt;/p&gt;
&lt;p&gt;$$\vec{j}.\vec{r} = cos(\theta)$$&lt;/p&gt;
&lt;p&gt;Considering the rotation $\theta$, the first and second time derivative of $\vec{r}$ are:&lt;/p&gt;
&lt;p&gt;$$
\begin{array}{rcl}
\frac{\partial \vec{r}}{\partial t}
&amp;amp; = &amp;amp;
- \dot{\theta} \vec{n} \\&lt;br /&gt;
\frac{\partial^2\vec{ r }}{\partial t^2}
&amp;amp; = &amp;amp;
- \frac{\partial }{\partial t} \left( \dot{\theta} \vec{n} \right) \\&lt;br /&gt;
&amp;amp; = &amp;amp;
- \ddot{\theta} \vec{n} - \dot{\theta}^2 \vec{r}
\end{array}
$$&lt;/p&gt;
&lt;p&gt;The projection of the forces equation in the pendulum frame $ \{ \vec{r},\vec{n} \} $ is:
$$
\left\{ \begin{array}{rcl}
\left( ml\dot{\theta}^2 + Ctfg \right) \vec{r} = \vec{0} \\&lt;br /&gt;
\left( l \ddot{\theta} + \frac{k}{m}\dot{\theta} - g . sin(\theta) \right) \vec{n} = \vec{0}&lt;br /&gt;
\end{array} \right.
$$&lt;/p&gt;
&lt;p&gt;The first equation for the $\vec{r}$ axis shows internal forces which cancel each other: the weight $\vec{P} = -mg\vec{j}$ which is compensated on the $\vec{r}$ axis by the term $mg\vec{j}.\vec{r}$ from the reaction force which will also compensate for the Centrifugal force $ml\dot{\theta}^2$.&lt;/p&gt;
&lt;p&gt;The second differential equation on the $\vec{n}$ axis allows to solve for the evolution of the angle $\theta$.
It can be made linear with $sin(\theta) \approx \theta$ when the pendulum is up near $0$, or with $sin(\theta) \approx - (\theta - \pi)$ when the pendulum is down near $\pi$.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum-model-rod.png&#34; alt=&#34;non-linear model of the $\theta$ angle evolution derived from the forces projected on the normal $\vec{n}$ axis of the rod. The trolley linear acceleration input is added.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum-model-rod.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Pendulum model for rod rotation&lt;/h4&gt;
&lt;p&gt;non-linear model of the $\theta$ angle evolution derived from the forces projected on the normal $\vec{n}$ axis of the rod. The trolley linear acceleration input is added.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;The linear approximation for $\theta$ in the laplace domain is a $2^{nd}$ order system:
$$ \theta(s) \left ( \frac{1}{w_n^2}s^2 + \frac{2 \zeta}{w_n}s \pm 1 \right ) = 0 $$&lt;/p&gt;
&lt;p&gt;The pendulum transfer function $F_p = \frac{\theta(s)}{E(s)}$ with a null input $E(s) = 1$
$$ F_p(s) = \frac{1}{ \frac{1}{w_n^2}s^2 + \frac{2 \zeta}{w_n}s \pm 1 } $$&lt;/p&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
&lt;div&gt;
The linear term for $sin$ is positive when the pendulum is up when $\theta \approx 0$ (unstable), and negative when pendulum is down when $\theta \approx \pm \pi$ (stable).
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This transfer function is characterized when the pendulum is down by its natural frequency $w_n = \sqrt{ \frac{g}{l} } $, and a damping factor $\zeta$.&lt;/p&gt;
&lt;h2 id=&#34;pendul-identification&#34;&gt;Pendul identification&lt;/h2&gt;
&lt;p&gt;The parameter $l$ could be estimated from the platform mechanical but the damping parameter $\zeta$ (or frictions coefficient $k$) could not be estimated easily from the platform.&lt;/p&gt;
&lt;p&gt;The simulation model is satisfactory when the calculation it performs make realistic prediction.
Experimental measurement is a good method to refine a model and tune its parameters.
In our case, the parameters $l$ and $\zeta$ (or $k$) are identified from the experiment explained below.&lt;/p&gt;
&lt;h3 id=&#34;experimental-logs&#34;&gt;Experimental logs&lt;/h3&gt;
&lt;p&gt;The pendulum is placed on a track (two chairs back to back) to be able to make a complete rotation.
Motor are off and the pendulum is released up-side with in the unstable condition ($\theta = -18°$ , $\dot \theta = 0$).&lt;/p&gt;
&lt;p&gt;It oscillates until the damping friction ($\zeta$) stops the free oscillations.&lt;/p&gt;
&lt;p&gt;The $1kHz$ sampled rate gyro and accelerometers values are recorded onboard an &lt;a href=&#34;https://github.com/d-ronin/openlager/wiki&#34;&gt;openlager&lt;/a&gt; board connected on the dsPIC &lt;a href=&#34;#UARTINTERFACE&#34;&gt;UART&lt;/a&gt; interface.&lt;/p&gt;
&lt;h3 id=&#34;simulation-from-logs&#34;&gt;Simulation from logs&lt;/h3&gt;
&lt;p&gt;The measured inertial sensors are then re-used as data source in a Simulink model. $\theta$ angle is reconstructed using an IMU complementary filter algorithm implemented in the quaternion angle representation.&lt;/p&gt;
&lt;p&gt;The pendulum model is initialized with the experimentation initial condition ($\theta = -18°$ , $\dot \theta = 0$). Trolley linear acceleration input is null.
Parameters $l$ and $k$ are iteratively tuned until the model $\hat{\theta}$ angle fit with the measured oscillation $\theta$.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum-identification-theta.png&#34; alt=&#34;$\theta$ angle from free oscillation experiment is compared against two pendulum models. The pendulum is released at time $16.7s$ upside ($18°$) and let free to oscillate. The grey curve is the experimental angle reference reconstructed from inertial sensors measurements. The blue dashed curve is a pendulum model using a linear damping with $k = 0.4$. The red doted curve use a nonlinear damping with the nonlinear term -1.1*$sign(\dot{\theta})$ added to the linear damping with $k = 0.17$.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum-identification-theta.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Identification - experimental $\theta$ angle reconstructed from inertial sensors (wide grey curve) vs pendulum model (read and blue dashed curves)&lt;/h4&gt;
&lt;p&gt;$\theta$ angle from free oscillation experiment is compared against two pendulum models. The pendulum is released at time $16.7s$ upside ($18°$) and let free to oscillate. The grey curve is the experimental angle reference reconstructed from inertial sensors measurements. The blue dashed curve is a pendulum model using a linear damping with $k = 0.4$. The red doted curve use a nonlinear damping with the nonlinear term -1.1*$sign(\dot{\theta})$ added to the linear damping with $k = 0.17$.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Pendulum Parameters&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Identified Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;$l$&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;$0.45 m$&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;$k$&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;$0.4$&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;$w_n = \sqrt{\frac{g}{l}}$&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;$4.67\ rad.s^{-1}$ ( $0.74 Hz$ or $1.35s$ period )&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;⬆ Identified pendulum parameters&lt;/p&gt;
&lt;h3 id=&#34;validation-and-imu-improvement&#34;&gt;Validation and IMU improvement&lt;/h3&gt;
&lt;p&gt;Parameters $l$ and $k$ can be further validated using the force equation and the estimated pendulum angle $\theta$.&lt;/p&gt;
&lt;p&gt;The IMU input measurements is composed of the rate gyro and the accelerometers data. Magnetometers is not used in this pendulum example.
The IMU input also require the predicted acceleration vector (resp magnetometer is used).
The IMU output the sensor orientation and provides the gravity vector prediction as seen in the sensor estimated attitude (i.e. quaternion angle).&lt;/p&gt;
&lt;p&gt;Comparing the gravity vector predicted with the accelerometer&amp;rsquo;s measurement do not match because the sensor measures both the gravity plus the dynamic acceleration induced by the pendulum movements.&lt;/p&gt;
&lt;p&gt;Considering the pendulum principal movement rotation $\theta$, the equations of forces applied on the pendulum derive from $\hat \theta$ a prediction for the dynamic acceleration.
The good match between the predicted acceleration and the experimental measurement confirm somehow the correctness of parameters $l$ and $k$ involved in these calculations.&lt;/p&gt;
&lt;p&gt;The updated acceleration comprising both a static and dynamic part is fed into the IMU algorithm improving the IMU correction of the rate gyro integration drift even when the pendulum is not static.&lt;/p&gt;
&lt;h1 id=&#34;trolley-model&#34;&gt;Trolley Model&lt;/h1&gt;
&lt;h2 id=&#34;trolley-equations&#34;&gt;Trolley Equations&lt;/h2&gt;
&lt;div class=&#34;alert alert-warning&#34;&gt;
&lt;div&gt;
Below is under construction
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The translational movement of the trolley is modeled as a $1^{st}$ order system characterized by its time constant $\tau$.
This dynamic includes the motor dynamics when it is loaded with the trolley considering the pendulum as vertical.&lt;/p&gt;
&lt;p&gt;The model considers as negligible the effect of the pendulum forces (translational and rotational) applied on the trolley.&lt;/p&gt;
&lt;p&gt;$$ x(s) = \frac{1}{\tau s + 1} $$&lt;/p&gt;
&lt;h2 id=&#34;trolley-identification&#34;&gt;Trolley Identification&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Trolley Parameter&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Estimated Value&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;$\tau$&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;$0.3s$&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The trolley does not have any sensors. No encoder or current sensor are used to control the two motors.
The parameters $\tau$ is &amp;ldquo;guessed&amp;rdquo; in a first step.
In a second step, a $2^{nd}$ inertial sensor board is temporary glued in the middle of the wheel diameter to as the inertial sensor is in the wheel rotation axe.
An identification can be computed from the motor set-point and the wheel movements while the pendulum was actively controlled up by a first feedback loop.&lt;/p&gt;
&lt;p&gt;Still the pendulum model including the trolley is simulated with its feedback loop controller and results are compared against recorded data of the real system running the same feedback loop controller. The simulated pendulum states are re-initialized periodically ($\approx 2s$) with the real pendulum states as the model would diverge otherwise due to perturbations not modeled and model discrepancies. Correctness of the model can be checked between theses periodic re-initialization.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:45%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pendulum-gy91-wheel.jpg&#34; alt=&#34;The angular speed rate of the wheel is measured with one rate gyro form one added GY-91 sensor board. The GY-91 board is hot glued on one pendulum wheel. The pendulum is stabilized with a controller using an estimated trolley model. Four wires from the GY-91 to the microcontroller power the sensor and retrieve sensor data through the I2C bus (2 wires).&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pendulum-gy91-wheel.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Identification of trolley in real inverted pendulum condition.&lt;/h4&gt;
&lt;p&gt;The angular speed rate of the wheel is measured with one rate gyro form one added GY-91 sensor board. The GY-91 board is hot glued on one pendulum wheel. The pendulum is stabilized with a controller using an estimated trolley model. Four wires from the GY-91 to the microcontroller power the sensor and retrieve sensor data through the I2C bus (2 wires).&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h1 id=&#34;controller&#34;&gt;Controller&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;Stabilization overview:&lt;/code&gt; The microcontroller computes the angle of the pendulum from the inertial sensor measurements (accelerometers and rate gyro). A feedback loop stabilizes the pendulum up right while maintaining the pendulum position still. The pendulum translation is estimated through an internal dynamic model of the trolley stimulated with a copy of the DC motor command. The pendulum slow translations reflect the drift of the internal estimation of the displacement.&lt;/p&gt;
&lt;h2 id=&#34;linearized-model&#34;&gt;Linearized model&lt;/h2&gt;
&lt;h2 id=&#34;lqr-feedback-controller&#34;&gt;LQR feedback controller&lt;/h2&gt;
&lt;p&gt;Video of the inverted Pendulum when it encounters a wall:
&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
&lt;iframe src=&#34;//player.vimeo.com/video/309876329&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
&lt;/div&gt;
&lt;!-- You tube alternative:
&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
&lt;iframe src=&#34;//www.youtube.com/embed/xbu4hXOnemE&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; allowfullscreen title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
&lt;/div&gt;
--&gt;&lt;/p&gt;
&lt;p&gt;Another way to stabilize a pendulum with an electric seesaw (&lt;a href=&#34;https://sciencedemonstrations.fas.harvard.edu/presentations/inverted-pendulum&#34;&gt;video&lt;/a&gt;).&lt;/p&gt;
&lt;div class=&#34;footnotes&#34;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:DIY&#34;&gt;Do It Yourself
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:DIY&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:LQR&#34;&gt;Linear Quadratic Regulator
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:LQR&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:DoF&#34;&gt;Degree of Freedom
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:DoF&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:IMU&#34;&gt;Inertial Measurement Unit
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:IMU&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item></channel></rss>