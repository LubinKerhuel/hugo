<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=generator content="Wowchemy 5.4.0 for Hugo">
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400&family=Istok+Web&family=Roboto+Mono:wght@100;400&display=swap">
<link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400&family=Istok+Web&family=Roboto+Mono:wght@100;400&display=swap" media=print onload="this.media='all'">
<meta name=description content="The UxV toolbox provides matlab script and Simulink blocks for autopilot. Script to decode, visualise MAVlink logs and configure a Simulink model feeding MAVlink signal for simulation. Block adds MAVLink, GPS, and FrSky protocol S.BUS, Smart Port and F.Port feature to a rapid prototyping model used for code generation working with the MPLAB blocks from microchip (targeting dsPIC microcontrollers).">
<link rel=alternate hreflang=en-us href=https://lubin.kerhuel.eu/uxv/>
<meta name=theme-color content="hsl(195, 90%, 58%)">
<script src=/js/mathjax-config.js></script>
<link rel=stylesheet href=/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css media=print onload="this.media='all'">
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload="this.media='all'">
<script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script>
<link rel=stylesheet href=/css/wowchemy.6fad9cba4336546ee49efceb4578a04c.css>
<script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({'gtm.start':(new Date).getTime(),event:'gtm.js'});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!='dataLayer'?'&l='+a:'';c.async=!0,c.src='https://www.googletagmanager.com/gtm.js?id='+g+h,f.parentNode.insertBefore(c,f)})(window,document,'script','dataLayer','GTM-THRKWJJ')</script>
<script>(function(a,e,b,f,g,c,d){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},c=e.createElement(f),c.async=1,c.src="https://www.clarity.ms/tag/"+g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)})(window,document,"clarity","script",'4135mxjybv')</script>
<link rel=alternate href=/uxv/index.xml type=application/rss+xml title="Rapid Control Prototyping">
<link rel=manifest href=/manifest.webmanifest>
<link rel=icon type=image/png href=/media/icon_hua5ed3a3c5aab9d478a9217a3fd35ab73_87443_32x32_fill_lanczos_center_3.png>
<link rel=apple-touch-icon type=image/png href=/media/icon_hua5ed3a3c5aab9d478a9217a3fd35ab73_87443_180x180_fill_lanczos_center_3.png>
<link rel=canonical href=https://lubin.kerhuel.eu/uxv/>
<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@LubinKerhuel">
<meta property="twitter:creator" content="@LubinKerhuel">
<meta property="og:site_name" content="Rapid Control Prototyping">
<meta property="og:url" content="https://lubin.kerhuel.eu/uxv/">
<meta property="og:title" content="UxV toolbox | Rapid Control Prototyping">
<meta property="og:description" content="The UxV toolbox provides matlab script and Simulink blocks for autopilot. Script to decode, visualise MAVlink logs and configure a Simulink model feeding MAVlink signal for simulation. Block adds MAVLink, GPS, and FrSky protocol S.BUS, Smart Port and F.Port feature to a rapid prototyping model used for code generation working with the MPLAB blocks from microchip (targeting dsPIC microcontrollers)."><meta property="og:image" content="https://lubin.kerhuel.eu/media/icon_hua5ed3a3c5aab9d478a9217a3fd35ab73_87443_512x512_fill_lanczos_center_3.png">
<meta property="twitter:image" content="https://lubin.kerhuel.eu/media/icon_hua5ed3a3c5aab9d478a9217a3fd35ab73_87443_512x512_fill_lanczos_center_3.png"><meta property="og:locale" content="en-us">
<meta property="og:updated_time" content="2019-07-01T00:00:00+00:00">
<title>UxV toolbox | Rapid Control Prototyping</title>
</head>
<body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class="page-wrapper dark" data-wc-page-id=d57000740af4ed1de240f7a3ff0f5a25>
<script src=/js/wowchemy-init.min.b0e67c88a5da645111c4840aa68f1002.js></script>
<aside class=search-modal id=search>
<div class=container>
<section class=search-header>
<div class="row no-gutters justify-content-between mb-3">
<div class=col-6>
<h1>Search</h1>
</div>
<div class="col-6 col-search-close">
<a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a>
</div>
</div>
<div id=search-box>
<input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...>
</div>
</section>
<section class=section-search-results>
<div id=search-hits>
</div>
</section>
</div>
</aside>
<div class=page-header>
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main>
<div class=container-xl>
<div class="d-none d-lg-inline-flex">
<a class=navbar-brand href=/>Rapid Control Prototyping</a>
</div>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span>
</button>
<div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
<a class=navbar-brand href=/>Rapid Control Prototyping</a>
</div>
<div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content>
<ul class="navbar-nav d-md-inline-flex">
<li class=nav-item>
<a class=nav-link href=/#projects><i class="fas fa-car-battery pr-1" style=color:#34c4f4></i><span>Projects</span></a>
</li>
<li class=nav-item>
<a class=nav-link href=/#posts><i class="fas fa-book pr-1" style=color:#34c4f4></i><span>Posts</span></a>
</li>
<li class=nav-item>
<a class=nav-link href=/#about><i class="fas fa-question pr-1" style=color:#34c4f4></i><span>About</span></a>
</li>
</ul>
<ul class="navbar-nav ml-md-auto">
<li class=nav-item>
<a class=nav-link href=/uxv/><i class="fas fa-paper-plane pr-1" style=color:#34c4f4></i><span>UxV blockset</span></a>
</li>
<li class=nav-item>
<a class=nav-link href=https://www.mathworks.com/matlabcentral/fileexchange/71892 target=_blank rel=noopener><i class="fas fa-microchip pr-1" style=color:#34c4f4></i><span>MPLAB blockset</span></a>
</li>
</ul>
</div>
<ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
<li class=nav-item>
<a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a>
</li>
</ul>
</div>
</nav>
</div>
<div class=page-body>
<div class="universal-wrapper pt-3">
<h1>UxV toolbox</h1>
</div>
<div class=universal-wrapper>
<div class=article-style><h2 id=overview>Overview</h2>
<p>The UxV toolbox for Matlab/Simulink provides Matlab scripts and simulink blocks for UAVs to handle MAVLink protocol, GPS, RC receivers and telemetry protocols.</p>
<ul>
<li>Matlab script for post flight data analyses (MAVLink).</li>
<li>Simulink blocks for autopilote model based design (Rapid Control Prototyping using Simulink)</li>
</ul>
<p>This model-based design and analysis tools speed-up the back and forth between experimental tests and simulation.</p>
<h2 id=matlab-scripts-for-mavlink>Matlab scripts for MAVLink</h2>
<p>Three main scripts enable decoding MAVLink messages, creating simulink model for simulation based on logged data, and generating map trajectory trace from GPS messages.</p>
<table>
<thead>
<tr>
<th>Script</th>
<th>Input</th>
<th>Output</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td>(1) <em>mavlink2mat</em></td>
<td>Mavlink log</td>
<td>.mat</td>
<td>matlab analysis</td>
</tr>
<tr>
<td>(2) <em>mavlink2simulink</em></td>
<td>Mavlink log</td>
<td>.mat / .mdl (.slx)</td>
<td>simulation based on real data</td>
</tr>
<tr>
<td>(3) <em>mavlink2kml</em></td>
<td>Mavlink log</td>
<td>.kml</td>
<td>plot GPS trace(s) on a map</td>
</tr>
<tr>
<td><em>mavlink2gui</em></td>
<td>Mavlink log</td>
<td>GUI</td>
<td>graphical exploration of mavlink log</td>
</tr>
</tbody>
</table>
<p><em>mavlinkgui</em> script opens a Graphical User Interface to explore MAVLink data. It list MAVLink messages found in a log file and plot selected {message - value}. Plot script is customizable enabling user to go beyond a simple plot. The GUI provides access to the three scripts mentioned above.</p>
<h2 id=simulink-blocks>Simulink blocks</h2>
<p>10 added blocks add essentials UAV features to implement an autopilot on a dsPIC DSC. Theses blocks complete the MPLAB blocks for Simulink from Microchip providing peripheral blocks for code generation. Theses works on top of the MathWorks Embedded Coder. Added features:</p>
<ul>
<li>GPS
<ul>
<li><em>GPS Parser</em> to decode NMEA messages</li>
</ul>
</li>
<li>MATH
<ul>
<li><em>Quaternion to Cardan FxPt</em> to convert quaternion angle to Cardan angle in fixed point (similar to euler)</li>
</ul>
</li>
<li>MAVLink:
<ul>
<li><em>SEND</em> (send a message)</li>
<li><em>RECEIVE</em> (Receive a message)</li>
<li><em>MAVLink Data</em> (Way Points data)</li>
<li><em>MAVLink Parser</em> (decode input message and implement WayPoint<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> and Parameter<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> protocols)</li>
</ul>
</li>
<li><a href=block-receiver-telemetry>Receivers-Telemetry</a>
<ul>
<li><em>S.BUS</em> receive RC channels</li>
<li><em>Smart Port</em> send telemetry values</li>
<li><em>F.Port</em> receive RC channels + send telemetry</li>
<li><em>Sensor for Smart.Port or F.Port</em> set values to send over telemetry<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></li>
</ul>
</li>
</ul>
<p>Except the MATH block, theses blocks are typically connected to the dsPIC UART Rx/Tx block to send/receive the data flow from a GPS, a receiver, a radio link.</p>
<h2 id=installation>Installation</h2>
<p>Theses blocks are developped by Lubin Kerhuel and distributed for free with the <a href=https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink target=_blank rel=noopener>MPLAB device blocks for Simulink</a> from Microchip.</p>
<ol>
<li>Install the MPLAB Device Blocks for Microchip</li>
<li>type <em>pinInfo</em>, click on <em>go to Third Part Tools folder</em></li>
<li>Start script <em>UxV_Blockset_Installer.p</em> in the UxV_blockset folder.</li>
</ol>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p><em>Way Point protocol</em> allows setting and reading WayPoint from a MAVLink compatible ground station.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:2 role=doc-endnote>
<p><em>Parameter protocol</em> enable tuning from any MAVLink ground station the Simulink tunable parameters which are normally tuned with External Mode or from the Processor In the Loop simulation (PIL).&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:3 role=doc-endnote>
<p><em>Sensor for Smart.Port or F.Port</em> block is used with either the <em>Smart Port</em> of the <em>F.Port</em> block. Theses protocol allows sending telemetry packet back to the Remote Controller (RC) interface. It enables emulation of Frsky sensor (battery voltage and current, variometer, airspeed, GPS) adding features to your remote easily. They also enable emulation of BetaFlight telemetry. Used with LUA script, this add features like artificial horizon, air speed, vertical speed, distance from home and many other to your remote (tested with <a href=https://github.com/yaapu/FrskyTelemetryScript/wiki target=_blank rel=noopener>yapuu LUA scripts</a>.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
<div class="media stream-item">
<div class=media-body>
<div class="section-subheading article-title mb-0 mt-0">
<a href=/uxv/block-receiver-telemetry/>block receiver & telemetry: S.BUS, Smart Port, F.Port</a>
</div>
<a href=/uxv/block-receiver-telemetry/ class=summary-link>
<div class=article-style>
Simulink blocks to get data from a receiver and set data to be sent to the remote controller through the telemetry channel. S.BUS, Smart Port and F.Port block support respective protocols.
</div>
</a>
<div class="stream-meta article-metadata">
<div class=article-metadata>
<span class=article-date>
Last updated on
November 2019
</span>
</div>
</div>
</div>
<div class=ml-3>
</div>
</div>
<div class="media stream-item">
<div class=media-body>
<div class="section-subheading article-title mb-0 mt-0">
<a href=/uxv/block-sensor/>block Sensor</a>
</div>
<a href=/uxv/block-sensor/ class=summary-link>
<div class=article-style>
The Sensor block set sensor ID and data values to send to the remote through telemetry. Data are sent to the receiver either through the F.Port or through a Smart Port.
</div>
</a>
<div class="stream-meta article-metadata">
<div class=article-metadata>
<span class=article-date>
Last updated on
November 2019
</span>
</div>
</div>
</div>
<div class=ml-3>
</div>
</div>
</div>
</div>
<div class=page-footer>
</div>
<div id=modal class="modal fade" role=dialog>
<div class=modal-dialog>
<div class=modal-content>
<div class=modal-header>
<h5 class=modal-title>Cite</h5>
<button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span>
</button>
</div>
<div class=modal-body>
<pre><code class="tex hljs"></code></pre>
</div>
<div class=modal-footer>
<a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank>
<i class="fas fa-copy"></i> Copy
</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank>
<i class="fas fa-download"></i> Download
</a>
<div id=modal-error></div>
</div>
</div>
</div>
</div>
<script src=/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js></script>
<script src=https://cdn.jsdelivr.net/gh/desandro/imagesloaded@v4.1.4/imagesloaded.pkgd.min.js integrity="sha512-S5PZ9GxJZO16tT9r3WJp/Safn31eu8uWrzglMahDT4dsmgqWonRY9grk3j+3tfuPr9WJNsfooOR7Gi7HL5W2jw==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/metafizzy/isotope@v3.0.6/dist/isotope.pkgd.min.js integrity="sha512-Zq2BOxyhvnRFXu0+WE6ojpZLOU2jdnqbrM1hmVdGzyeCa1DgM3X5Q4A/Is9xA1IkbUeDd7755dNNI/PzSf2Pew==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script>
<script id=search-hit-fuse-template type=text/x-template>
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
<script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script>
<script src=/en/js/wowchemy.min.fd7bdb45cfd7de08bb320c49b7f5b62f.js></script>
</body>
</html>