<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.3.1"><meta name=author content="Lubin Kerhuel"><meta name=description content="Model based design for an RC plane autopilot"><link rel=alternate hreflang=en-us href=https://lubin.kerhuel.eu/project/autopilot-plane/><meta name=theme-color content="hsl(195, 90%, 58%)"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.6.0/css/all.css integrity=sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin=anonymous><link rel=stylesheet href="//fonts.googleapis.com/css?family=Istok+Web|Roboto:400,400italic,700|Roboto+Mono"><link rel=stylesheet href=/css/academic.min.c597133c6834e91d2027d804f60e5fbd.css><link rel=stylesheet href=/css/academic.dfef8698ccd0c0cbec1887b1b4db4f38.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-90899-5','auto');ga('require','eventTracker');ga('require','outboundLinkTracker');ga('require','urlChangeTracker');ga('send','pageview');</script><script async src=//www.google-analytics.com/analytics.js></script><script async src=https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin=anonymous></script><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png href=/img/icon.png><link rel=apple-touch-icon type=image/png href=/img/icon-192.png><link rel=canonical href=https://lubin.kerhuel.eu/project/autopilot-plane/><meta property=twitter:card content=summary_large_image><meta property=twitter:site content=@LubinKerhuel><meta property=twitter:creator content=@LubinKerhuel><meta property=og:site_name content="Rapid Control Prototyping (RCP)"><meta property=og:url content=https://lubin.kerhuel.eu/project/autopilot-plane/><meta property=og:title content="Auto-pilote for Plane based on Simulink | Rapid Control Prototyping (RCP)"><meta property=og:description content="Model based design for an RC plane autopilot"><meta property=og:image content=https://lubin.kerhuel.eu/project/autopilot-plane/featured.jpg><meta property=og:locale content=en-us><meta property=article:published_time content=2019-05-19T00:00:00&#43;02:00><meta property=article:modified_time content=2019-05-22T00:22:48&#43;02:00><title>Auto-pilote for Plane based on Simulink | Rapid Control Prototyping (RCP)</title></head><body id=top data-spy=scroll data-target=#TableOfContents data-offset=71 class=dark><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off role=textbox spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id=navbar-main><div class=container><a class=navbar-brand href=/>Rapid Control Prototyping (RCP)</a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#projects><span>Home</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Projects</span>
<span class=caret></span></a><ul class=dropdown-menu><li class="dropdown-item my-0 py-0 mx-0 px-0"><a href=/docs/inverted-pendulum/><span>Inverted Pendulum</span></a></li><li class="dropdown-item my-0 py-0 mx-0 px-0"><a href=/project/lab-dc-motor/><span>DC Motor</span></a></li></ul></li><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class="nav-link js-dark-toggle" href=#><i class="fas fa-moon" aria-hidden=true></i></a></li></ul></div></div></nav><article class="article article-project" itemscope itemtype=http://schema.org/Article><div class="article-header d-xl-none"><div class=featured-image style=background-image:url(/project/autopilot-plane/featured_hu7c2ad26a6f552c97c5893c09a7032617_546799_800x0_resize_q90_lanczos.jpg)></div><span class=article-header-caption>Firstar 1600 plane</span></div><div class="container-fluid split-header d-none d-xl-block"><div class=row><div class=col-6><div class=split-header-content><h1 itemprop=name>Auto-pilote for Plane based on Simulink</h1><meta content="2019-05-19 00:00:00 &#43;0200 CEST" itemprop=datePublished><meta content="2019-05-22 00:22:48 &#43;0200 CEST" itemprop=dateModified><div class=article-metadata><span class=article-date>Last updated on
<time>May 22, 2019</time></span></div><div class="btn-links mb-3"><a class="btn btn-outline-primary my-1 mr-1" href="https://www.youtube.com/playlist?list=PLaljXZFYAWTM5xUd5nM3107M2cDsQRFC0" target=_blank rel=noopener>Video Calm</a>
<a class="btn btn-outline-primary my-1 mr-1" href="https://www.youtube.com/playlist?list=PLaljXZFYAWTPAKykfQDyIEClrdDMl0NDy" target=_blank rel=noopener>Video Turbulent</a></div><div class=share-box aria-hidden=true><ul class=share><li><a class=twitter href="https://twitter.com/intent/tweet?text=Auto-pilote%20for%20Plane%20based%20on%20Simulink&amp;url=https%3a%2f%2flubin.kerhuel.eu%2fproject%2fautopilot-plane%2f" target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a class=facebook href="https://www.facebook.com/sharer.php?u=https%3a%2f%2flubin.kerhuel.eu%2fproject%2fautopilot-plane%2f" target=_blank rel=noopener><i class="fab fa-facebook-f"></i></a></li><li><a class=linkedin href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2flubin.kerhuel.eu%2fproject%2fautopilot-plane%2f&amp;title=Auto-pilote%20for%20Plane%20based%20on%20Simulink" target=_blank rel=noopener><i class="fab fa-linkedin-in"></i></a></li><li><a class=weibo href="http://service.weibo.com/share/share.php?url=https%3a%2f%2flubin.kerhuel.eu%2fproject%2fautopilot-plane%2f&amp;title=Auto-pilote%20for%20Plane%20based%20on%20Simulink" target=_blank rel=noopener><i class="fab fa-weibo"></i></a></li><li><a class=email href="mailto:?subject=Auto-pilote%20for%20Plane%20based%20on%20Simulink&amp;body=https%3a%2f%2flubin.kerhuel.eu%2fproject%2fautopilot-plane%2f"><i class="fas fa-envelope"></i></a></li></ul></div></div></div><div class=col-6><div class=split-header-image><img src=/project/autopilot-plane/featured_hu7c2ad26a6f552c97c5893c09a7032617_546799_680x500_fill_q90_lanczos_smart1.jpg itemprop=image alt>
<span class=article-header-caption>Firstar 1600 plane</span></div></div></div></div><div class="article-container d-xl-none"><h1 itemprop=name>Auto-pilote for Plane based on Simulink</h1><meta content="2019-05-19 00:00:00 &#43;0200 CEST" itemprop=datePublished><meta content="2019-05-22 00:22:48 &#43;0200 CEST" itemprop=dateModified><div class=article-metadata><span class=article-date>Last updated on
<time>May 22, 2019</time></span><div class=share-box aria-hidden=true><ul class=share><li><a class=twitter href="https://twitter.com/intent/tweet?text=&amp;url=" target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a class=facebook href="https://www.facebook.com/sharer.php?u=" target=_blank rel=noopener><i class="fab fa-facebook-f"></i></a></li><li><a class=linkedin href="https://www.linkedin.com/shareArticle?mini=true&amp;url=&amp;title=" target=_blank rel=noopener><i class="fab fa-linkedin-in"></i></a></li><li><a class=weibo href="http://service.weibo.com/share/share.php?url=&amp;title=" target=_blank rel=noopener><i class="fab fa-weibo"></i></a></li><li><a class=email href="mailto:?subject=&amp;body="><i class="fas fa-envelope"></i></a></li></ul></div></div><div class="btn-links mb-3"><a class="btn btn-outline-primary my-1 mr-1" href="https://www.youtube.com/playlist?list=PLaljXZFYAWTM5xUd5nM3107M2cDsQRFC0" target=_blank rel=noopener>Video Calm</a>
<a class="btn btn-outline-primary my-1 mr-1" href="https://www.youtube.com/playlist?list=PLaljXZFYAWTPAKykfQDyIEClrdDMl0NDy" target=_blank rel=noopener>Video Turbulent</a></div></div><div class=article-container><div class=article-style itemprop=articleBody><h2 id=an-autopilot-based-on-rapid-control-prototyping-technics>An autopilot based on rapid control prototyping technics</h2><h3 id=motivation>Motivation</h3><p>Elements to build and test an autopilot for a plane are easy to build from low cost elements:</p><p>10 DoF IMU sensor board: 5 $\$$, Pitot tube: 10$\$$, GPS board: 10$\$$, Microcontroller basic board: price depend on the board used (or make a custom one with a less than 5$\$$ mcu), Plane platform: from 60 to 120$\$$ including servo and motors. You also need a receiver and remote control.</p><p>It&rsquo;s a great platform for testing various control theory.</p><h3 id=why-a-new-auto-pilot>Why a new auto-pilot ?</h3><p>Off the shelf autopilot exists and are likely to works properly. Their parameters can be tuned (PID gains). But testing a different, your own controller on theses requires to understand the code underneath. Even well documented, it represents hundreds of code pages to read, understand before eventually starting any changes.
Added to this analysis work, the structure bench might not fit the requirements for your controller (sampling time, asynchronous event).</p><p>The objective for the present autopilot is to use a model based design approach: The autopilot is generated from a single simulink model.</p><p>The autopilot controller use standard math blocks and the system low level parts is taken care with the Microchip blockset to drive the microcontroller peripherals and the UxV blockset to easily add features like GPS parser, Remote Control S.BUS, F.Port and Smart Port protocol, Mavlink messaging including Way Point and Parameters protocols.
This rapid prototyping approach allows to &ldquo;get-in&rdquo; graphically. It simplify any simulation quick test either based on a simulated plane of based on values logged.</p><h3 id=hardware-list>Hardware list</h3><p>Various combination of material has been tested. Below is elements list providing good results.</p><ul><li>RC platform: Volantex Firstar 1600 with stocks motors and servos (Ranger 1600 is the next platform planed)</li><li>Remote Control: FrSky QX7 remote control</li><li>Receiver: FrSky XSR-M / XSR used with either the S.Bus and S.port protocol or with the F.Port protocol which combine function of both S.bus with S.port saving thus one UART peripheral of the microcontroller.</li><li>Microcontroller: AUAV V2 board with a dsPIC 33EP ; only using the microcontroller: board sensors are outdated, glitch issue with the magnetometers sensor and board is not practical to place near the CG thus too much vibration for sensors. This board is not sold anymore. A custom board with a similar dsPIC might replace it. The UDB5 mini can be found as replacement.</li><li>IMU sensor board: Gy-91 (10 DoF with 3 accelerometers, 3 rate gyro, 3 magnetometers and one barometer). Firmly attached near the CG of the plane reducing thus sensors vibrations. Microcontroller communicate with the Gy-91 through an I2C BUS.</li><li>Pitot tube:<ul><li>An inner tube and an outer tube on which four hole are done laterally.</li><li>Signal conditioning: the pitot tube pressure sensor (MPXV 7004 DP) is done with a MCHP ADC converter which integrate an analog amplifier. Converted pressure is sent to the microcontroller through the I2C bus.</li></ul></li><li>GPS board: based on a uBlox M8N chip which provide up to 10Hz refresh rate and provided best results compared to others chips in the low price range.</li><li>Data logger: openlager board to log on SD card. It allows logging continuous UART output flow with at a baud up to 2 470 000 (much higher than 115 200).</li><li>Radio link: 3DR Sik based Radio module for mavlink telemetry (plane attitude, position, Way Point and Parameters tuning) with qgroundcontrol open source base station on either windows PC or android phone.</li><li>action cam: RunCam2 to film the plane and its surface control from the top; getting a visual behavior of the autopilot in the action.</li></ul><h3 id=results-obtained-and-next-steps>Results obtained and next steps</h3><h4 id=results>Results</h4><p>Sliding mode based controller tested in both pitch and roll axis with two mode:</p><ul><li>Control plane angular rate control (angular speed set-point given through the remote control)</li><li>Control plane angle attitude (angle set point provided through the remote control)</li></ul><p>Average CPU load was 7 to 8% on a dsPIC 33EP running at 70 MIPS. It includes the IMU estimation algorithm, autopilot control loop and all low tasks (handle various protocols (I2C, NMEA for GPS, F.Port, Mavlink and log sensors data at 1Khz through an UART configured at 24700000)</p><p>Tested with strong wind. Showing fairly good robustness despite the low number of parameters tuned so far.</p><p>Pitot tube air-speed estimation validated using GPS speed measurement as reference.</p><p>Validated the wind speed and direction estimation based on a difference between the GPS and pitot tube speed measurement taking into account the plane orientation.</p><p>Validated automatic calibration of the magnetometers axis offset and gain. Once in the air, the magnetic perturbation near the floor are negligible. An algorithm automatically determine if the calibration can be refined using current data (using standard flight input data, no looping or specific roll required).</p><h4 id=next>next</h4><p>Reduce chattering on ailerons when sliding mode control is enabled.</p><p>Test in flight mavlink protocol parameters tuning.</p><p>Add automatic guidance of the plane, using Mavlink Way point sets.</p><h3 id=site-content>site content</h3><p>Time constraints does not allow writing a full description of the project as originally expected. Part of projects which I find interesting of inspiring will be shared.</p><p>Ideas to expand:</p><ul><li>IMU</li><li>Pitot tube</li><li>Wind estimate</li><li>UxV blocks including GPS, Remote Control and Mavlink blocks and functionalities</li></ul></div><div class=article-tags><a class="badge badge-light" href=/tags/simulink/>simulink</a>
<a class="badge badge-light" href=/tags/matlab/>matlab</a>
<a class="badge badge-light" href=/tags/rapid-prototyping/>rapid prototyping</a>
<a class="badge badge-light" href=/tags/model-based-design-mdb/>model based design (MDB)</a>
<a class="badge badge-light" href=/tags/dspic/>dsPIC</a>
<a class="badge badge-light" href=/tags/sliding-mode/>Sliding Mode</a>
<a class="badge badge-light" href=/tags/autopilot/>autopilot</a>
<a class="badge badge-light" href=/tags/uav/>UAV</a>
<a class="badge badge-light" href=/tags/mavlink/>mavlink</a>
<a class="badge badge-light" href=/tags/frsky/>FrSky</a>
<a class="badge badge-light" href=/tags/uxv-blockset/>UxV blockset</a>
<a class="badge badge-light" href=/tags/auav-v2-board/>AUAV V2 board</a></div><div class="media author-card" itemscope itemtype=http://schema.org/Person><img class="portrait mr-3" src=/authors/lubin/avatar_hub88d8bfcd9aca835933e1808b55368c2_25702_250x250_fill_q90_lanczos_center.jpg itemprop=image alt=Avatar><div class=media-body><h5 class=card-title itemprop=name><a href=/authors/lubin/>Lubin Kerhuel</a></h5><p class=card-text itemprop=description>Interrested in signal processing and control theory, 10 years of experience with rapid control prototyping tools.</p><ul class=network-icon aria-hidden=true><li><a itemprop=sameAs href=/#contact><i class="fas fa-envelope"></i></a></li><li><a itemprop=sameAs href=https://www.linkedin.com/in/kerhuel/ target=_blank rel=noopener><i class="fab fa-linkedin"></i></a></li><li><a itemprop=sameAs href="https://scholar.google.co.uk/citations?user=61SJU_sAAAAJ" target=_blank rel=noopener><i class="ai ai-google-scholar"></i></a></li></ul></div></div><h2>Posts</h2><div class="media stream-item" itemscope itemtype=http://schema.org/BlogPosting><div class=media-body><h3 class="article-title mb-0 mt-0" itemprop=name><a href=/post/matek-pdb-xpw/ itemprop=url>MATEKSYS PDB-XPW Dual BEC &amp; Current Module tweak to increase current measurement sensitivity</a></h3><div class=article-style itemprop=articleBody>Adapt the MATEKSYS PDB-XPW power module for quad rotor to fit electric RC plane with lower current requirements. Change current â€¦</div><div class="stream-meta article-metadata"><meta content="2019-05-18 00:00:00 &#43;0000 UTC" itemprop=datePublished><meta content="2019-05-22 00:22:48 &#43;0200 CEST" itemprop=dateModified><div class=article-metadata><div><span itemprop="author name" itemtype=http://schema.org/Person><a href=/authors/lubin/>Lubin Kerhuel</a></span></div><span class=article-date>Last updated on
<time>May 22, 2019</time></span>
<span class=middot-divider></span><span class=article-categories><i class="fas fa-folder"></i><a href=/categories/electronics/>Electronics</a></span></div></div></div><div class=ml-3><a href=/post/matek-pdb-xpw/><img src=/post/matek-pdb-xpw/featured_hu9085d2df5cdf2f6d5db72ef0537dd327_138446_150x0_resize_lanczos_2.png itemprop=image></a></div></div><div class="media stream-item" itemscope itemtype=http://schema.org/BlogPosting><div class=media-body><h3 class="article-title mb-0 mt-0" itemprop=name><a href=/post/runcam-remote-control-cable/ itemprop=url>Record start/Stop signal for RunCam2 action cam</a></h3><div class=article-style itemprop=articleBody>Signal to remotely start / stop / take a picture on a runCam2 and compatible action cam through the USB connector.</div><div class="stream-meta article-metadata"><meta content="2019-05-18 00:00:00 &#43;0000 UTC" itemprop=datePublished><meta content="2019-05-22 00:22:48 &#43;0200 CEST" itemprop=dateModified><div class=article-metadata><div><span itemprop="author name" itemtype=http://schema.org/Person><a href=/authors/lubin/>Lubin Kerhuel</a></span></div><span class=article-date>Last updated on
<time>May 22, 2019</time></span></div></div></div><div class=ml-3><a href=/post/runcam-remote-control-cable/><img src=/post/runcam-remote-control-cable/featured_hucbab4b8f01984d26d7e8e68305de12c0_78133_150x0_resize_lanczos_2.png itemprop=image></a></div></div></div></article><div class="article-container article-widget"><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=/project/inverted-pendulum/ rel=prev>Inverted Pendulum</a></div></div></div><div class=container><footer class=site-footer><p class=powered-by>&copy; 2019 Lubin Kerhuel &middot;
Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# id=back_to_top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&times;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div><script src=/js/mathjax-config.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin=anonymous></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin=anonymous async></script><script>const search_index_filename="/index.json";const i18n={'placeholder':"Search...",'results':"results found",'no_results':"No results found"};const content_type={'post':"Posts",'project':"Projects",'publication':"Publications",'talk':"Talks"};</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/academic.min.b7b7bc325c741d29d15c737d59b016d8.js></script></body></html>