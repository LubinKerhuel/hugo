<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rapid Control Prototyping (RCP)</title><link>https://lubin.kerhuel.eu/authors/lubin/</link><description>Recent content on Rapid Control Prototyping (RCP)</description><generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><copyright>&amp;copy; {year} Lubin Kerhuel</copyright><atom:link href="https://lubin.kerhuel.eu/authors/lubin/index.xml" rel="self" type="application/rss+xml"/><item><title>Miniature air-speed sensor for RC plane or UAVs.</title><link>https://lubin.kerhuel.eu/post/pitot-build/</link><pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/pitot-build/</guid><description>
&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;p&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;/p&gt;
&lt;h2 id=&#34;principle&#34;&gt;Principle&lt;/h2&gt;
&lt;p&gt;A Pitot-Darcy tube is an air speed sensor commonly used in aviation. It consists of a tube pointing in the forward direction. When the sensor moves forward a stop pressure is created at its top. A differential pressure is measured between the top of the tube and the ambient pressure. One variant named from its inventor Prandtl tube has static air ports directly on the side of the tube.&lt;/p&gt;
&lt;p&gt;The pressure measured is linear to the square of the air speed : $P_t = P_s + \frac{1}{2}\rho v^2$ where $ P_t $ and $P_s$ are the pressure in Pa, $\rho$ is the fluid density constant typically in $[1.14 \ 1.34]$ depending on temperature &amp;amp; altitude, and $v$ the speed in $m.s^{-1}$. The differential pressure measured is $P_{diff} = P_t - P_s = \frac{1}{2}\rho v^2$&lt;/p&gt;
&lt;h2 id=&#34;prandtl-tube&#34;&gt;Prandtl tube&lt;/h2&gt;
&lt;p&gt;Prandtl tube is made of an inner tube placed within an outer tube. At their top, both tubes are centered. Space between the two tubes is hermetically filled in with an epoxy adhesive (Araldite or equivalent) on few mm near the top. The side of the outer tube is drilled to sense the static pressure. At the bottom, the inner tube which is longer act as a connector for the dynamic pressure sensor and a tiny tube is added next to create another connector to the static pressure which lies in the empty space between the two tube.&lt;/p&gt;
&lt;p&gt;The static pressure holes should be placed at a minimum distance from the top due to airflow perturbations. A distance 4 times the diameter of the outer tube is retains here.&lt;/p&gt;
&lt;p&gt;First test was done using brass tube. Inner tube is 1mm inside, 2mm outside. Outer tube was 3mm inside, 4mm outside. A lighter pitot tube was tested using one inner brass tube (1mm/2mm) with a carbon outer tube (3mm/5mm).&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-brasstubes.jpg&#34; alt=&#34;Tube alfer from Leroy Merlin. Inner tube is 2mm/1mm. Outer tube is 4mm/3mm (d=4mm). Outer tube length is m=86mm (21d). Four 1mm width holes are at l=16mm (4d) from the top.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-brasstubes.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Brass inner and outer tubes composing the pitot tube.&lt;/h4&gt;
&lt;p&gt;Tube alfer from Leroy Merlin. Inner tube is 2mm/1mm. Outer tube is 4mm/3mm (d=4mm). Outer tube length is m=86mm (21d). Four 1mm width holes are at l=16mm (4d) from the top.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;References:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://naca.central.cranfield.ac.uk/reports/1957/naca-report-1303.pdf&#34;&gt;report&lt;/a&gt; by W.Gracey on the impact of the various shape on the measurement.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.planete-sciences.org/espace/IMG/pdf/tube_de_pitot.pdf&#34;&gt;report (french)&lt;/a&gt; from ANSTJ with general information on pitot sensor.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://voiletech.free.fr/skyassistant/pitot.htm&#34;&gt;website (French)&lt;/a&gt; from Rémi Bourgin with experimental pitot tube for RC plane&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- Tube laiton macif (alfer) au Leroy Merlin;
Tube intèrieur: 2mm, trou 1mm
Tube extèrieur: 4mm, trou 3mm
Longueur total:
d = 4mm
l = 4d =&gt; 16mm
m = 11d =&gt;44mm
Tube altigator:
d = 4mm
l = 18mm
m = 72mm
--&gt;
&lt;h2 id=&#34;electronics&#34;&gt;Electronics&lt;/h2&gt;
&lt;h3 id=&#34;sensitivity-requirements-and-pressure-sensor&#34;&gt;Sensitivity requirements and Pressure sensor&lt;/h3&gt;
&lt;p&gt;The differential pressure measured vary with the square of the speed. RC plane speed can be quite low. Challenge is to be sensitive enough to obtain good measurement even in the low speed range of few meters per seconds.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; from NXP is a sensitive differential pressure sensor. Its differential measurement range goes from 0 to 3.92 kPa. The analog output is ratio-metric and swing from 0.6V to 3V ($\Delta V =2.4V$). For reference, 1 kPa is approximately the pressure of 10cm of water.&lt;/p&gt;
&lt;p&gt;We are interested in speed range varying from $0$ to $25 m.s^{-1}$ ($90km/h$) which correspond to a maximum differential pressure of 3.75 cm of water, or 0.375 kPa. The MP3V5004DP sensor is used in 10% of its nominal range.&lt;/p&gt;
&lt;p&gt;Table below provide theoretical differential pressure expected for various speed using $P_{diff} = \frac{1}{2}\rho v^2$ with $\rho=1.2$.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;v (m/s)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;v (Km/h)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;$P_{diff}$ (Pa)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;~ $H_2O$ (cm)&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; &amp;amp; &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; (0.2041Pa / LSB&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LSB&#34;&gt;&lt;a href=&#34;#fn:LSB&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.006&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;7.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.024&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;12&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;14.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.096&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;47&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;7&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;25.2&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;29.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.294&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;144&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;36&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;60&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;0.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;294&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;15&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;54&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;135&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1.3&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;661&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;20&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;72&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;240&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1176&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;25&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;90&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;375&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;3.75&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1837&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;30&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;108&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;540&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5.4&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;2646&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;40&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;144&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;960&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;9.6&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;em&gt;4704&lt;/em&gt; (4095 sat)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;signal-conditioning-and-conversion&#34;&gt;Signal conditioning and conversion&lt;/h3&gt;
&lt;p&gt;The pressure sensor is placed close (~10cm) to the pitot tube on the wing. The analog to digital conversion is also done on site to avoid noise pollution of analog signal. The &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; from Microchip is a high resolution sigma-delta converter with four differential inputs and a programmable gain factor from 1 to 8. It has a digital I2C interface to connect to the dsPIC.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; output analog signal is connected to the &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; Sigma-Delta ADC through a first order RC low pass filter with a cut off frequency at $28Hz$ ($R=5.6 kOhm$,$C=1\mu F$). The 2nd differential input is connected on a voltage divisor with 1.2k and 560 ohms to the 3.3V ref and GND. $10\mu F$ decoupling capacitor are used on power supply. The I2C bus wires are pulled up with 10kOhm and are connected to a 10pf capacitor protecting from glitches.&lt;/p&gt;
&lt;p&gt;The ADC Sigma-Delta is configured for&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;12 bits&lt;/li&gt;
&lt;li&gt;x8 Gain&lt;/li&gt;
&lt;li&gt;240 Samples Per Seconds (SPS)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The overall resolution is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;(1) &lt;a href=&#34;https://www.nxp.com/part/MP3V5004DP&#34;&gt;MP3V5004dp&lt;/a&gt; Analog output sensitivity is 1633 Pa/V&lt;/li&gt;
&lt;li&gt;(2) &lt;a href=&#34;https://www.microchip.com/wwwproducts/en/MCP3428&#34;&gt;MCP3428&lt;/a&gt; 12 bits with a gain of 8 : 0.125mV/LSB&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LSB&#34;&gt;&lt;a href=&#34;#fn:LSB&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;with (1) and (2), we obtain $1633 * 0.125e^{-3} $ = &lt;strong&gt;&lt;em&gt;0.2041 Pa / LSB&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LSB&#34;&gt;&lt;a href=&#34;#fn:LSB&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg&#34; alt=&#34;Differential pressure sensor (MP3V5004dp) with Analog to Digital converter integrating a differential amplifier (MCP3428). The MCP3428 communicate with the microcontroller through an I2C BUS. A 3.3V voltage regulator adapt and filter out the 5V input voltage.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-build-mp3v5004dp-mcp3428.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Pressure sensor and electronics mounted on a DIP adapter board.&lt;/h4&gt;
&lt;p&gt;Differential pressure sensor (MP3V5004dp) with Analog to Digital converter integrating a differential amplifier (MCP3428). The MCP3428 communicate with the microcontroller through an I2C BUS. A 3.3V voltage regulator adapt and filter out the 5V input voltage.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h3 id=&#34;sensor-static-tests&#34;&gt;Sensor static tests&lt;/h3&gt;
&lt;p&gt;A 90 minutes lasting measurement is performed indoor without movements. Sensor output were logged at 100Hz. The figure below shows a slow drift. The sensor standard deviation measured on the overall measurement is 0.54 Pa (including the drift).&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-static-characteristic.png&#34; alt=&#34;90 minutes lasting static measurement indoor shows a slow drift and a standard deviation of 0.54 Pa. Resolution is 0.2041 Pa / LSB&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-static-characteristic.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Differential Sensor static characteristics&lt;/h4&gt;
&lt;p&gt;90 minutes lasting static measurement indoor shows a slow drift and a standard deviation of 0.54 Pa. Resolution is 0.2041 Pa / LSB&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;The sensor is sensitive to its own orientation. Moving the sensor up-side down create an offset of (100 LSB&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:LSB&#34;&gt;&lt;a href=&#34;#fn:LSB&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;; to be checked).&lt;/p&gt;
&lt;h2 id=&#34;flight-setup&#34;&gt;Flight setup&lt;/h2&gt;
&lt;p&gt;The sensor is mounted on the wing of a FirStar 1600 RC plane.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:80%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg&#34; alt=&#34;Platform used for testing with pitot sensor.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/firstar1600-qx7.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;FirStar 1600 from Volantex RC plane.&lt;/h4&gt;
&lt;p&gt;Platform used for testing with pitot sensor.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;A 2mm flexible tube, originally for protecting fish lines, connect the sensor to the pitot tube.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:50%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg&#34; alt=&#34;Fishing Tube used to connect pressure MP3V5004dp sensor to pitot tube.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-tubesoupledecathlon.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Flashmer – flexible Tube 2mm. Image from Decathlon (france)&lt;/h4&gt;
&lt;p&gt;Fishing Tube used to connect pressure MP3V5004dp sensor to pitot tube.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;One magnet is glued on the pitot tube. The pitot tube is attached to the plane through a 2nd magnet integrated into the wing. This flexible solution allows the tube to stay in place during flight, eject in case of hard landing reducing damages and is practical for storage and transportation.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg&#34; /&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-brass-mp3v5004dp-mcp3428.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Brass pitot tube with its electronic board mounted on the bottom of the right Firstar 1600 wing.&lt;/h4&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:60%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-carbon2.jpg&#34; alt=&#34;Outer tube is a 5mm carbon tube. Inner tube is a brass 2mm/1mm tube.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-wing-carbon2.jpg&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;Carbon-Brass pitot tube attached to the wing with a magnet.&lt;/h4&gt;
&lt;p&gt;Outer tube is a 5mm carbon tube. Inner tube is a brass 2mm/1mm tube.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&#34;results&#34;&gt;Results&lt;/h2&gt;
&lt;p&gt;The MCP3428 samples $P_{diff}$ at 250Hz during flights. $V_{pitot}=\sqrt{\frac{2}{\rho}*P_{diff}}$ with $\rho = 1.2$.&lt;/p&gt;
&lt;p&gt;Matlab script converting 250Hz raw MCP3428 to Pressure (Pa) and Speed (m/s):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-matlab&#34;&gt;% Pitot Calibration. P_pitot is a vector with raw MCP3428 output read from I2C bus.
P_pitot_cal = 0.2041* (double(P_pitot) + 1800); % to Pa unit
% Compute Speed (m/s) from diff pressure (in Pa).
V_pitot = sqrt(max(0,(2/1.2) * P_pitot_cal));
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;gps-vs-air-speed&#34;&gt;Comparison with GPS ground speed&lt;/h3&gt;
&lt;p&gt;In calm condition, the Ground Speed $V_{GPS}$ and Air Speed $V_{pitot}$ are equal.&lt;/p&gt;
&lt;p&gt;In windy condition, wind average direction and strength are estimated combining $V_{GPS}$, $V_{pitot}$ and the plane yaw $\Theta_{heading}$ direction (using GPS COG&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:COG&#34;&gt;&lt;a href=&#34;#fn:COG&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;). This &lt;a href=&#34;#wind-estimation&#34;&gt;wind estimation&lt;/a&gt; is described below.&lt;/p&gt;
&lt;p&gt;The airplane ground speed (GPS) is estimated with the difference of the air speed (pitot) with the projected wind to the aircraft forward direction:&lt;/p&gt;
&lt;p&gt;$V_{GPS} \approx V_{pitot} - V_{wind}*cos(\Theta_{heading} + \Theta_{wind}) $&lt;/p&gt;
&lt;p&gt;The figure below presents the air speed in dashed blue. The reconstructed ground speed (thin black) matches accurately with the GPS velocity (large grey) which prove the correctness of the air-speed measurement as well as the wind strength and direction. The onshore wind is laminar with limited turbulences. The air-speed measurement presents a high sensitivity even at low speed.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-gps-wind-calibration.png&#34; alt=&#34;Data log of the first 200s of the Firstar 1600 RC plane flight. On the black curve, the pitot is averaged and undersampled by group of 5 samples reducing its sampling rate from 250Hz to 50Hz. GPS (grey curve) and Pitot minus Wind (black) matches.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-gps-wind-calibration.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;GPS Speed over ground (large grey). Pitot air-speed (dashed blue) with parameter $\rho=1.2$. Reconstructed up-front wind (green). Pitot air-speed minus wind estimated (large green). up-front wind is estimated from the GPS COG angle ($\approx \theta_{heading}$), and the estimated wind strength ($V_{wind}= 2.5 m/s$) and direction ($\theta_{wind} = 101°$).&lt;/h4&gt;
&lt;p&gt;Data log of the first 200s of the Firstar 1600 RC plane flight. On the black curve, the pitot is averaged and undersampled by group of 5 samples reducing its sampling rate from 250Hz to 50Hz. GPS (grey curve) and Pitot minus Wind (black) matches.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;Remaining error might be due to wind gust and GPS limited accuracy particularly at estimating vertical speed variations (During flight, the plane speed was change through climb/dive to log pitot tube reactions on a wide air-speed range).&lt;/p&gt;
&lt;h3 id=&#34;wind-estimation&#34;&gt;Wind estimation&lt;/h3&gt;
&lt;p&gt;Wind model considered is constant and characterized by&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;its constant direction $\Theta_{wind}$&lt;/li&gt;
&lt;li&gt;its constant strength $V_{wind}$&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;wind-v-pitot-v-gps&#34;&gt;Wind =&amp;gt; $V_{pitot} - V_{gps}$&lt;/h4&gt;
&lt;p&gt;The curve below shows the difference between the Ground speed (GPS) with the air speed (pitot) in function of the plane flight direction. This error (blue dashed points) fit with a sine wave. This sine wave is the speed offset added for each plane direction in $[0 \ 2\pi]$ by a wind with a constant strength and direction. Sine wave amplitude and phase is the wind strength and direction.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-speed-error-wind-estimation.png&#34; alt=&#34;Blue dots are speed difference between GPS and pitot. The continuous green curve is the wind sine wave projection on the $\Theta_{heading}$ plane direction. Sine phase is wind direction ($(\pi-1.37*\frac{180}{\pi})=101°$, from East to West) and sine amplitude is wind strength (2.56m/s). Pitot values are averaged and under-sample by a factor 5.&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/pitot-darcy-prandtl-speed-error-wind-estimation.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;&lt;h4&gt;GPS ground speed and pitot air speed difference in function of the plane direction during the 450s flight of a Firstar 1600.&lt;/h4&gt;
&lt;p&gt;Blue dots are speed difference between GPS and pitot. The continuous green curve is the wind sine wave projection on the $\Theta_{heading}$ plane direction. Sine phase is wind direction ($(\pi-1.37*\frac{180}{\pi})=101°$, from East to West) and sine amplitude is wind strength (2.56m/s). Pitot values are averaged and under-sample by a factor 5.&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;This wind estimation is used to compensate the air-speed when comparing the GPS ground speed $V_{gps}$ with the pitot air-speed $V_{pitot}$ &lt;a href=&#34;https://lubin.kerhuel.eu/post/pitot-build/#gps-vs-air-speed&#34;&gt;above&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&#34;script&#34;&gt;Script&lt;/h4&gt;
&lt;p&gt;Matlab script to estimate wind off-line:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-matlab&#34;&gt;% V_gps and V_pitot are two vector with all data measured.
% V_pitot was under-sampled (averaging) by a factor 5 to fit the 50Hz log from the GPS.
% GPS chip update frequency is 10Hz, but it is logged at 50Hz.
V_err = V_pitot - V_gps; % Ground and Air speed difference (i.e. wind)
M = [cos(COG); sin(COG) ]&#39;; % COG is the direction (Theta in rad) vector data measured from the GPS
y = V_err&#39;;
x = M\y; % Solve wind strength and direction using linear algebra (MMSE)
Theta_Wind = -atan2(x(2),x(1)); % Wind (go to) direction. Azimuth direction is opposite to trigo
V_Wind = sqrt(sum(x(1:2).^2)); % Wind strength (m/s)
plot(COG,V_err&#39;,&#39;.&#39;); hold on; % plot Error blue dots
plot([0:.01:(2*pi)],V_Wind*(cos([0:.01:(2*pi)]+ Theta_Wind)),&#39;-k&#39;,&#39;linewidth&#39;,3); % plot wind
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;discussion&#34;&gt;Discussion&lt;/h4&gt;
&lt;p&gt;Using the GPS COG&lt;sup class=&#34;footnote-ref&#34; id=&#34;fnref:COG&#34;&gt;&lt;a href=&#34;#fn:COG&#34;&gt;2&lt;/a&gt;&lt;/sup&gt; field is not exactly the plane yaw direction $\Theta_{heading}$ but the plane flight direction.
Thus the COG is a biased plane yaw $\Theta_{heading}$ direction. It would be best to use plane orientation from the IMU sensor. It is not done here to reduce the number of sensors for this demonstration. The COG bias is small enough if we assume the wind speed to be small compared to the airplane air speed. It might be possible with a more sophisticated script to compensate this bias.&lt;/p&gt;
&lt;h4 id=&#34;other-flight-inputs&#34;&gt;Other flight inputs&lt;/h4&gt;
&lt;p&gt;Plane was equipped with two GPS:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;one uBlox M8N GPS and&lt;/li&gt;
&lt;li&gt;one MTK3339.
&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The uBlox trace presented on the map below is better than the MTK trace. The uBlox chip was used exclusively for the curves above. The MTK trace can be shown on the &lt;a href=&#34;https://www.google.com/maps/d/u/0/embed?mid=1-K7dsmfbMCDL3IQK1z3IEtSduB2OWXr9&#34;&gt;map&lt;/a&gt; (top left icon). The KML file can be opened with Google Earth which provide a 3D view of the trace showing the height of the plane.&lt;/p&gt;
&lt;iframe src=&#34;https://www.google.com/maps/d/u/0/embed?mid=1-K7dsmfbMCDL3IQK1z3IEtSduB2OWXr9&#34; style=&#34;width: 100% ; height: 480px&#34;&gt;&lt;/iframe&gt;
&lt;!--
C:\M91449\MCHP_Blockset\Projects\2017_10_Autopilote\2018_04_12_LogChampdeTir_PitotNum_magOk_LowWind --&gt;
&lt;div class=&#34;footnotes&#34;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:LSB&#34;&gt;Least Significant Bit (or ULP: Unit in the Last Place)
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:LSB&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li id=&#34;fn:COG&#34;&gt;Course Over Ground
&lt;a class=&#34;footnote-return&#34; href=&#34;#fnref:COG&#34;&gt;&lt;sup&gt;^&lt;/sup&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description></item><item><title>MATEKSYS PDB-XPW Dual BEC &amp; Current Module tweak to increase current measurement sensitivity</title><link>https://lubin.kerhuel.eu/post/matek-pdb-xpw/</link><pubDate>Sat, 18 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/matek-pdb-xpw/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;p&gt;The board &lt;a href=&#34;http://www.mateksys.com/?portfolio=pdb-xpw&#34;&gt;PDB-XPW&lt;/a&gt; from MATEK System is a voltage regulator with an current measurement adapted for quad copters current with a max current measurement of 140 Amps. For an RC plane project, the current measurement might be reduced to increase current measurement resolution.&lt;/p&gt;
&lt;p&gt;The chip &amp;ldquo;INA1x9 High-Side Measurement Current Shunt Monitor&amp;rdquo; from Texas Instrument condition and amplify the shunt resistor voltage drop providing an analog output proportional to the current.&lt;/p&gt;
&lt;p&gt;On the PDB-XPW board, the INA1x9 chip is the black 5 pins component tagged E39 below the 0.05 Ohms shunt resistor, itself just below to the Power supply input connector.&lt;/p&gt;
&lt;p&gt;The amplification gain is set with the 47 kOhm resistor next to the INA1x9 component. This original value of 47 kOhm correspond to a gain of 47.
The gain is the value in kOhm as stated by the chip documentation:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Resistor&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Gain&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;1 kOhm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;5 Kohm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;10 Kohm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;50 Kohm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;100 Kohm&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The 47 kOhm resistor is replaced with a 270 kOhm resistor providing a gain of 270 instead of 47.
The original current measurement range is reduced from 140 (A) to 20 (A) (140 * &lt;sup&gt;47&lt;/sup&gt;&amp;frasl;&lt;sub&gt;270&lt;/sub&gt; = 20).&lt;/p&gt;
&lt;p&gt;The current measurement output is an analog signal swinging from 0 to 3.3V coding linearly for current in [0 - 20] Amps range. This lower current range fit with the RC plane platform like Bixler 2, Firstar 1600 or Ranger 1600.&lt;/p&gt;</description></item><item><title>Start/Stop signal for RunCam2 action cam</title><link>https://lubin.kerhuel.eu/post/runcam-remote-control-cable/</link><pubDate>Sat, 18 May 2019 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/post/runcam-remote-control-cable/</guid><description>&lt;!-- Enable Photo Swipe + gallery features --&gt;
&lt;p&gt;Cable exist to connect a RunCam2 action cam to an RC receiver for remotely start and stop a record from the receiver PWM output (20ms period, 1ms to 2ms duty cycle).
The cable has logic to decode the RC PWM signal and generate the signal pulse scheme to start and stop the RunCam2 record.&lt;/p&gt;
&lt;p&gt;Controlling the camera can be done with a microcontroller by generating the required pulse scheme described below.&lt;/p&gt;
&lt;p&gt;The micro USB cable pinout (on the male part) is&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pin 1 : GND&lt;/li&gt;
&lt;li&gt;Pin 3 : TTL signal (5V)&lt;/li&gt;
&lt;li&gt;Pin 5 : +5V (higher voltage possible for the RunCam2 connector)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When the Camera USB port is set for &amp;ldquo;Remote Control&amp;rdquo; and not for &amp;ldquo;mass storage&amp;rdquo; with the configuration application, it is possible to switch back and forth the camera from video mode to photo mode, and to start/stop recording, or take a picture.&lt;/p&gt;
&lt;p&gt;The pulse scheme is the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;One pulse switch the camera from video recording mode to Photo mode.&lt;/li&gt;
&lt;li&gt;Two pulses separated with 85ms start or stop a video record (or take a picture in photo mode).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pulse level is 5V but it works with 3.3V. Line is low state when idle. Pulses are 85ms in high state duration separated by 85ms on multiple pulse.&lt;/p&gt;
&lt;p&gt;Tested with a runCam2 powered from a 3S LiPo battery (10 to 14V), no battery in the camera and pulse generated with a 3.3V dsPIC pin configured as digital output.&lt;/p&gt;
&lt;p&gt;The figure below is the Simulink diagram with the logic used to generate the appropriate pulse on a dsPIC. Code is generated through the Simulink Coder and the &lt;a href=&#34;https://www.microchip.com/DevelopmentTools/ProductDetails/PartNO/SW007023&#34;&gt;MPLAB block&lt;/a&gt; from Microchip.&lt;/p&gt;
&lt;div class=&#34;box&#34; style=&#34;max-width:100%&#34;&gt;
&lt;figure itemprop=&#34;associatedMedia&#34; itemscope itemtype=&#34;http://schema.org/ImageObject&#34;&gt;
&lt;div class=&#34;img&#34;&gt;
&lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://lubin.kerhuel.eu/img/runcam2-startstop-simulink-logic.png&#34; alt=&#34;Simulink logic to control a runCam2 action Cam. The subsystem time step resolution is 1ms. The integrator is reset on each state change of the subsystem input, which trig the generation of two 85ms pulse pattern. Integrator reset is locked while pulses are being generated. Logic at the output of the integrator generate the pulses. The generated code was tested on a dsPIC target&#34;/&gt;
&lt;/div&gt;
&lt;a href=&#34;https://lubin.kerhuel.eu/img/runcam2-startstop-simulink-logic.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
&lt;figcaption&gt;
&lt;p&gt;Simulink logic to control a runCam2 action Cam. The subsystem time step resolution is 1ms. The integrator is reset on each state change of the subsystem input, which trig the generation of two 85ms pulse pattern. Integrator reset is locked while pulses are being generated. Logic at the output of the integrator generate the pulses. The generated code was tested on a dsPIC target&lt;/p&gt;
&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;</description></item><item><title>Real Time Control for a DC Motor</title><link>https://lubin.kerhuel.eu/project/lab-dc-motor/</link><pubDate>Sat, 01 Dec 2018 00:00:00 +0100</pubDate><guid>https://lubin.kerhuel.eu/project/lab-dc-motor/</guid><description>&lt;p&gt;Control a 24V DC motor using the MCLV-V2 board with a dsPIC 33EP256MC506.
This hands-on is for 5th year students at INSA-Lyon.&lt;/p&gt;
&lt;p&gt;The hands-on Lab subject available at: &lt;a href=&#34;https://rtdc.ctrl-elec.fr/&#34;&gt;https://rtdc.ctrl-elec.fr/&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Slides presents the adaptation required to go from a Simulink model for Simulation (or DSPACE) to a Simulink model targeting a microcontrollers. Two topics are presented:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Real-time scheduler / CPU load analysis&lt;/li&gt;
&lt;li&gt;Fixed-point datatypes&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title/><link>https://lubin.kerhuel.eu/authors/lubin/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://lubin.kerhuel.eu/authors/lubin/</guid><description>&lt;p&gt;Control projects during my academic study ended-up with simplest PID algorithm tuned through successive trials.
Code implementation for embedded systems requires an important effort. Time left for modeling, identification and simulation is often null.&lt;/p&gt;
&lt;p&gt;I started in 2005 developing a blockset for Matlab/Simulink targeting dsPIC 33F microcontrollers to overcome such constraint.
Without a budget for dSPACE, SpeedGoat or another NI alternative, rapid prototyping became possible on any dsPIC based board.&lt;/p&gt;
&lt;p&gt;$$
\text{One push button}
\left\{ \begin{array}{l}
\text{- C code generation,} \\&lt;br /&gt;
\text{- Compilation,} \\&lt;br /&gt;
\text{- Upload &amp;amp; run on the target.} \\&lt;br /&gt;
\end{array} \right.
$$&lt;/p&gt;
&lt;p&gt;This Model Based Design (MBD) approach enabled efficient research on signal processing validated with real robot for my &lt;a href=&#34;http://www.kerhuel.eu/publi/Kerhuel_2009_PhD.pdf&#34;&gt;PhD thesis&lt;/a&gt; on bio-robotics from 2006 to 2009.
It reduces the time from the simulation to our &lt;a href=&#34;https://www.researchgate.net/figure/a-OSCAR-II-like-its-predecessor-OSCAR-I-is-a-tethered-aerial-robot-that-orients-its_fig11_261957721&#34;&gt;autonomous robot&lt;/a&gt; and replaced somehow our dSPACE platform which was not embedded anyway.&lt;/p&gt;
&lt;p&gt;I used the same Rapid Control Prototyping (RCP) to develop data fusion algorithm on motion analysis for wearable sports article at &lt;a href=&#34;https://www.ideas-laboratory.com/projects/movea/&#34;&gt;MOVEA&lt;/a&gt; in 2010-2011.&lt;/p&gt;
&lt;p&gt;I joined &lt;a href=&#34;https://www.microchip.com/&#34;&gt;Microchip Technology&lt;/a&gt; where I am pursuing the development of the &lt;a href=&#34;https://www.microchip.com/simulinkblocks/&#34;&gt;MPLAB blockset&lt;/a&gt; to target dsPIC and PIC32 microcontrollers.&lt;/p&gt;
&lt;p&gt;For company, scientists, and students, &lt;em&gt;rapid prototyping enables focusing on new ideas&lt;/em&gt; rather than getting into the details of embedded programming.
Shortening the loopback $\lbrace Simulation \Leftrightarrow Hardware \rbrace$ allows improving algorithms, obtaining better results, and reducing the time to market.&lt;/p&gt;
&lt;p&gt;I am not academic. I have limited opportunity for traditional publication. I share custom projects as they come using the most practical format for me to maintain.
Most projects uses the free &lt;a href=&#34;https://www.microchip.com/simulinkblocks/&#34;&gt;Microchip blockset&lt;/a&gt; targeting dsPIC, PIC32 and few others microcontrollers. Old project are available on my &lt;a href=&#34;https://www.kerhuel.eu/wiki/&#34;&gt;old website&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;None are reference design. None are endorsed by Microchip Technology.&lt;/p&gt;</description></item></channel></rss>