<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.3.1"><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png href=/img/icon.png><link rel=apple-touch-icon type=image/png href=/img/icon-192.png><link rel=canonical href=https://lubin.kerhuel.eu/slides/slides_dcmotor_insa/><title>Prototypage Rapide avec Simulink sur dsPIC | Rapid Control Prototyping</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/css/reveal.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/css/theme/black.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css crossorigin=anonymous><link rel=stylesheet href=/css/reveal_custom.min.css><script>var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href=window.location.search.match(/print-pdf/gi)?'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/css/print/pdf.css':'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/css/print/paper.css';document.getElementsByTagName('head')[0].appendChild(link);</script></head><body><div class=reveal><div class=slides><section><h1 id=prototypage-rapide>Prototypage rapide</h1><h2 id=avec-simulink-sur-dspic>avec Simulink sur dsPIC</h2><p><a href=https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink>MPLAB device blocks for Simulink</a></p><p><a href=/>L.Kerhuel</a> &amp; <a href=http://www.ctrl-elec.fr/>R.Delpoux</a></p></section><section><h2 id=pendule-inverse-docs-inverted-pendulum><a href=/docs/inverted-pendulum/>Pendule inverse</a></h2><p><img src=./Inverted_Pendulum_ControlLoopCloseUp.png alt=./Inverted_Pendulum_ControlLoopCloseUp.png></p></section><section><p class=stretch><img data-src=./Model_Hardware_Test_withSampleTime.png></p></section><section><p><img src=./Picooz_IdentificatoinBlockPresentation.png alt=./Picooz_IdentificatoinBlockPresentation.png></p><p><a href=C:/M91449/MCHP_Blockset/Developpements/2013_08_19_Masters2013/Fig/Video_Logs_Shirp.avi>Video</a></p></section><section><p><img src=./Picooz_Identificatoin_eq_01.png alt=./Picooz_Identificatoin_eq_01.png></p></section><section><p><img src=./Picooz_Identificatoin_eq_02.png alt=./Picooz_Identificatoin_eq_02.png></p></section><section><p><img src=./Picooz_SuperTwistingController.png alt=./Picooz_SuperTwistingController.png></p></section><section data-noprocess data-shortcode-slide data-background-color=#FFFFFF><section data-background-image=./Picooz_SetpLarge_ClosedLoop_SimuVsReal.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><h2 id=plan>Plan:</h2><p>Modèle de simulation &amp; génération de code</p><ul><li>Différences Temporel</li><li>optimisation et type de données</li><li>blocks et fonctionnalités Simulink</li></ul><aside class=notes>dSPACE</aside></section><section><h2 id=aspect-temporel>Aspect Temporel:</h2><h3 id=simulation>Simulation</h3><p>Modélisation en temps continue, transformé de Laplace dans le domaine p (ou s)</p><ul><li>Solver résout les équations différentielles</li><li>Pas de contrainte temps réelle</li><li>Résultat dépend du solveur ; pas de calcul variable.</li></ul></section><section><h2 id=aspect-temporel-1>Aspect Temporel:</h2><h3 id=implémentation>Implémentation</h3><p>Implémentation en temps discret avec un pas de calcul fixe</p><ul><li>pas de solveur</li><li>Contrainte temps réel</li><li>Single-Rate &amp; Multi-Rate</li><li>Single-Tasking &amp; Multi-Tasking</li></ul><section data-background-image=./Scope_SingleTasking_70MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h2 id=discrete-times>Discrete times</h2><ul><li><p><strong>Single-rate</strong>:</p><ul><li>Les blocks ont tous la même période d&rsquo;exécution
(Même couleur)</li></ul></li><li><p><strong>Multi-Rate</strong></p><ul><li>Les blocks peuvent avoir des périodes d&rsquo;exécution différentes
(Schéma multicolore)</li></ul></li></ul><section data-background-image=./Scope_SingleTasking_70MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h4 id=modèle-multi-rate>Modèle multi-rate</h4><p class=stretch><img data-src=./Model_Hardware_Test_withSampleTime.png></p></section><section><h4 id=charge-cpu-d-un-modèle-multi-rate-single-tasking-70-mips>Charge CPU d&rsquo;un modèle multi-rate single-tasking (@70 mips)</h4><p><img src=./Scope_SingleTasking_70MIPS.png alt=./Scope_SingleTasking_70MIPS.png></p><section data-background-image=./Scope_SingleTasking_70MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h4 id=charge-cpu-d-un-modèle-multi-rate-single-tasking-20-mips>Charge CPU d&rsquo;un modèle multi-rate single-tasking (@20 mips)</h4><p><img src=./Scope_SingleTasking_20MIPS.png alt=./Scope_SingleTasking_20MIPS.png></p><section data-background-image=./Scope_SingleTasking_20MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h2 id=single-tasking>Single-Tasking</h2><p>Single-Tasking: Dans le slot de temps, l&rsquo;exécution de tous les blocks doit se terminer avant la fin du slot.</p></section><section><h2 id=multi-tasking>Multi-Tasking</h2><p>Multi-Tasking: Préemption possible -&gt; <strong>Monotonic Rate Scheduler</strong></p><ul><li>La tâche la plus fréquente à la priorité maximale<ul><li>Préemptera une tache plus lente</li><li>Beaucoup plus flexible</li><li>Mode par défaut (voir options du solveur)</li></ul></li></ul></section><section><h4 id=charge-cpu-d-un-modèle-multi-rate-single-tasking-70-mips-1>Charge CPU d&rsquo;un modèle multi-rate single-tasking (@70 mips)</h4><p><img src=./Scope_MultiTasking_70MIPS.png alt=./Scope_MultiTasking_70MIPS.png></p><section data-background-image=./Scope_MultiTasking_70MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h4 id=charge-cpu-d-un-modèle-multi-rate-single-tasking-20-mips-1>Charge CPU d&rsquo;un modèle multi-rate single-tasking (@20 mips)</h4><p><img src=./Scope_MultiTasking_20MIPS.png alt=./Scope_MultiTasking_20MIPS.png></p><section data-background-image=./Scope_MultiTasking_20MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h2 id=tasking-conclusion>Tasking Conclusion</h2><ul><li>Single-Tasking @ 20 MIPS -&gt; <strong>Overload</strong><ul><li>dispatcher la tache la plus lente sur plusieurs slots</li><li>(option d&rsquo;offset dans <strong>Time Step</strong> -&gt; <em>[.001 .005])</em></li></ul></li><li>Multi-Tasking @ 20 MIPS -&gt; <strong>Ok</strong><ul><li>Rate transfert block options<ul><li>Data Integrity</li><li>Deterministic data transfert</li></ul></li></ul></li></ul></section><section><h1 id=optimisation>Optimisation</h1><h2 id=type-de-données>type de données</h2><ul><li>Virgule Fixe</li><li>Virgule Flottante</li></ul></section><section><section data-background-image=./FloatFixed_1.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><h2 id=flotant>Flotant</h2><table><thead><tr><th align=center>IEEE 754</th><th align=center>Single</th><th align=center>Double</th></tr></thead><tbody><tr><td align=center>Format width</td><td align=center>32</td><td align=center>64</td></tr><tr><td align=center>Sign bit</td><td align=center>1</td><td align=center>1</td></tr><tr><td align=center>exponent width</td><td align=center>8</td><td align=center>11</td></tr><tr><td align=center>Precision width</td><td align=center>23+1</td><td align=center>52+1</td></tr></tbody></table><p>1st bit of the significand is always 1. Phantom bit</p></section><section><h2 id=custom-8-bit-floating-point>Custom 8 bit Floating point</h2><table><thead><tr><th align=center>Parameter</th><th align=center>Single</th><th align=center>Double</th><th align=center>Custom</th></tr></thead><tbody><tr><td align=center>Format width</td><td align=center>32</td><td align=center>64</td><td align=center>8</td></tr><tr><td align=center>Sign bit</td><td align=center>1</td><td align=center>1</td><td align=center>1</td></tr><tr><td align=center>exponent width</td><td align=center>8</td><td align=center>11</td><td align=center>4</td></tr><tr><td align=center>Precision width</td><td align=center>23+1</td><td align=center>52+1</td><td align=center>3+1</td></tr></tbody></table></section><section><section data-background-image=./FloatFixed_2.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-background-image=./FloatFixed_3.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-background-image=./FloatFixed_4.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><h2 id=script-matlab-pour-tester-un-flottant-8-bits>Script Matlab pour tester un flottant 8 bits</h2><pre><code class=language-MATLAB>% 4 bit exponent (signed)
emin = -7; emax = 6; 
% 3 bits significand
p = 3;

exps = 2.^[emin:emax]; 
vals = (2^p) + [0:(2^p-1)];  % significand with leading 1

TotalVal = vals'*exps;

% add denormalized values
8bitFloat = unique([TotalVal  ; 2^emin * [0:(2^m-1)]']);
8bitFloat = unique(flipud(-TotalVal) ;TotalVal]); % with neg vals
</code></pre></section><section><h1 id=simulink>Simulink</h1></section><section><h2 id=data-type>Data-type</h2><p class=stretch><img data-src=./Simulink_TypeCast_FixPtFormat.png></p></section><section><h2 id=datatype>Datatype</h2><ul><li>int8&hellip;uint23</li><li>fixdt(1,16,15)<ul><li>Scaling is En15 (Exp neg)</li><li>$$\rightarrow 2^-15$$</li></ul></li><li>fixdt(1,16)<ul><li>signed (1)</li><li>16 bit width</li><li>Scaling is derived from min &amp; max</li></ul></li></ul></section><section><h2 id=datatype-1>Datatype</h2><p><img src=./Simulink_TypeCast_SlopeAndBias.png alt=./Simulink_TypeCast_SlopeAndBias.png></p><ul><li>fixdt(1,16,.01,0)<ul><li>Scaling is sfix16<strong>Sp</strong>01</li><li>Slope point 01<br></li></ul></li></ul></section><section><p><img src=./Simulink_TypeCast_SlopeAndBias_Sat.png alt=./Simulink_TypeCast_SlopeAndBias_Sat.png></p></section><section><h1 id=tp>TP</h1><h2 id=https-www-ctrl-elec-fr><a href=https://www.ctrl-elec.fr>https://www.ctrl-elec.fr</a></h2><p><a href=https://lubin.kerhuel.eu/slides/slides_dcmotor_insa>https://lubin.kerhuel.eu/slides/slides_dcmotor_insa</a></p></section><section><h2 id=elements-de-correction>Elements de correction</h2></section><section><section data-background-image=./TP_Correction_OpAmp.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-background-image=./TP_Correction_ADC.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><h2 id=pwm-settings>PWM settings</h2></section><section><section data-background-image=./TP_Correction_PWM_Main.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-background-image=./TP_Correction_PWM_02.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-background-image=./TP_Correction_PWM_03.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-background-image=./TP_Correction_PWM_04.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-background-image=./TP_Correction_PWM_05.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><h2 id=liens>Liens:</h2><ul><li>MPLAB device blocks for Simulink:
<a href=https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink>https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink</a></li><li>MPLAB X:
<a href=https://www.microchip.com/MPLABX>https://www.microchip.com/MPLABX</a></li><li><p>XC16:
<a href=https://www.microchip.com/XC16>https://www.microchip.com/XC16</a></p></li><li><p><a href=https://lubin.kerhuel.eu>https://lubin.kerhuel.eu</a></p></li><li><p><a href=http://www.ctrl-elec.fr>http://www.ctrl-elec.fr</a></p></li></ul></section></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/js/reveal.min.js></script><script>window.revealPlugins={dependencies:[{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/markdown/marked.js',condition:function(){return!!document.querySelector('[data-markdown]');}},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/markdown/markdown.js',condition:function(){return!!document.querySelector('[data-markdown]');}},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/highlight/highlight.js',async:true,callback:function(){hljs.initHighlightingOnLoad();}},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/zoom-js/zoom.js',async:true},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/math/math.js',async:true},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/print-pdf/print-pdf.js',async:true},{src:'\/js\/vendor\/reveal.js\/plugin\/notes\/notes.js',async:true}]};let revealDefaults={center:true,controls:true,history:true,progress:true,transition:'slide',mouseWheel:true};let revealOptions=Object.assign({},revealDefaults,revealPlugins);Reveal.initialize(revealOptions);</script></body></html>