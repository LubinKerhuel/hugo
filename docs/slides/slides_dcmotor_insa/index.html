<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.7.0"><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png href=/images/icon_hua5ed3a3c5aab9d478a9217a3fd35ab73_87443_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/images/icon_hua5ed3a3c5aab9d478a9217a3fd35ab73_87443_192x192_fill_lanczos_center_2.png><link rel=canonical href=https://lubin.kerhuel.eu/slides/slides_dcmotor_insa/><title>Prototypage Rapide avec Simulink sur dsPIC | Rapid Control Prototyping</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/css/reveal.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/css/theme/black.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/dracula.min.css crossorigin=anonymous><link rel=stylesheet href=/css/reveal_custom.min.css><script>var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href=window.location.search.match(/print-pdf/gi)?'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/css/print/pdf.css':'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/css/print/paper.css';document.getElementsByTagName('head')[0].appendChild(link);</script></head><body><div class=reveal><div class=slides><section><h2 id=prototypage-rapide>Prototypage Rapide</h2><h3 id=model-based-design>Model Based Design</h3><p class=stretch><a href=https://fr.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink-dspic-pic32-and-sam-mcu/><img data-src=/img/logo_mplab-deviceblocksforsimulink-whitebackground.png></a></p><p>[
<a href=https://rtdc.ctrl-elec.fr/ target=_blank rel=noopener>Lab</a>] -
<a href=/authors/lubin>L.Kerhuel</a> -
<a href=/authors/romain-delpoux>R.Delpoux</a></p></section><section><h2 id=plan>Plan:</h2><ul><li><p>Model Based Design</p><ul><li>Model</li></ul></li><li><p>De la simulation au programme embarqué</p><ul><li>Différences temporelles</li><li>type de données et optimisation</li></ul></li></ul></section><section data-noprocess data-shortcode-slide data-transition=fade data-transition_speed=slow><h2 id=model-based-design-mdb>Model Based Design (MDB)</h2><p><img src=./Picooz_01_Close.jpg alt=./Picooz_01_Close.jpg></p></section><section data-noprocess data-shortcode-slide data-transition=fade data-transition_speed=slow><h2 id=model-based-design-mdb-1>Model Based Design (MDB)</h2><p><img src=./Picooz_02_Open.jpg alt=./Picooz_01_Open.jpg></p></section><section data-noprocess data-shortcode-slide data-transition=fade data-transition_speed=slow><h2 id=model-based-design-mdb-2>Model Based Design (MDB)</h2><p><img src=./Picooz_03_Motor.jpg alt=./Picooz_03_Close.jpg></p></section><section data-noprocess data-shortcode-slide data-background-color=#FFFFFF><p class=stretch><img data-src=./Picooz_DC_Motor_Electronic_All.png></p><aside class=notes>Commande en Vitesse</aside></section><section><h2 id=model-based-design-mdb-3>Model Based Design (MDB)</h2><p><img src=./Picooz_IdentificatoinBlockPresentation.png alt=./Picooz_IdentificatoinBlockPresentation.png></p><aside class=notes>Identification</aside></section><section><h2 id=model-based-design-mdb-4>Model Based Design (MDB)</h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://player.vimeo.com/video/309895581 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="vimeo video" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div></section><section><p><img src=./Picooz_Identificatoin_eq_01.png alt=./Picooz_Identificatoin_eq_01.png></p></section><section><p><img src=./Picooz_Identificatoin_eq_02.png alt=./Picooz_Identificatoin_eq_02.png></p><aside class=notes>rasoir d&rsquo;Ockham</aside></section><section><p><img src=./Picooz_SuperTwistingController.png alt=./Picooz_SuperTwistingController.png></p></section><section data-noprocess data-shortcode-slide data-background-color=#FFFFFF><section data-background-image=./Picooz_SetpLarge_ClosedLoop_SimuVsReal.png data-background-opacity=1 data-background-position=center data-background-size=contain></section><aside class=notes>Prediction Simu vs reel</aside></section><section><h2 id=span-stylecoloryellowmodelspan-based-design><span style=color:#ff0>Model</span> Based Design</h2><ol><li>Identification</li><li>Simulation / synthèse commande</li><li>Test</li></ol></section><section><h2 id=tp-validation-du-modèle-de-moteur-dc-fournit>TP: Validation du modèle de moteur DC fournit</h2><ul><li>log de command & réponse</li><li>Simulation comparaison<ul><li>commande avec modèle moteur
vs</li><li>système réel</li></ul></li></ul></section><section><h2 id=tp-validation-du-modèle-de-moteur-dc-fournit-1>TP: Validation du modèle de moteur DC fournit</h2><p><img src=./Simulink_DCMotorPravalux_LogVsSimu.png alt=./Simulink_DCMotorPravalux_LogVsSimu.png></p></section><section><h2 id=de-la-simulation-au-programme-embarqué>De la simulation au programme embarqué</h2></section><section><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://player.vimeo.com/video/309876246 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="vimeo video" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div></section><section><h2 id=pendule-inversedocsinverted-pendulum><a href=/docs/inverted-pendulum/>Pendule inverse</a></h2><p><img src=./Inverted_Pendulum_ControlLoopCloseUp.png alt=./Inverted_Pendulum_ControlLoopCloseUp.png><aside class=notes><ol><li>Couleurs : Period echantillonnage</li><li>Datatype</li></ol></aside></p></section><section><h2 id=aspect-temporel>Aspect Temporel:</h2><h3 id=simulation>Simulation</h3><p>Modélisation en temps continue:</p><p>transformé de Laplace en p (s)</p><ul><li>Solver résoud les équations différentielles<ul><li>approximation numérique</li></ul></li><li>Pas de contraintes temps réelle<ul><li>différent solveurs (Runge-Kutta, ODEx,&mldr;)</li></ul></li></ul><aside class=notes><ol><li>Couleurs : Period echantillonnage
DSPACE discretise le modèle</li></ol></aside></section><section><h2 id=aspect-temporel-1>Aspect Temporel:</h2><h3 id=implémentation>Implémentation</h3><p>Implémentation en temps discret:</p><p>&ldquo;pas&rdquo; de calcul fixe</p><ul><li>pas de solveur</li><li>Contrainte temps réel<ul><li>model Single-Rate & Multi-Rate</li><li>implementation Single-Tasking & Multi-Tasking</li></ul></li></ul><aside class=notes>Single Rate / Multi rate
Single Tasking / Multi Tasking</aside></section><section><h2 id=discrete-times>Discrete times</h2><ul><li><p><strong>Single-rate</strong>:</p><ul><li>Les blocks ont tous la même période d&rsquo;exécution
(Même couleur)</li></ul></li><li><p><strong>Multi-Rate</strong></p><ul><li>Les blocks peuvent avoir des périodes d&rsquo;exécution différentes
(Schéma multicolore)</li></ul></li></ul></section><section><h4 id=modèle-multi-rate>Modèle multi-rate</h4><p class=stretch><img data-src=./Model_Hardware_Test_withSampleTime.png></p><section data-background-image=./Scope_SingleTasking_70MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h4 id=charge-cpu-dun-modèle-multi-rate-single-tasking-70-mips>Charge CPU d&rsquo;un modèle multi-rate single-tasking (@70 mips)</h4><p><img src=./Scope_SingleTasking_70MIPS.png alt=./Scope_SingleTasking_70MIPS.png></p><section data-background-image=./Scope_SingleTasking_70MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h4 id=charge-cpu-dun-modèle-multi-rate-single-tasking-20-mips>Charge CPU d&rsquo;un modèle multi-rate single-tasking (@20 mips)</h4><p><img src=./Scope_SingleTasking_20MIPS.png alt=./Scope_SingleTasking_20MIPS.png></p><section data-background-image=./Scope_SingleTasking_20MIPS.png data-background-opacity=0.06 data-background-position=center></section><aside class=notes>OVERLOAD</aside></section><section><h2 id=single-tasking>Single-Tasking</h2><p>Single-Tasking: Dans le slot de temps, l&rsquo;exécution de tous les blocks doit se terminer avant la fin du slot.</p></section><section><h2 id=multi-tasking>Multi-Tasking</h2><p>Multi-Tasking: Préemption possible -> <strong>Monotonic Rate Scheduler</strong></p><ul><li>La tâche la plus fréquente à la priorité maximale<ul><li>Préemptera une tache plus lente</li><li>Beaucoup plus flexible</li><li>Mode par défaut (voir options du solveur)</li></ul></li></ul></section><section><h4 id=charge-cpu-dun-modèle-multi-rate-multi-tasking-70-mips>Charge CPU d&rsquo;un modèle multi-rate multi-tasking (@70 mips)</h4><p><img src=./Scope_MultiTasking_70MIPS.png alt=./Scope_MultiTasking_70MIPS.png></p><section data-background-image=./Scope_MultiTasking_70MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h4 id=charge-cpu-dun-modèle-multi-rate-multi-tasking-20-mips>Charge CPU d&rsquo;un modèle multi-rate multi-tasking (@20 mips)</h4><p><img src=./Scope_MultiTasking_20MIPS.png alt=./Scope_MultiTasking_20MIPS.png></p><section data-background-image=./Scope_MultiTasking_20MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><p><img src=./Scope_MultiTasking_SchedulerIllustration.png alt=./Scope_MultiTasking_70MIPS.png></p><section data-background-image=./Scope_MultiTasking_70MIPS.png data-background-opacity=0.06 data-background-position=center></section></section><section><h2 id=tasking-conclusion>Tasking Conclusion</h2><ul><li><p>Single-Tasking @ 20 MIPS -> <strong>Overload</strong></p><ul><li>dispatcher la tache la plus lente sur plusieurs slots</li><li>(option d&rsquo;offset dans <strong>Time Step</strong> -> <em>[.001 .005])</em></li></ul></li><li><p>Multi-Tasking @ 20 MIPS -> <strong>Ok</strong></p><ul><li>Rate transfert block options<ul><li>Data Integrity</li><li>Deterministic data transfert</li></ul></li></ul></li></ul><aside class=notes>20 MIPS ok avec multi-tasking
Single tasking: deterministe</aside></section><section><h1 id=optimisation>Optimisation</h1><h2 id=type-de-données>type de données</h2><ul><li>Virgule Fixe</li><li>Virgule Flottante</li></ul></section><section><h2 id=virgule-fixe>Virgule fixe</h2><h3 id=int8>int8</h3><p>$\underbrace{1}_{sign\ (1)} \ \underbrace{1111111}_{mantisse\ (7)} * \underbrace{slope}_{\text{LSB value}}$</p><ul><li><p>$v = (mantisse-sign*128) * slope $</p></li><li><p>plage: $\pm 2^{7} * slope$</p></li><li><p>2 digit [0-9] significatifs</p></li></ul><aside class=notes>slope est fixe</aside></section><section><section data-background-image=./FloatFixed_1.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-shortcode-section><h2 id=virgule-flotante>Virgule flotante</h2><h3 id=single-32-bits>Single (32 bits)</h3><p>$\underbrace{1}_{sign\ (1)} \ \underbrace{11111111}_{exponent\ (8)} \ \color{yellow}{1}\underbrace{11111111111111111111111}_{mantisse\ (23)} $</p><ul><li><p>$v \approx (1-2 sign) * mantisse * 2^{exponent-127}$</p></li><li><p>plage: $\pm 2^{128} = \pm 3.4*10^{38}$</p></li><li><p>7 digit [0-9] significatifs</p></li></ul></section><section data-shortcode-section><table><thead><tr><th align=center>IEEE 754</th><th align=center>Single</th><th align=center>Double</th></tr></thead><tbody><tr><td align=center>Format width</td><td align=center>32</td><td align=center>64</td></tr><tr><td align=center>Sign bit</td><td align=center>1</td><td align=center>1</td></tr><tr><td align=center>exponent width</td><td align=center>8</td><td align=center>11</td></tr><tr><td align=center>Precision width</td><td align=center>23<span style=color:#ff0>+1</span></td><td align=center>52<span style=color:#ff0>+1</span></td></tr></tbody></table><p><span style=color:#ff0>1st</span> phantom bitof the significand is always 1.</p></section></section><section><h2 id=virgule-flotante-1>Virgule flotante</h2><h3 id=custom-8-bits>Custom (8 bits)</h3><p>$\underbrace{1}_{sign\ (1)} \ \underbrace{1111}_{exponent\ (4)} \ \color{yellow}{1}\underbrace{111}_{mantisse\ (3)} $</p><ul><li><p>$v \approx (1-2 sign) * mantisse * 2^{exponent-127}$</p></li><li><p>plage: $\pm 2^{128} = 3.4*10^{38}$</p></li><li><p>0.9 digit [0-9] significatifs</p></li></ul></section><section><h2 id=custom-8-bit-floating-point>Custom 8 bit Floating point</h2><table><thead><tr><th align=center>Parameter</th><th align=center>Single</th><th align=center>Double</th><th align=center>Custom</th></tr></thead><tbody><tr><td align=center>Format width</td><td align=center>32</td><td align=center>64</td><td align=center>8</td></tr><tr><td align=center>Sign bit</td><td align=center>1</td><td align=center>1</td><td align=center>1</td></tr><tr><td align=center>exponent width</td><td align=center>8</td><td align=center>11</td><td align=center>4</td></tr><tr><td align=center>Precision width</td><td align=center>23+1</td><td align=center>52+1</td><td align=center>3+1</td></tr></tbody></table></section><section><section data-background-image=./FloatFixed_2.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-background-image=./FloatFixed_3.png data-background-opacity=1 data-background-position=center data-background-size=contain></section></section><section><section data-background-image=./FloatFixed_4.png data-background-opacity=1 data-background-position=center data-background-size=contain></section><aside class=notes>Integrateur (avec petit TS)
GPS</aside></section><section><h2 id=script-matlab-pour-tester-un-flottant-8-bits>Script Matlab pour tester un flottant 8 bits</h2><pre><code class=language-MATLAB>% 4 bit exponent (signed)
emin = -7; emax = 6; 
% 3 bits significand
p = 3;

exps = 2.^[emin:emax]; 
vals = (2^p) + [0:(2^p-1)];  % significand with leading 1

TotalVal = vals'*exps;

% add denormalized values
8bitFloat = unique([TotalVal  ; 2^emin * [0:(2^m-1)]']);
8bitFloat = unique(flipud(-TotalVal) ;TotalVal]); % with neg vals
</code></pre></section><section><h1 id=simulink>Simulink</h1></section><section><h2 id=data-type>Data-type</h2><p class=stretch><img data-src=./Simulink_TypeCast_FixPtFormat.png></p></section><section><h2 id=data-type-notation>Data-type notation</h2><ul><li>int8&mldr;uint23</li><li>fixdt(1,16)<ul><li>signed (1)</li><li>16 bit width</li><li>Scaling is derived from defined min & max</li></ul></li><li>fixdt(1,16,15)<ul><li>Scaling is <span style=color:#ff0>En</span>15 (Exp neg $\rightarrow 2^{-15}$)</li></ul></li><li>fixdt(1,16,-15)<ul><li>Scaling is <span style=color:#ff0>E</span>15 (Exp $\rightarrow 2^{15}$)</li></ul></li></ul></section><section><h2 id=datatype-notation>Datatype notation</h2><p><img src=./Simulink_TypeCast_SlopeAndBias.png alt=./Simulink_TypeCast_SlopeAndBias.png></p><ul><li>fixdt(1,16,.01,0)<ul><li>Scaling is sfix16<span style=color:#ff0>Sp</span>01<ul><li>Slope point 01</li></ul></li></ul></li></ul></section><section><p><img src=./Simulink_TypeCast_SlopeAndBias_Sat.png alt=./Simulink_TypeCast_SlopeAndBias_Sat.png></p><ul><li><span style=color:#ff0>SI</span>: Stored Integer</li><li><span style=color:#ff0>RWV</span>: Real World Value</li></ul></section><section><h2 id=tp>TP</h2><p><a href=https://rtdc.ctrl-elec.fr/ target=_blank rel=noopener>https://rtdc.ctrl-elec.fr</a></p></section><section><h2 id=download>download</h2><ul><li><a href=https://github.com/rdelpoux/INSA_TP_CommandeTempsReel_MCC/raw/master/LABMatlabFiles/02_GettingStarted/MCLV2_dsPIC33EP256MC506_base_R2017a.zip target=_blank rel=noopener>base model</a></li></ul></section><section><h2 id=elements-de-correction>Elements de correction</h2></section><section><h2 id=liens>Liens:</h2><ul><li><p>MPLAB device blocks for Simulink:
<a href=https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink>https://www.mathworks.com/matlabcentral/fileexchange/71892-mplab-device-blocks-for-simulink</a></p></li><li><p>MPLAB X:
<a href=https://www.microchip.com/MPLABX>https://www.microchip.com/MPLABX</a></p></li><li><p>XC16:
<a href=https://www.microchip.com/XC16>https://www.microchip.com/XC16</a></p></li><li><p><a href=https://lubin.kerhuel.eu>https://lubin.kerhuel.eu</a></p></li><li><p><a href=http://www.ctrl-elec.fr>http://www.ctrl-elec.fr</a></p></li></ul></section><section><h1 id=slide-control>Slide control:</h1><ul><li>Next: <code>Right Arrow</code> or <code>Space</code></li><li>Previous: <code>Left Arrow</code></li><li>Start: <code>Home</code></li><li>Finish: <code>End</code></li><li>Overview: <code>Esc</code></li><li>Speaker notes: <code>S</code></li><li>Fullscreen: <code>F</code></li><li>Zoom: <code>Alt + Click</code></li></ul></section></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/js/reveal.min.js></script><script>window.revealPlugins={dependencies:[{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/markdown/marked.js',condition:function(){return!!document.querySelector('[data-markdown]');}},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/markdown/markdown.js',condition:function(){return!!document.querySelector('[data-markdown]');}},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/highlight/highlight.js',async:true,callback:function(){hljs.initHighlightingOnLoad();}},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/zoom-js/zoom.js',async:true},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/math/math.js',async:true},{src:'https:\/\/cdnjs.cloudflare.com\/ajax\/libs\/reveal.js\/3.8.0/plugin/print-pdf/print-pdf.js',async:true},{src:'\/js\/vendor\/reveal.js\/plugin\/notes\/notes.js',async:true}]};let revealDefaults={center:true,controls:true,history:true,progress:true,transition:'slide',mouseWheel:true};let revealOptions=Object.assign({},revealDefaults,revealPlugins);Reveal.initialize(revealOptions);</script></body></html>